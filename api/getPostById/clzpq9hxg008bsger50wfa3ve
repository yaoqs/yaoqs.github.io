{"type":"getPostById","data":{"title":"å¦‚ä½•åˆ¶ä½œé€æ˜èƒŒæ™¯çš„OpenGLæ¸²æŸ“ä¸Šä¸‹æ–‡ï¼Ÿ","date":"2022-06-13T01:46:57.000Z","description":"","categories":[],"tags":[{"name":"OpenGL","_id":"clzpq9hvl005bsgereavp57za"},{"name":"C++","_id":"clzpq9hzn00cjsgere9jbg525"}],"content":"<p><a href=\"https://cloud.tencent.com/developer/ask/sof/101292\">è½¬è½½è‡ªè…¾è®¯äº‘ç¤¾åŒº</a></p>\n<p>è¿™æ˜¯ä¸€ä¸ªå¤è€çš„é—®é¢˜ï¼Œä½†ç”±äºæ–°ç‰ˆæœ¬çš„Windowsæœ‰åˆæˆå’Œå¯¹openglçš„æ”¯æŒï¼Œæ­£å¦‚datenwolfæ‰€æš—ç¤ºçš„é‚£æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›ç‰¹æ®Šçš„è°ƒæ–™æ¥å®ç°è¿™ä¸€ç‚¹ã€‚å°½ç®¡è¿™å¯¹äºDirectXæ¥è¯´ä¹Ÿæ˜¯å¾®ä¸è¶³é“çš„(å¦‚å›¾æ‰€ç¤º)å¾®è½¯ç¡®å®åœ¨openglä¸Šä¸‹æ–‡ä¸­æ·»åŠ äº†åˆæˆæç¤ºã€‚è€¶ï¼Œåå„æ–­çš„ææƒ§ï¼</p>\n<p>å› æ­¤ï¼Œæ‚¨å¿…é¡»ä½¿ç”¨æŒ‡å®šalphaé€šé“çš„åƒç´ æ ¼å¼åˆ›å»ºä¸€ä¸ªopenglä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸”å®ƒåº”è¯¥ä½¿ç”¨åˆæˆ(ç¬¬82è¡Œ)ã€‚ç„¶åï¼Œä½¿ç”¨DwmApi.hä¾‹ç¨‹å¯ç”¨ä¸€ä¸ªæ¨¡ç³Šçª—å£(ç¬¬179è¡Œ)ï¼Œå…¶ä¸­æŒ‡å®šäº†ä¸€ä¸ªå®Œå…¨æ— æ•ˆçš„åŒºåŸŸï¼Œè¿™å°†æ¨¡ç³Šä»»ä½•å†…å®¹å¹¶ä½¿çª—å£ä¿æŒé€æ˜ã€‚(æ‚¨éœ€è¦åœ¨çª—å£ç±»ä¸ŠæŒ‡å®šä¸€ä¸ªblack+transparentç¬”åˆ·ï¼å¥‡æ€ªï¼)ç„¶åï¼Œæ‚¨å®é™…ä¸Šåªæ˜¯ä½¿ç”¨openglï¼Œå°±åƒæ‚¨ä¹ æƒ¯ä½¿ç”¨å®ƒä¸€æ ·ã€‚åœ¨äº‹ä»¶å¾ªç¯ä¸­ï¼Œåªè¦æœ‰æœºä¼šï¼Œæ‚¨å°±å¯ä»¥ç»˜åˆ¶å’Œäº¤æ¢ç¼“å†²åŒº(ç¬¬201è¡Œ)ï¼Œå¹¶è®°ä½å¯ç”¨GL_BLENDï¼ğŸ˜ƒ</p>\n<p>è¯·æŸ¥çœ‹/fork <a href=\"https://gist.github.com/3644466\">https://gist.github.com/3644466</a>ï¼Œæˆ–è€…åªæŸ¥çœ‹åŸºäºOPè‡ªå·±çš„ç­”æ¡ˆçš„ä»¥ä¸‹ä»£ç ç‰‡æ®µï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ­¤æŠ€æœ¯(æ‚¨å¯ä»¥å°†å…¶æ”¾åœ¨ä¸€ä¸ªç©ºé¡¹ç›®ä¸­)ï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> _WIN32_WINNT 0x0500</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;windows.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;windowsx.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;GL/gl.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;GL/glu.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;dwmapi.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">pragma</span> comment (lib, <span class=\"string\">&quot;opengl32.lib&quot;</span>)</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">pragma</span> comment (lib, <span class=\"string\">&quot;glu32.lib&quot;</span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">pragma</span> comment (lib, <span class=\"string\">&quot;dwmapi.lib&quot;</span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;assert.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;tchar.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">ifdef</span>  assert</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> verify(expr) <span class=\"keyword\">if</span>(!expr) assert(0)</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">else</span> verify(expr) expr</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">const</span> TCHAR szAppName[]=_T(<span class=\"string\">&quot;TransparentGL&quot;</span>);</span><br><span class=\"line\"><span class=\"type\">const</span> TCHAR wcWndName[]=_T(<span class=\"string\">&quot;TransparentGL&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">HDC hDC;</span><br><span class=\"line\">HGLRC m_hrc;</span><br><span class=\"line\"><span class=\"type\">int</span> w = <span class=\"number\">240</span>;</span><br><span class=\"line\"><span class=\"type\">int</span> h = <span class=\"number\">240</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">BOOL <span class=\"title\">initSC</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">glEnable</span>(GL_ALPHA_TEST);</span><br><span class=\"line\">    <span class=\"built_in\">glEnable</span>(GL_DEPTH_TEST);</span><br><span class=\"line\">    <span class=\"built_in\">glEnable</span>(GL_COLOR_MATERIAL);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">glEnable</span>(GL_LIGHTING);</span><br><span class=\"line\">    <span class=\"built_in\">glEnable</span>(GL_LIGHT0);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">glEnable</span>(GL_BLEND);</span><br><span class=\"line\">    <span class=\"built_in\">glBlendFunc</span>(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</span><br><span class=\"line\">    <span class=\"built_in\">glClearColor</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">resizeSC</span><span class=\"params\">(<span class=\"type\">int</span> width,<span class=\"type\">int</span> height)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">glViewport</span>(<span class=\"number\">0</span>,<span class=\"number\">0</span>,width,height);</span><br><span class=\"line\">    <span class=\"built_in\">glMatrixMode</span>(GL_PROJECTION);</span><br><span class=\"line\">    <span class=\"built_in\">glLoadIdentity</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">glMatrixMode</span>(GL_MODELVIEW );</span><br><span class=\"line\">    <span class=\"built_in\">glLoadIdentity</span>();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">BOOL <span class=\"title\">renderSC</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">glClear</span>(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">glPushMatrix</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">glColor3f</span>(<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"built_in\">glBegin</span>(GL_TRIANGLES);                              <span class=\"comment\">// Drawing Using Triangles</span></span><br><span class=\"line\">        <span class=\"built_in\">glColor3f</span>(<span class=\"number\">1.0f</span>,<span class=\"number\">0.0f</span>,<span class=\"number\">0.0f</span>);                      <span class=\"comment\">// Set The Color To Red</span></span><br><span class=\"line\">        <span class=\"built_in\">glVertex3f</span>( <span class=\"number\">0.0f</span>, <span class=\"number\">1.0f</span>, <span class=\"number\">0.0f</span>);                  <span class=\"comment\">// Top</span></span><br><span class=\"line\">        <span class=\"built_in\">glColor3f</span>(<span class=\"number\">0.0f</span>,<span class=\"number\">1.0f</span>,<span class=\"number\">0.0f</span>);                      <span class=\"comment\">// Set The Color To Green</span></span><br><span class=\"line\">        <span class=\"built_in\">glVertex3f</span>(<span class=\"number\">-1.0f</span>,<span class=\"number\">-1.0f</span>, <span class=\"number\">0.0f</span>);                  <span class=\"comment\">// Bottom Left</span></span><br><span class=\"line\">        <span class=\"built_in\">glColor3f</span>(<span class=\"number\">0.0f</span>,<span class=\"number\">0.0f</span>,<span class=\"number\">1.0f</span>);                      <span class=\"comment\">// Set The Color To Blue</span></span><br><span class=\"line\">        <span class=\"built_in\">glVertex3f</span>( <span class=\"number\">1.0f</span>,<span class=\"number\">-1.0f</span>, <span class=\"number\">0.0f</span>);                  <span class=\"comment\">// Bottom Right</span></span><br><span class=\"line\">    <span class=\"built_in\">glEnd</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">glPopMatrix</span>();</span><br><span class=\"line\">    <span class=\"built_in\">glFlush</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">BOOL <span class=\"title\">CreateHGLRC</span><span class=\"params\">(HWND hWnd)</span> </span>&#123;</span><br><span class=\"line\">    PIXELFORMATDESCRIPTOR pfd = &#123;</span><br><span class=\"line\">      <span class=\"built_in\">sizeof</span>(PIXELFORMATDESCRIPTOR),</span><br><span class=\"line\">      <span class=\"number\">1</span>,                                <span class=\"comment\">// Version Number</span></span><br><span class=\"line\">      PFD_DRAW_TO_WINDOW      |         <span class=\"comment\">// Format Must Support Window</span></span><br><span class=\"line\">      PFD_SUPPORT_OPENGL      |         <span class=\"comment\">// Format Must Support OpenGL</span></span><br><span class=\"line\">      PFD_SUPPORT_COMPOSITION |         <span class=\"comment\">// Format Must Support Composition</span></span><br><span class=\"line\">      PFD_DOUBLEBUFFER,                 <span class=\"comment\">// Must Support Double Buffering</span></span><br><span class=\"line\">      PFD_TYPE_RGBA,                    <span class=\"comment\">// Request An RGBA Format</span></span><br><span class=\"line\">      <span class=\"number\">32</span>,                               <span class=\"comment\">// Select Our Color Depth</span></span><br><span class=\"line\">      <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>,                 <span class=\"comment\">// Color Bits Ignored</span></span><br><span class=\"line\">      <span class=\"number\">8</span>,                                <span class=\"comment\">// An Alpha Buffer</span></span><br><span class=\"line\">      <span class=\"number\">0</span>,                                <span class=\"comment\">// Shift Bit Ignored</span></span><br><span class=\"line\">      <span class=\"number\">0</span>,                                <span class=\"comment\">// No Accumulation Buffer</span></span><br><span class=\"line\">      <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>,                       <span class=\"comment\">// Accumulation Bits Ignored</span></span><br><span class=\"line\">      <span class=\"number\">24</span>,                               <span class=\"comment\">// 16Bit Z-Buffer (Depth Buffer)</span></span><br><span class=\"line\">      <span class=\"number\">8</span>,                                <span class=\"comment\">// Some Stencil Buffer</span></span><br><span class=\"line\">      <span class=\"number\">0</span>,                                <span class=\"comment\">// No Auxiliary Buffer</span></span><br><span class=\"line\">      PFD_MAIN_PLANE,                   <span class=\"comment\">// Main Drawing Layer</span></span><br><span class=\"line\">      <span class=\"number\">0</span>,                                <span class=\"comment\">// Reserved</span></span><br><span class=\"line\">      <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>                           <span class=\"comment\">// Layer Masks Ignored</span></span><br><span class=\"line\">   &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">   HDC hdc = <span class=\"built_in\">GetDC</span>(hWnd);</span><br><span class=\"line\">   <span class=\"type\">int</span> PixelFormat = <span class=\"built_in\">ChoosePixelFormat</span>(hdc, &amp;pfd);</span><br><span class=\"line\">   <span class=\"keyword\">if</span> (PixelFormat == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">assert</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> FALSE ;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   BOOL bResult = <span class=\"built_in\">SetPixelFormat</span>(hdc, PixelFormat, &amp;pfd);</span><br><span class=\"line\">   <span class=\"keyword\">if</span> (bResult==FALSE) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">assert</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> FALSE ;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   m_hrc = <span class=\"built_in\">wglCreateContext</span>(hdc);</span><br><span class=\"line\">   <span class=\"keyword\">if</span> (!m_hrc)&#123;</span><br><span class=\"line\">      <span class=\"built_in\">assert</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> FALSE;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"built_in\">ReleaseDC</span>(hWnd, hdc);</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">return</span> TRUE;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">LRESULT CALLBACK <span class=\"title\">WindowFunc</span><span class=\"params\">(HWND hWnd,UINT msg, WPARAM wParam, LPARAM lParam)</span> </span>&#123;</span><br><span class=\"line\">    PAINTSTRUCT ps;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">switch</span>(msg) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> WM_CREATE:</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">case</span> WM_DESTROY:</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(m_hrc) &#123;</span><br><span class=\"line\">                <span class=\"built_in\">wglMakeCurrent</span>(<span class=\"literal\">NULL</span>, <span class=\"literal\">NULL</span>);</span><br><span class=\"line\">                <span class=\"built_in\">wglDeleteContext</span>(m_hrc) ;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">PostQuitMessage</span>(<span class=\"number\">0</span>) ;</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">default</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">DefWindowProc</span>(hWnd,msg,wParam,lParam);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> WINAPI _tWinMain(HINSTANCE hThisInst, HINSTANCE hPrevInst, LPSTR str,<span class=\"type\">int</span> nWinMode) &#123;</span><br><span class=\"line\">    WNDCLASSEX wc;</span><br><span class=\"line\">    <span class=\"built_in\">memset</span>(&amp;wc, <span class=\"number\">0</span>, <span class=\"built_in\">sizeof</span>(wc));</span><br><span class=\"line\">    wc.cbSize = <span class=\"built_in\">sizeof</span>(WNDCLASSEX);</span><br><span class=\"line\">    wc.hIconSm = <span class=\"built_in\">LoadIcon</span>(<span class=\"literal\">NULL</span>, IDI_APPLICATION);</span><br><span class=\"line\">    wc.style = CS_HREDRAW | CS_VREDRAW;</span><br><span class=\"line\">    wc.lpfnWndProc = (WNDPROC)WindowFunc;</span><br><span class=\"line\">    wc.cbClsExtra  = <span class=\"number\">0</span>;</span><br><span class=\"line\">    wc.cbWndExtra  = <span class=\"number\">0</span>;</span><br><span class=\"line\">    wc.hInstance = hThisInst;</span><br><span class=\"line\">    wc.hIcon = <span class=\"built_in\">LoadIcon</span>(<span class=\"literal\">NULL</span>, IDI_APPLICATION);</span><br><span class=\"line\">    wc.hCursor = <span class=\"built_in\">LoadCursor</span>(<span class=\"literal\">NULL</span>, IDC_ARROW);</span><br><span class=\"line\">    wc.hbrBackground = (HBRUSH)<span class=\"built_in\">CreateSolidBrush</span>(<span class=\"number\">0x00000000</span>);</span><br><span class=\"line\">    wc.lpszClassName = szAppName;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!<span class=\"built_in\">RegisterClassEx</span>(&amp;wc)) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">MessageBox</span>(<span class=\"literal\">NULL</span>, _T(<span class=\"string\">&quot;RegisterClassEx - failed&quot;</span>), _T(<span class=\"string\">&quot;Error&quot;</span>), MB_OK | MB_ICONERROR);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> FALSE;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    HWND hWnd = <span class=\"built_in\">CreateWindowEx</span>(WS_EX_APPWINDOW, szAppName, wcWndName,</span><br><span class=\"line\">                    WS_VISIBLE | WS_POPUP, <span class=\"number\">200</span>, <span class=\"number\">150</span>, w, h,</span><br><span class=\"line\">                    <span class=\"literal\">NULL</span>, <span class=\"literal\">NULL</span>, hThisInst, <span class=\"literal\">NULL</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!hWnd) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">MessageBox</span>(<span class=\"literal\">NULL</span>, _T(<span class=\"string\">&quot;CreateWindowEx - failed&quot;</span>), _T(<span class=\"string\">&quot;Error&quot;</span>), MB_OK | MB_ICONERROR);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> FALSE;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    DWM_BLURBEHIND bb = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">    HRGN hRgn = <span class=\"built_in\">CreateRectRgn</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">-1</span>, <span class=\"number\">-1</span>);</span><br><span class=\"line\">    bb.dwFlags = DWM_BB_ENABLE | DWM_BB_BLURREGION;</span><br><span class=\"line\">    bb.hRgnBlur = hRgn;</span><br><span class=\"line\">    bb.fEnable = TRUE;</span><br><span class=\"line\">    <span class=\"built_in\">DwmEnableBlurBehindWindow</span>(hWnd, &amp;bb);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">CreateHGLRC</span>(hWnd);</span><br><span class=\"line\"></span><br><span class=\"line\">    HDC hdc = <span class=\"built_in\">GetDC</span>(hWnd);</span><br><span class=\"line\">    <span class=\"built_in\">wglMakeCurrent</span>(hdc, m_hrc);</span><br><span class=\"line\">    <span class=\"built_in\">initSC</span>();</span><br><span class=\"line\">    <span class=\"built_in\">resizeSC</span>(w, h);</span><br><span class=\"line\">    <span class=\"built_in\">ReleaseDC</span>(hWnd, hdc);</span><br><span class=\"line\"></span><br><span class=\"line\">    MSG msg;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"built_in\">PeekMessage</span>(&amp;msg, <span class=\"literal\">NULL</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, PM_REMOVE)) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">TranslateMessage</span>(&amp;msg);</span><br><span class=\"line\">            <span class=\"built_in\">DispatchMessage</span>(&amp;msg);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            HDC hdc = <span class=\"built_in\">GetDC</span>(hWnd);</span><br><span class=\"line\">            <span class=\"built_in\">wglMakeCurrent</span>(hdc, m_hrc);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"built_in\">renderSC</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"built_in\">SwapBuffers</span>(hdc);</span><br><span class=\"line\">            <span class=\"built_in\">ReleaseDC</span>(hWnd, hdc);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> (FALSE);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","_path":"20220613/ru-he-zhi-zuo-tou-ming-bei-jing-de-opengl-xuan-ran-shang-xia-wen/","_link":"https://yaoqs.github.io/20220613/ru-he-zhi-zuo-tou-ming-bei-jing-de-opengl-xuan-ran-shang-xia-wen/","_id":"clzpq9hxg008bsger50wfa3ve"}}