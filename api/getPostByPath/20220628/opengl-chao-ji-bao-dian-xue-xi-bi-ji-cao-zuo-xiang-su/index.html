{"type":"getPostByPath","data":{"title":"OpenGL超级宝典学习笔记操作像素","date":"2022-06-28T12:06:13.000Z","description":"","categories":[{"name":"技术笔记","_id":"clzpq9ht6001lsger8yzb9r3x"},{"name":"OpenGL","_id":"clzpq9htz002wsgerg19tej9e"}],"tags":[{"name":"OpenGL","_id":"clzpq9hvl005bsgereavp57za"}],"content":"<p>OpenGL支持放大，缩小，旋转图像。下面将举例介绍这些像素的操作。下面的例子是从tga文件中读取图片并显示，而且可以通过右键菜单来选择图像的显示模式和保存图片的快照到磁盘命名为screenshot.tga。完整的代码示例如下：</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;gltools.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;math.h&gt;</span></span></span><br><span class=\"line\"><span class=\"type\">static</span> GLbyte *pImage = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\"><span class=\"type\">static</span> GLint iRenderMode = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"type\">static</span> GLint iWidth, iHeight, iComponents; <span class=\"type\">static</span> GLenum eFormat;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">ProcessMenu</span><span class=\"params\">(<span class=\"type\">int</span> value)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (value == <span class=\"number\">1</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"comment\">//保存图像的快照 gltWriteTGA(&quot;screenshot.tga&quot;);</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        iRenderMode = value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    glutPostRedisplay();</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">RenderScene</span><span class=\"params\">()</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (!pImage)</span><br><span class=\"line\">    &#123; <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125; <span class=\"comment\">//设置光栅位置 glRasterPos2i(0, 0); //修改的图像，和用于反转的映射数组</span></span><br><span class=\"line\">    GLbyte *pModifyImage = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">    GLfloat invertMap[<span class=\"number\">256</span>]; <span class=\"keyword\">switch</span> (iRenderMode)</span><br><span class=\"line\">    &#123; <span class=\"keyword\">case</span> <span class=\"number\">2</span>: <span class=\"comment\">//图像倒转 glPixelZoom(-1.0f, -1.0f); //倒转后的图像的,渲染方向也倒转过来了，变成了从右上角开始往左下角渲染，所以设置倒转后的光栅位置为图像的宽高。 glRasterPos2i(iWidth, iHeight); break; case 3: //让图像填充满屏幕 GLint viewport[4]; //取得视口的大小 glGetIntegerv(GL_VIEWPORT, viewport); //按比例缩放 glPixelZoom((GLfloat)viewport[2]/iWidth, (GLfloat)viewport[3]/iHeight); break; case 4: //只保留红色 glPixelTransferf(GL_RED_SCALE, 1.0f);</span></span><br><span class=\"line\">    glPixelTransferf(GL_GREEN_SCALE, <span class=\"number\">0.0f</span>);</span><br><span class=\"line\">    glPixelTransferf(GL_BLUE_SCALE, <span class=\"number\">0.0f</span>); <span class=\"keyword\">break</span>; <span class=\"keyword\">case</span> <span class=\"number\">5</span>: <span class=\"comment\">//只保留绿色 glPixelTransferf(GL_RED_SCALE, 0.0f);</span></span><br><span class=\"line\">    glPixelTransferf(GL_GREEN_SCALE, <span class=\"number\">1.0f</span>);</span><br><span class=\"line\">    glPixelTransferf(GL_BLUE_SCALE, <span class=\"number\">0.0f</span>); <span class=\"keyword\">break</span>; <span class=\"keyword\">case</span> <span class=\"number\">6</span>: <span class=\"comment\">//只保留蓝色 glPixelTransferf(GL_RED_SCALE, 0.0f);</span></span><br><span class=\"line\">    glPixelTransferf(GL_GREEN_SCALE, <span class=\"number\">0.0f</span>);</span><br><span class=\"line\">    glPixelTransferf(GL_BLUE_SCALE, <span class=\"number\">1.0f</span>); <span class=\"keyword\">break</span>; <span class=\"keyword\">case</span> <span class=\"number\">7</span>: <span class=\"comment\">//先渲染图像到颜色缓冲区中 glDrawPixels(iWidth, iHeight, eFormat, GL_UNSIGNED_BYTE, pImage); //NTSC标准,转成黑白图像  glPixelTransferf(GL_RED_SCALE, 0.3f);</span></span><br><span class=\"line\">    glPixelTransferf(GL_GREEN_SCALE, <span class=\"number\">0.59f</span>);</span><br><span class=\"line\">    glPixelTransferf(GL_BLUE_SCALE, <span class=\"number\">0.11f</span>); <span class=\"comment\">//申请临时空间来保存修改后的图像 pModifyImage = (GLbyte *)malloc(iWidth * iHeight * 3); if (!pModifyImage)</span></span><br><span class=\"line\">    &#123; <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125; <span class=\"comment\">//从颜色缓冲区中读取图像的亮度数据 glReadPixels(0, 0, iWidth, iHeight, GL_LUMINANCE, GL_UNSIGNED_BYTE, pModifyImage); //还原 glPixelTransferf(GL_RED_SCALE, 1.0f);</span></span><br><span class=\"line\">    glPixelTransferf(GL_GREEN_SCALE, <span class=\"number\">1.0f</span>);</span><br><span class=\"line\">    glPixelTransferf(GL_BLUE_SCALE, <span class=\"number\">1.0f</span>); <span class=\"keyword\">break</span>; <span class=\"keyword\">case</span> <span class=\"number\">8</span>: <span class=\"comment\">//设置反转的颜色映射 invertMap[0] = 1.0f; for(int i = 0; i &lt; 256; ++i)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      invertMap[i] = <span class=\"number\">1.0f</span> - (<span class=\"number\">1.0f</span> / <span class=\"number\">255.0f</span> * (GLfloat)i);</span><br><span class=\"line\">    &#125; <span class=\"comment\">//映射 glPixelMapfv(GL_PIXEL_MAP_R_TO_R, 255, invertMap);</span></span><br><span class=\"line\">    glPixelMapfv(GL_PIXEL_MAP_G_TO_G, <span class=\"number\">255</span>, invertMap);</span><br><span class=\"line\">    glPixelMapfv(GL_PIXEL_MAP_B_TO_B, <span class=\"number\">255</span>, invertMap); <span class=\"comment\">//开启颜色映射 glPixelTransferi(GL_MAP_COLOR, GL_TRUE); default: break;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (pModifyImage)</span><br><span class=\"line\">    &#123; <span class=\"comment\">//画黑白图像 glDrawPixels(iWidth, iHeight, GL_RGB, GL_UNSIGNED_BYTE, pModifyImage);</span></span><br><span class=\"line\">    <span class=\"built_in\">free</span>(pModifyImage);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      glDrawPixels(iWidth, iHeight, eFormat, GL_UNSIGNED_BYTE, pImage);</span><br><span class=\"line\">    &#125; <span class=\"comment\">//还原 glPixelTransferf(GL_RED_SCALE, 1.0f);</span></span><br><span class=\"line\">    glPixelTransferf(GL_GREEN_SCALE, <span class=\"number\">1.0f</span>);</span><br><span class=\"line\">    glPixelTransferf(GL_BLUE_SCALE, <span class=\"number\">1.0f</span>);</span><br><span class=\"line\">    glPixelZoom(<span class=\"number\">1.0f</span>, <span class=\"number\">1.0f</span>);</span><br><span class=\"line\">    glPixelTransferi(GL_MAP_COLOR, GL_FALSE);</span><br><span class=\"line\">        glutSwapBuffers();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">SetupRC</span><span class=\"params\">()</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    glClearColor(<span class=\"number\">0.0f</span>, <span class=\"number\">0.0f</span>, <span class=\"number\">0.0f</span>, <span class=\"number\">1.0f</span>); <span class=\"comment\">//设置像素的存储格式 glPixelStorei(GL_UNPACK_ALIGNMENT, 1); //加载图像数据 pImage = gltLoadTGA(&quot;horse.tga&quot;, &amp;iWidth, &amp;iHeight, &amp;iComponents, &amp;eFormat);</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"comment\">//释放图像数据占用的内存空间 void ShutdownRC()</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (pImage)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"built_in\">free</span>(pImage);</span><br><span class=\"line\">        pImage = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">ChangeSize</span><span class=\"params\">(GLsizei w, GLsizei h)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (h == <span class=\"number\">0</span>)</span><br><span class=\"line\">        h = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    glViewport(<span class=\"number\">0</span>, <span class=\"number\">0</span>, w, h);</span><br><span class=\"line\"></span><br><span class=\"line\">    glMatrixMode(GL_PROJECTION);</span><br><span class=\"line\">    glLoadIdentity();</span><br><span class=\"line\"></span><br><span class=\"line\">    gluOrtho2D(<span class=\"number\">0.0</span>, (GLdouble)w, <span class=\"number\">0.0</span>, (GLdouble)h);</span><br><span class=\"line\"></span><br><span class=\"line\">    glMatrixMode(GL_MODELVIEW);</span><br><span class=\"line\">    glLoadIdentity();</span><br><span class=\"line\"></span><br><span class=\"line\">    glutPostRedisplay();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">main</span><span class=\"params\">(<span class=\"type\">int</span> args, <span class=\"type\">char</span> **argv)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    glutInit(&amp;args, argv);</span><br><span class=\"line\">    glutInitDisplayMode(GL_RGB | GL_DOUBLE);</span><br><span class=\"line\">    glutInitWindowSize(<span class=\"number\">800</span>, <span class=\"number\">600</span>);</span><br><span class=\"line\">    glutCreateWindow(<span class=\"string\">&quot;pixel operation&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    glutDisplayFunc(RenderScene);</span><br><span class=\"line\">    glutReshapeFunc(ChangeSize); <span class=\"comment\">//设置菜单 int menuID = glutCreateMenu(ProcessMenu);</span></span><br><span class=\"line\">    glutAddMenuEntry(<span class=\"string\">&quot;Save Image&quot;</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">    glutAddMenuEntry(<span class=\"string\">&quot;Flip&quot;</span>, <span class=\"number\">2</span>);</span><br><span class=\"line\">    glutAddMenuEntry(<span class=\"string\">&quot;zoom pixel fill window&quot;</span>, <span class=\"number\">3</span>);</span><br><span class=\"line\">    glutAddMenuEntry(<span class=\"string\">&quot;Just Red&quot;</span>, <span class=\"number\">4</span>);</span><br><span class=\"line\">    glutAddMenuEntry(<span class=\"string\">&quot;Just Green&quot;</span>, <span class=\"number\">5</span>);</span><br><span class=\"line\">    glutAddMenuEntry(<span class=\"string\">&quot;Just Blue&quot;</span>, <span class=\"number\">6</span>);</span><br><span class=\"line\">    glutAddMenuEntry(<span class=\"string\">&quot;black &amp; white&quot;</span>, <span class=\"number\">7</span>);</span><br><span class=\"line\">    glutAddMenuEntry(<span class=\"string\">&quot;invert map&quot;</span>, <span class=\"number\">8</span>);</span><br><span class=\"line\">    glutAttachMenu(GLUT_RIGHT_BUTTON);</span><br><span class=\"line\"></span><br><span class=\"line\">    SetupRC();</span><br><span class=\"line\">    glutMainLoop();</span><br><span class=\"line\">    ShutdownRC(); <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>SetupRC函数用于加载图像数据，保存图像数据，图像的宽高和格式等信息。</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">glClearColor(<span class=\"number\">0.0f</span>, <span class=\"number\">0.0f</span>, <span class=\"number\">0.0f</span>, <span class=\"number\">1.0f</span>); <span class=\"comment\">//设置像素的存储格式 glPixelStorei(GL_UNPACK_ALIGNMENT, 1); //加载图像数据 pImage = gltLoadTGA(&quot;horse.tga&quot;, &amp;iWidth, &amp;iHeight, &amp;iComponents, &amp;eFormat);</span></span><br></pre></td></tr></table></figure>\n<p>在程序退出时，记得释放为图像数据分配的内存，在ShutdownRC中释放图像数据</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (pImage)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"built_in\">free</span>(pImage);</span><br><span class=\"line\">    pImage = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在main函数中，创建菜单，为每个菜单项分配键值，然后绑定到右键上。</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//设置菜单 int menuID = glutCreateMenu(ProcessMenu);</span></span><br><span class=\"line\">glutAddMenuEntry(<span class=\"string\">&quot;Save Image&quot;</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">glutAddMenuEntry(<span class=\"string\">&quot;Flip&quot;</span>, <span class=\"number\">2</span>);</span><br><span class=\"line\">glutAddMenuEntry(<span class=\"string\">&quot;zoom pixel fill window&quot;</span>, <span class=\"number\">3</span>);</span><br><span class=\"line\">glutAddMenuEntry(<span class=\"string\">&quot;Just Red&quot;</span>, <span class=\"number\">4</span>);</span><br><span class=\"line\">glutAddMenuEntry(<span class=\"string\">&quot;Just Green&quot;</span>, <span class=\"number\">5</span>);</span><br><span class=\"line\">glutAddMenuEntry(<span class=\"string\">&quot;Just Blue&quot;</span>, <span class=\"number\">6</span>);</span><br><span class=\"line\">glutAddMenuEntry(<span class=\"string\">&quot;black &amp; white&quot;</span>, <span class=\"number\">7</span>);</span><br><span class=\"line\">glutAddMenuEntry(<span class=\"string\">&quot;invert map&quot;</span>, <span class=\"number\">8</span>);</span><br><span class=\"line\">glutAttachMenu(GLUT_RIGHT_BUTTON);</span><br></pre></td></tr></table></figure>\n<p>根据所选择的菜单进行相应的操作，默认情况下是通过glDrawPixels函数把图像放置在窗口的左下角显示。第一个菜单项Save Image是保存图像的快照。</p>\n<p><a href=\"https://www.linuxidc.com/upload/2015_02/150225154454381.png\"><img src=\"https://www.linuxidc.com/upload/2015_02/150225154454381.png\" alt=\"image\" title=\"image\"></a></p>\n<h4 id=\"像素缩放\"><a class=\"header-anchor\" href=\"#像素缩放\">※</a>像素缩放</h4>\n<p>常见的图像操作，放大和缩小图像。OpenGL提供了一个对图像进行缩放的函数：</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">glPixelZoom</span><span class=\"params\">(GLfloat xfactor, GLfloat yfactor)</span>;</span><br></pre></td></tr></table></figure>\n<p>xfactor,yfactor指定了在x，y方向上缩放的倍数。图像的缩放包括了放大，缩小和反转。例如：如果x方向上的缩放因子为2，那么图像在x方向上会放大2被。在本例中选择第三项菜单可以把图像填满窗口：</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//让图像填充满屏幕 GLint viewport[4]; //取得视口的大小 glGetIntegerv(GL_VIEWPORT, viewport); //按比例缩放 glPixelZoom((GLfloat)viewport[2]/iWidth, (GLfloat)viewport[3]/iHeight);</span></span><br></pre></td></tr></table></figure>\n<p><a href=\"https://www.linuxidc.com/upload/2015_02/150225154454382.png\"><img src=\"https://www.linuxidc.com/upload/2015_02/150225154454382.png\" alt=\"image\" title=\"image\"></a></p>\n<p>如果缩放因子为负值，效果就是沿缩放方向进行反转。此时不仅仅反转了图像中像素的排列顺序，而且也翻转图像根据光栅位置在屏幕上绘制的方向。例如，一般是图像的左下角放置在当前光栅位置，如果两个缩放因子都为负值则图像的右上角被放置在当前光栅位置处:</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//图像倒转 glPixelZoom(-1.0f, -1.0f); //倒转后的图像的,渲染方向也倒转过来了，变成了从右上角���始往左下角渲染，所以设置倒转后的光栅位置为图像的宽高。 glRasterPos2i(iWidth, iHeight);</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"像素变换\"><a class=\"header-anchor\" href=\"#像素变换\">※</a>像素变换</h4>\n<p>除了像素的缩放之外，OpenGL还支持对图像进行一些简单的数学操作。把像素转移到颜色缓冲区或者从颜色缓冲区转移出来。可以调用下面两个函数来实现：</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">glPixelTransferi</span><span class=\"params\">(GLenum pname, GLint param)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">glPixelTransferf</span><span class=\"params\">(GLenum pname, GLfloat param)</span>;</span><br></pre></td></tr></table></figure>\n<p>pname的枚举值如下表：</p>\n<p><a href=\"https://www.linuxidc.com/upload/2015_02/150225154454383.png\"><img src=\"https://www.linuxidc.com/upload/2015_02/150225154454383.png\" alt=\"image\" title=\"image\"></a></p>\n<p>缩放和偏转参数允许缩放和偏转单独的颜色通道。缩放因子将与颜色成分值相乘，偏转值则与颜色成分值相加。公式如下：</p>\n<p>新值 = （旧值 * 缩放因子）+偏转值</p>\n<p>默认情况下缩放因子是1.0，偏转值是0.0。如果想让图像只显示红色成分值，则可以设置绿色和蓝色的缩放因子为0.0.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">glPixelTransferf(GL_GREEN_SCALE, <span class=\"number\">0.0f</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">glPixelTransferf(GL_BLUE_SCALE, <span class=\"number\">0.0f</span>);</span><br></pre></td></tr></table></figure>\n<p>例子中，分别显示红色，绿色，蓝色成分值的代码：</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">case</span> <span class=\"number\">4</span>: <span class=\"comment\">//只保留红色 glPixelTransferf(GL_RED_SCALE, 1.0f);</span></span><br><span class=\"line\">  glPixelTransferf(GL_GREEN_SCALE, <span class=\"number\">0.0f</span>);</span><br><span class=\"line\">  glPixelTransferf(GL_BLUE_SCALE, <span class=\"number\">0.0f</span>); <span class=\"keyword\">break</span>; <span class=\"keyword\">case</span> <span class=\"number\">5</span>: <span class=\"comment\">//只保留绿色 glPixelTransferf(GL_RED_SCALE, 0.0f);</span></span><br><span class=\"line\">  glPixelTransferf(GL_GREEN_SCALE, <span class=\"number\">1.0f</span>);</span><br><span class=\"line\">  glPixelTransferf(GL_BLUE_SCALE, <span class=\"number\">0.0f</span>); <span class=\"keyword\">break</span>; <span class=\"keyword\">case</span> <span class=\"number\">6</span>: <span class=\"comment\">//只保留蓝色 glPixelTransferf(GL_RED_SCALE, 0.0f);</span></span><br><span class=\"line\">  glPixelTransferf(GL_GREEN_SCALE, <span class=\"number\">0.0f</span>);</span><br><span class=\"line\">  glPixelTransferf(GL_BLUE_SCALE, <span class=\"number\">1.0f</span>); <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>在绘制完成后把各个颜色通道的缩放因子复原。</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//还原 glPixelTransferf(GL_RED_SCALE, 1.0f);</span></span><br><span class=\"line\">   glPixelTransferf(GL_GREEN_SCALE, <span class=\"number\">1.0f</span>);</span><br><span class=\"line\">   glPixelTransferf(GL_BLUE_SCALE, <span class=\"number\">1.0f</span>);</span><br></pre></td></tr></table></figure>\n<p>我们还可以把一幅彩色图像转成黑白颜色来显示。首先把彩色图像渲染到颜色缓冲区中：</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">glDrawPixels(iWidth, iHeight, eFormat, GL_UNSIGNED_BYTE, pImage);</span><br></pre></td></tr></table></figure>\n<p>然后分配一个用来保存每个像素亮度值的内存空间：</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pModifyImage = (GLbyte *)<span class=\"built_in\">malloc</span>(iWidth* iHeight);</span><br></pre></td></tr></table></figure>\n<p>亮度图像只有一个通道，所以我们只分配一个字节来存储亮度值。把当前颜色缓冲区中的颜色通道进行变换：使用NTSC（美国国家电视系统委员会）标准转成黑白图像</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">glPixelTransferf(GL_RED_SCALE, <span class=\"number\">0.3f</span>);</span><br><span class=\"line\">glPixelTransferf(GL_GREEN_SCALE, <span class=\"number\">0.59f</span>);</span><br><span class=\"line\">glPixelTransferf(GL_BLUE_SCALE, <span class=\"number\">0.11f</span>);</span><br></pre></td></tr></table></figure>\n<p>然后通过glReadPixel来从颜色缓冲区中读取图像的亮度值到pModifyImage指向的内存区域中。</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">glReadPixel(<span class=\"number\">0</span>, <span class=\"number\">0</span>, iWidth, iHeight, GL_LUMINANCE, GL_UNSIGNED_BYTE, pModifyImage);</span><br></pre></td></tr></table></figure>\n<p>最后把pModifyImage的数据写会颜色缓冲区中：</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">glDrawPixel(iWidth, iHeight, GL_LUMINANCE, GL_UNSIGNED_BYTE, pModifyImage);</span><br></pre></td></tr></table></figure>\n<p>OpenGl把彩色图像转换成亮度图，只是把各个颜色通道的值相加得到亮度值，超过1.0的设置为1.0，这样得到的效果不是很好：</p>\n<p><a href=\"https://www.linuxidc.com/upload/2015_02/150225154454384.png\"><img src=\"https://www.linuxidc.com/upload/2015_02/150225154454384.png\" alt=\"image\" title=\"image\"></a></p>\n<p>为了得到更好的效果，我们可以通过NTSC标准把彩色图像转换成灰度图。从RGB颜色空间转换到黑白色彩空间的转换公式是：</p>\n<p>亮度 = （0.3 <em>红色） + （0.59</em> 绿色） + （0.11 * 蓝色）；</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//NTSC标准  glPixelTransferf(GL_RED_SCALE, 0.3f);</span></span><br><span class=\"line\">    glPixelTransferf(GL_GREEN_SCALE, <span class=\"number\">0.59f</span>);</span><br><span class=\"line\">    glPixelTransferf(GL_BLUE_SCALE, <span class=\"number\">0.11f</span>);</span><br></pre></td></tr></table></figure>\n<p>得到的效果是更好看的灰度图：</p>\n<p><a href=\"https://www.linuxidc.com/upload/2015_02/150225154454385.png\"><img src=\"https://www.linuxidc.com/upload/2015_02/150225154454385.png\" alt=\"image\" title=\"image\"></a></p>\n<p><strong>OpenGL超级宝典 第4版 中文版PDF+英文版+源代码</strong> 见  <a href=\"https://www.linuxidc.com/Linux/2013-10/91413.htm\">http://www.linuxidc.com/Linux/2013-10/91413.htm</a></p>\n<p><strong>OpenGL编程指南（原书第7版）中文扫描版PDF</strong> 下载 <a href=\"https://www.linuxidc.com/Linux/2012-08/67925.htm\">http://www.linuxidc.com/Linux/2012-08/67925.htm</a></p>\n<p>OpenGL 渲染篇 <a href=\"https://www.linuxidc.com/Linux/2011-10/45756.htm\">http://www.linuxidc.com/Linux/2011-10/45756.htm</a></p>\n<p><a href=\"http://www.linuxidc.com/topicnews.aspx?tid=2\" title=\"Ubuntu\">Ubuntu</a> 13.04 安装 OpenGL <a href=\"https://www.linuxidc.com/Linux/2013-05/84815.htm\">http://www.linuxidc.com/Linux/2013-05/84815.htm</a></p>\n<p>OpenGL三维球体数据生成与绘制【附源码】 <a href=\"https://www.linuxidc.com/Linux/2013-04/83235.htm\">http://www.linuxidc.com/Linux/2013-04/83235.htm</a></p>\n<p>Ubuntu下OpenGL编程基础解析 <a href=\"https://www.linuxidc.com/Linux/2013-03/81675.htm\">http://www.linuxidc.com/Linux/2013-03/81675.htm</a></p>\n<p>如何在Ubuntu使用eclipse for c++配置OpenGL <a href=\"https://www.linuxidc.com/Linux/2012-11/74191.htm\">http://www.linuxidc.com/Linux/2012-11/74191.htm</a></p>\n<p><strong>更多《OpenGL超级宝典学习笔记》相关知识 见</strong> <a href=\"https://www.linuxidc.com/search.aspx?where=nkey&amp;keyword=34581\">http://www.linuxidc.com/search.aspx?where=nkey&amp;keyword=34581</a></p>\n<p><strong>本文永久更新链接地址</strong>：<a href=\"https://www.linuxidc.com/Linux/2015-02/114017.htm\">http://www.linuxidc.com/Linux/2015-02/114017.htm</a></p>\n<p><a href=\"http://www.linuxidc.com/\"><img src=\"https://www.linuxidc.com/linuxfile/logo.gif\" alt=\"linux\"></a></p>\n","_path":"20220628/opengl-chao-ji-bao-dian-xue-xi-bi-ji-cao-zuo-xiang-su/","_link":"https://yaoqs.github.io/20220628/opengl-chao-ji-bao-dian-xue-xi-bi-ji-cao-zuo-xiang-su/","_id":"clzpq9htk002asger9d6rh471"}}