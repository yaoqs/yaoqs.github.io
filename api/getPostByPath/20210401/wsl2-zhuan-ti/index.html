{"type":"getPostByPath","data":{"title":"WSL2专题","date":"2021-04-01T15:47:53.000Z","description":"","categories":[{"name":"专题","_id":"clzpq9hta001rsger1kx28gvd"}],"tags":[{"name":"专题","_id":"clzpq9hu0002xsgerfltn8246"},{"name":"WSL","_id":"clzpq9hwu007isger4j70b4uy"},{"name":"Windows Subsystem Linux","_id":"clzpq9hx1007qsger1jxm13ek"},{"name":"Linux","_id":"clzpq9hx7007vsgerhx3eb3ap"}],"content":"<h1>安装 WSL2</h1>\n<h2 id=\"开启虚拟机功能\"><a class=\"header-anchor\" href=\"#开启虚拟机功能\">※</a>开启虚拟机功能</h2>\n<p>❝ PS：由于WSL2是使用HyperV虚拟机的，所以开启之后会和VMware和VirtualBox冲突，可以通过升级VMware和vbox到支持HyperV的版本解决。❞</p>\n<ol>\n<li>\n<p>在控制面板 -&gt; 程序和功能 -&gt; Windows 功能窗口中勾选适用于 Linux 的 Windows 子系统 功能，点击确定，并按照提示重启电脑。</p>\n</li>\n<li>\n<p>或以管理员身份在命令行键入</p>\n <figure class=\"highlight ps\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Enable-WindowsOptionalFeature</span> <span class=\"literal\">-Online</span> <span class=\"literal\">-FeatureName</span> Microsoft<span class=\"literal\">-Windows-Subsystem-Linux</span></span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>启用虚拟化</p>\n</li>\n</ol>\n<p>使用管理员权限打开PowerShell，输入以下命令：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart</span><br><span class=\"line\">dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart</span><br></pre></td></tr></table></figure>\n<h2 id=\"安装发行版\"><a class=\"header-anchor\" href=\"#安装发行版\">※</a>安装发行版</h2>\n<p>在 Windows 应用商店搜索 WSL ，选择自己想要的 Linux 发行版，点击下载安装即可。这里选择的是 Kali。</p>\n<h2 id=\"下载WSL2的Linux内核\"><a class=\"header-anchor\" href=\"#下载WSL2的Linux内核\">※</a>下载WSL2的Linux内核</h2>\n<p>下载地址：<a href=\"https://aka.ms/wsl2kernel\">https://aka.ms/wsl2kernel</a> 或 <a href=\"https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi\">WSL2-kernel</a></p>\n<h2 id=\"升级WSL2\"><a class=\"header-anchor\" href=\"#升级WSL2\">※</a>升级WSL2</h2>\n<figure class=\"highlight ps\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl <span class=\"literal\">-l</span> <span class=\"comment\"># 查看WSL列表</span></span><br><span class=\"line\">wsl <span class=\"literal\">--set-version</span> kali<span class=\"literal\">-linux</span> <span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"配置\"><a class=\"header-anchor\" href=\"#配置\">※</a>配置</h2>\n<p>安装完成后，在 Kali Linux 下，输入如下命令，安装工具集</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> apt update &amp;&amp; <span class=\"built_in\">sudo</span> apt upgrade</span><br></pre></td></tr></table></figure>\n<p>安装Kali Linux工具包</p>\n<ol>\n<li>安装标准工具包</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> apt install kali-linux-default</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>安装大工具包（大概7 8G）</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> apt install kali-linux-large</span><br></pre></td></tr></table></figure>\n<h3 id=\"GUI-Win-KeX\"><a class=\"header-anchor\" href=\"#GUI-Win-KeX\">※</a>GUI (Win-KeX)</h3>\n<p>Win-Kex工具包是Kali提供的在Windows上运行的图形化工具包，可以一键式傻瓜化在WSL中跑图形界面。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> apt install -y kali-win-kex</span><br></pre></td></tr></table></figure>\n<p>安装完毕后，可使用如下命令启动</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 启动</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> ~</span><br><span class=\"line\">kex</span><br><span class=\"line\"><span class=\"comment\"># 关闭</span></span><br><span class=\"line\">kex stop</span><br><span class=\"line\"><span class=\"comment\"># 窗口模式</span></span><br><span class=\"line\">kex --win -s</span><br></pre></td></tr></table></figure>\n<p>Win-KeX 还提供了无缝模式</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 无缝模式</span></span><br><span class=\"line\">kex --sl -s</span><br></pre></td></tr></table></figure>\n<h3 id=\"将-Kali-和-Win-KeX-整合进-Terminal\"><a class=\"header-anchor\" href=\"#将-Kali-和-Win-KeX-整合进-Terminal\">※</a>将 Kali 和 Win-KeX 整合进 Terminal</h3>\n<p>Windows Terminal 的配置中添加</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;list&quot;: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            &quot;guid&quot;: &quot;&#123;46ca431a-3a87-5fb3-83cd-11ececc031d2&#125;&quot;,</span><br><span class=\"line\">            &quot;hidden&quot;: false,</span><br><span class=\"line\">            &quot;name&quot;: &quot;Kali&quot;,</span><br><span class=\"line\">            &quot;source&quot;: &quot;Windows.Terminal.Wsl&quot;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            &quot;guid&quot;: &quot;&#123;55ca431a-3a87-5fb3-83cd-11ececc031d2&#125;&quot;,</span><br><span class=\"line\">            &quot;hidden&quot;: false,</span><br><span class=\"line\">            &quot;name&quot;: &quot;KaTex&quot;,</span><br><span class=\"line\">            // 窗口模式启动</span><br><span class=\"line\">            &quot;commandline&quot;: &quot;wsl -d kali-linux kex --wtstart -s&quot;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">        &quot;guid&quot;: &quot;&#123;55ca431a-3a87-5fb3-83cd-11ececc031d2&#125;&quot;,</span><br><span class=\"line\">        &quot;hidden&quot;: false,</span><br><span class=\"line\">        &quot;name&quot;: &quot;Win-KeX&quot;,</span><br><span class=\"line\">        &quot;commandline&quot;: &quot;wsl kex wtstart&quot;,</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>WSL2 优化压缩</p>\n<p>随着使用时间的延长，WSL2占用的硬盘空间会越来越多，这个时候就需要对其文件进行压缩。方法如下</p>\n<figure class=\"highlight ps\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl <span class=\"literal\">--shutdown</span></span><br><span class=\"line\">diskpart</span><br><span class=\"line\"><span class=\"comment\"># open window Diskpart</span></span><br><span class=\"line\"><span class=\"built_in\">select</span> vdisk file=</span><br><span class=\"line\"><span class=\"comment\">####</span></span><br><span class=\"line\">attach vdisk readonly</span><br><span class=\"line\">compact vdisk</span><br><span class=\"line\">detach vdisk</span><br></pre></td></tr></table></figure>\n<h2 id=\"遇到的问题\"><a class=\"header-anchor\" href=\"#遇到的问题\">※</a>遇到的问题</h2>\n","_path":"20210401/wsl2-zhuan-ti/","_link":"https://yaoqs.github.io/20210401/wsl2-zhuan-ti/","_id":"clzpq9huf003isger5ktedd4w"}}