<!DOCTYPE html><html lang="en"><head><link href="https://fastly.jsdelivr.net/npm/hexo-tag-common@0.2.0/css/index.css" rel="stylesheet"><link href="/css/hexo-widget-tree.css" rel="stylesheet"><!--[if lt IE 9]>
    <script src="http://cdn.static.runoob.com/libs/html5shiv/3.7/html5shiv.min.js"></script>
<![endif]--><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="shortcut icon" href="favicon-fish.ico"><link rel="alternate" type="application/rss+xml" title="LordYao" href="/atom.xml"><meta name="keywords" content="LordYao,scholar,要庆生,yaoqs,FUTURE &amp; CIVILIZATION，Natural/Social Philosophy &amp; Infomation Sciences"><meta name="description" content="A scholar magazine/journal like blog，FUTURE &amp; CIVILIZATION，Natural/Social Philosophy &amp; Infomation Sciences,A scholar magazine/journal-like blog,要庆生的blog"><script>(()=>{var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",(e=document.getElementsByTagName("script")[0]).parentNode.insertBefore(t,e)})()</script><title>poco库学习 | LordYao</title><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha256-3gQJhtmj7YnV1fmtbVcnAV6eI4ws0Tr48bVZCThtCGQ=" crossorigin="anonymous"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha256-PI8n5gCcz9cQqQXm3PEtDuPG8qx9oFsFctPg0S5zb8g=" crossorigin="anonymous"><script src="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/js/all.min.js"></script><link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/fontawesome.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/future.css"><link rel="stylesheet" href="/css/main.css"><script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/jquery.qrcode@1.0.3/jquery.qrcode.min.js"></script><script src="https://d3js.org/d3.v7.min.js"></script><script src="/js/ax.js"></script><script src="/js/main.js"></script><link rel="canonical" href="https://yaoqs.github.io/20240522/poco-ku-xue-xi/"><meta name="generator" content="Hexo 7.3.0"></head><body><aside id="aside"><header><style>div#fork_me_on_github{margin-top:-2em;margin-left:-2em;margin-bottom:-5em}.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><div id="fork_me_on_github"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/" class="github-corner" aria-label="View source on GitHub"><svg width="8em" height="8em" viewBox="0 0 250 250" style="fill:#151515;color:#fff;position:absolute;top:0;border:0;left:0;transform:scale(-1,1)" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a></div><a id="avatar" href="/"><img id="avatar_img" src="/images/avatar_sx_lite.png" alt="LordYao"></a><h1><a id="author" href="/">LordYao</a></h1><div id="github-iframe"><iframe src="https://ghbtns.com/github-btn.html?user=yaoqs&type=follow&count=true" scrolling="no" frameborder="0" width="150px" height="20px"></iframe></div><div id="weibo"></div><script src="https://tjs.sjs.sinajs.cn/open/api/js/wb.js"></script><iframe src="https://widget.weibo.com/relationship/followbutton.php?btn=red&amp;style=2&amp;uid=1262655355&amp;width=86&amp;height=24&amp;language=zh_cn" scrolling="no" marginheight="0" width="86" height="24" frameborder="0"></iframe><div id="follow-icons"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://space.bilibili.com/19354848" title="哔哩哔哩/bilibili"><i class="fab fa-twitch fa-2x"></i></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/yaokingson" title="csdn"><i class="fab fa-blogger fa-2x"></i></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://hub.docker.com/u/lordyao" title="dockerhub"><i class="fab fa-docker fa-2x"></i></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://gitee.com/yaoqs" title="gitee"><i class="fab fa-git fa-2x"></i></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://ghbtns.com/github-btn.html?user=yaoqs&type=follow&count=true"><i></i></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/yaoqs" title="github"><i class="fab fa-github fa-2x"></i></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://stackexchange.com/users/5986345/francisco" title="StackOverflow"><i class="fab fa-stack-overflow fa-2x"></i></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="http://twitter.com/Lord_Honor_Yao" title="twitter/推特"><i class="fab fa-twitter fa-2x"></i></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="http://weibo.com/lordyao" title="weibo/微博"><i class="fab fa-weibo fa-2x"></i></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://widget.weibo.com/relationship/followbutton.php?btn=red&amp;style=2&amp;uid=1262655355&amp;width=86&amp;height=24&amp;language=zh_cn" title="加关注"><i></i></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.zhihu.com/people/yaoqs" title="知乎"><i class="fab fa-zhihu fa-2x"></i></a> <a id="rss" href="/atom.xml" title="RSS"><i class="fa fa-rss fa-2x"></i></a></div><span id="slogan">Slogan:<ul><li style="display:none">解放思想，发展生产力</li><li style="display:none">为天地立心，<br>为生民立命，<br>为往圣继绝学，<br>为万世开太平。</li><li style="display:none">知行合一</li><li style="display:none">凡事预则立，不预则废</li><li style="display:none">茍日新，日日新，又日新</li><li style="display:none">天之道，利而不害；<br>圣人之道，为而不争</li><li style="display:none">吾尝终日而思矣，不如须臾之所学也。<br>吾尝跂而望矣，不如登高之博见也。<br>君子生非异也，善假于物也。</li><li style="display:none">练得身形似鹤形，千株松下两函经。<br>我来问道无馀说，云在青霄水在瓶。</li><li style="display:none">寇可往，我亦可往</li><li style="display:none">我的思想是全人类的财富</li></ul><script>var sel=$("#slogan > ul > li");function lunbo(){arguments.callee.pre=arguments.callee.pre||0,sel[arguments.callee.pre].style.display="none",arguments.callee.pre=Math.floor(Math.random()*sel.length),sel[arguments.callee.pre].style.display="inline-block",setTimeout(lunbo,3e4)}lunbo()</script></span><span id="donate"><a href="/Donate" title="大吉大利 今晚吃鸡">Donate & Reward</a></span></header><footer id="footer-message">Copyright &copy; 2019 - <span id="year">2021</span> <a href="https://yaoqs.github.io" target="_blank">LordYao</a>. BY-NC-SA . All Rights Reserved.<br>Powered by <a href="http://hexo.io/" rel="external nofollow noreferrer" target="_blank">Hexo</a> & <a href="https://pages.github.com/" target="_blank">Github Pages</a>. Theme <a href="https://github.com/yaoqs/hexo-theme-scholar-future" rel="external nofollow noreferrer" target="_blank">scholar-future </a>designed by <a href="https://yaoqs.github.io" target="_blank">LordYao </a>.<script>var year=new Date(Date.now()).getFullYear();document.getElementById("year").innerText=year</script><div id="Statistics"><script>var _hmt=_hmt||[];(()=>{var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?2023f967cb85513ede1b6a3d58177776",document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)})()</script>&nbsp;<script>var cnzz_protocol="https:"==document.location.protocol?"https://":"http://";document.write(unescape("%3Cspan id='cnzz_stat_icon_1278269244'%3E%3C/span%3E%3Cscript src='"+cnzz_protocol+"s4.cnzz.com/z_stat.php%3Fid%3D1278269244%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"))</script>&nbsp;<script>var cnzz_protocol="https:"==document.location.protocol?"https://":"http://";document.write(unescape("%3Cspan id='cnzz_stat_icon_1278269244'%3E%3C/span%3E%3Cscript src='"+cnzz_protocol+"s4.cnzz.com/z_stat.php%3Fid%3D1278269244%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"))</script>&nbsp;<script src="https://tajs.qq.com/stats?sId=66496804" charset="UTF-8" async></script>&nbsp; <a target="_blank" rel="noopener external nofollow noreferrer" href="https://info.flagcounter.com/tQfY"><img src="https://s11.flagcounter.com/mini/tQfY/bg_FFFFFF/txt_000000/border_CCCCCC/flags_0/" alt="Flag Counter" border="0"></a>&nbsp;<script>((e,n,c,s,t,r)=>{e[s]=e[s]||function(){(e[s].c=e[s].c||[]).push(arguments)},e[s].s=!1,t=n.getElementsByTagName(c)[0],(r=n.createElement(c)).src="//s.union.360.cn/332983.js",r.defer=!0,r.async=!0,t.parentNode.insertBefore(r,t)})(window,document,"script","_qha")</script>&nbsp;<script src="//js.users.51.la/21341261.js"></script>&nbsp;<script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js?id=JhwXbvPO5Ijy6W6x&ck=JhwXbvPO5Ijy6W6x"></script><script id="LA-DATA-WIDGET" crossorigin="anonymous" charset="UTF-8" src="https://v6-widget.51.la/v6/JhwXbvPO5Ijy6W6x/quote.js?theme=0&f=12&display=0,0,0,1,0,0,0,1"></script><a target="_blank" title="51la网站统计" href="https://v6.51.la/land/JhwXbvPO5Ijy6W6x" rel="external nofollow noreferrer"><img src="https://sdk.51.la/icon/4-5.png"></a>&nbsp;<script src="https://sdk.51.la/perf/js-sdk-perf.min.js" crossorigin="anonymous"></script><script>(new LingQue.Monitor).init({id:"JhwYVlJAdB7w0kYc",sendSpaPv:!0})</script>&nbsp;<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_pv"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://busuanzi.ibruce.info/" title="不蒜子">总访问量:<span id="busuanzi_value_site_pv"><i class="fa fa-spinner fa-spin"></i></span></a>. </span>&nbsp;<br><span class="post-count">site total word count:475.6k</span></div></footer></aside><nav class="navbar"><h6><span id="custom_html_list"></span> &middot; <a href="/About">About </a>&middot; <a href="/Lab">Lab </a>&middot; <a href="/Navigator">Navigator </a>&middot; <a href="/Feature">Feature </a>&middot; <a href="/Donate">Donate </a>&middot; <a href="/Game">Game </a>&middot; <a href="/Music">Music </a><a href="#searchModal" class="modal-trigger waves-effect waves-light"><span id="searchIcon" class="fas fa-search" title="搜索" style="zoom:.85"></span></a><div id="repos"><div class="dropdown" onmouseenter='showList("dropdown-a")' onmouseleave='showList("dropdown-a")'><a id="a" href="javascript:void(0)" rel="external nofollow noreferrer" class="dropbtn">&#9776; Repositories Pages</a><div class="dropdown-content" id="dropdown-a"><script>$(async function(){jax("https://api.github.com/users/yaoqs/repos",await function(t){d3.select("body").select("#dropdown-a").selectAll("a").data(t).enter().append("a").attr("target","_blank").style("padding-left","1em").text(t=>"§ "+t.full_name).attr("href",t=>"https://yaoqs.github.io/"+t.name)},function(){$("<div style='color:red;width: 9em;height: 2em;text-align: center;display: table-cell;vertical-align: middle;'>当前无网络</div>").appendTo($("#dropdown-a"))})})</script></div></div>&middot;<div class="dropdown" onmouseenter='showList("dropdown-b")' onmouseleave='showList("dropdown-b")'><a href="/" class="dropbtn">Home</a><div class="dropdown-content" id="dropdown-b"><a href="/"><i class="fas fa-home" aria-hidden="true"></i><span style="text-align:center">&#x0009;首页/Index</span></a> <a href="/tags"><i class="fas fa-tags" aria-hidden="true"></i><span style="text-align:center">&#x0009;标签/Tags</span></a> <a href="/categories"><i class="fas fa-bookmark" aria-hidden="true"></i><span style="text-align:center">&#x0009;归类/Categories</span></a> <a href="/archives"><i class="fas fa-archive" aria-hidden="true"></i><span style="text-align:center">&#x0009;文档/Archives</span></a></div></div></div></h6></nav><div id="journal"><div id="journal-name">FUTURE & CIVILIZATION<br>Natural/Social Philosophy & Infomation Sciences</div><div id="post"><main id="content"><hr id="topline"><div id="DOI">05/22, 2024<br>https://yaoqs.github.io/20240522/poco-ku-xue-xi/<br><span class="post-count">post word count: 11.7k words.&nbsp; </span><span class="post-count">post estimate read time: 57 min</span></div><article class="post"><h1 class="post-title">Poco库学习</h1><div id="post-author">Yao Qingsheng<br>Department of Natural/Social Philosophy & Infomation Sciences, CHINA</div><section class="post-content article-entry"><section id="Abstract"><hr class="AbstractLine"><span class="Abstract">Abstract</span> <span class="Abstract-content"><div id="toc" class="toc-article"><a class="js-toggle-toc" href="javascript:void(0)" rel="external nofollow noreferrer"></a><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8Poco%E5%BA%93%EF%BC%9F"><span class="toc-text">为什么使用Poco库？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#POCO%E5%BA%93%E9%83%BD%E8%83%BD%E5%81%9A%E5%93%AA%E4%BA%9B%E4%BA%8B%EF%BC%9F"><span class="toc-text">POCO库都能做哪些事？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E5%88%86%E6%9E%90"><span class="toc-text">技术分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">应用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E7%82%B9%E4%B8%8E%E4%BC%98%E5%8A%BF"><span class="toc-text">特点与优势</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Poco%E5%BA%93%E7%9A%84%E4%B8%80%E4%BA%9B%E4%B8%BB%E8%A6%81%E7%89%B9%E7%82%B9%E5%92%8C%E5%8A%9F%E8%83%BD"><span class="toc-text">Poco库的一些主要特点和功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E4%B8%8B%E8%BD%BD%E5%92%8C%E5%BA%93%E7%BC%96%E8%AF%91%EF%BC%9F"><span class="toc-text">源码下载和库编译？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Poco%E5%BA%93%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD"><span class="toc-text">Poco库常用功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Poco%E5%BA%93%E6%9D%A5%E6%90%AD%E5%BB%BA%E6%9C%8D%E5%8A%A1%E7%A8%8B%E5%BA%8F"><span class="toc-text">使用Poco库来搭建服务程序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Poco%E5%BA%93%E8%BF%9B%E8%A1%8CHttps%E8%AF%B7%E6%B1%82%E8%AE%BF%E9%97%AE%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">使用Poco库进行Https请求访问服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#https-Get-%E8%AF%B7%E6%B1%82"><span class="toc-text">https Get 请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP-POST%E4%B8%8B%E8%BD%BD%E8%AF%B7%E6%B1%82"><span class="toc-text">HTTP POST下载请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#https-Post-MultiPart%E8%AF%B7%E6%B1%82"><span class="toc-text">https Post MultiPart请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87URL%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6"><span class="toc-text">通过URL下载文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%88%B0%E7%9A%84%E7%94%9F%E6%88%90https%E8%AF%B7%E6%B1%82%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-text">使用到的生成https请求的客户端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Poco%E5%BA%93%E8%A7%A3%E5%8E%8B%E7%BC%A9%E6%96%87%E4%BB%B6"><span class="toc-text">Poco库解压缩文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#POCO%E5%BA%93%E4%B8%AD%E6%96%87%E7%BC%96%E7%A8%8B%E5%8F%82%E8%80%83%E6%8C%87%E5%8D%97%EF%BC%8811%EF%BC%89%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Reactor%E6%A1%86%E6%9E%B6%EF%BC%9F"><span class="toc-text">POCO库中文编程参考指南（11）如何使用Reactor框架？[1]</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Poco-Reactor%E6%A8%A1%E5%BC%8F-SocketReactor-StreamSocket"><span class="toc-text">Poco Reactor模式 SocketReactor StreamSocket[2]</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#POCO%E5%BA%93%E4%B8%AD%E6%96%87%E7%BC%96%E7%A8%8B%E5%8F%82%E8%80%83%E6%8C%87%E5%8D%97%EF%BC%8811%EF%BC%89%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Reactor%E6%A1%86%E6%9E%B6%EF%BC%9F-v2"><span class="toc-text">POCO库中文编程参考指南（11）如何使用Reactor框架？[3]</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Reactor-%E6%A1%86%E6%9E%B6%E6%A6%82%E8%BF%B0"><span class="toc-text">Reactor 框架概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%89%E8%AF%B4%E4%B8%8D%E7%BB%83%E5%81%87%E6%8A%8A%E5%BC%8F"><span class="toc-text">光说不练假把式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Clinet-%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81"><span class="toc-text">Clinet 测试代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reactor%E6%A8%A1%E5%BC%8F%E4%BB%A5%E5%8F%8APoco-SocketReactor-%E6%BA%90%E7%A0%81%E6%B5%85%E6%9E%90"><span class="toc-text">Reactor模式以及Poco SocketReactor 源码浅析[4]</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E4%BA%94%E7%A7%8DIO%E6%A8%A1%E5%BC%8F"><span class="toc-text">常见的五种IO模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8C%E6%AD%A5%E5%92%8C%E5%BC%82%E6%AD%A5"><span class="toc-text">同步和异步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%BB%E5%A1%9E%E4%B8%8E%E9%9D%9E%E9%98%BB%E5%A1%9E%E5%BC%8FIO"><span class="toc-text">阻塞与非阻塞式IO</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IO%E5%A4%8D%E7%94%A8"><span class="toc-text">IO复用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reactor-%E6%A8%A1%E5%BC%8F"><span class="toc-text">Reactor 模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Poco-%E4%B8%AD%E7%9A%84-Reactor"><span class="toc-text">Poco 中的 Reactor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-text">使用方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Reactor"><span class="toc-text">Reactor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SocketAcceptor"><span class="toc-text">SocketAcceptor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ServiceHandler"><span class="toc-text">ServiceHandler</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SocketReactor-%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81%E8%A7%A3%E8%AF%BB"><span class="toc-text">SocketReactor 核心代码解读</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="toc-text">参考文献</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E6%BA%90%EF%BC%9APoco%E5%8F%AF%E7%A7%BB%E6%A4%8D%E7%BB%84%E4%BB%B6%E5%BA%93%E9%85%8D%E7%BD%AE%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="toc-text">开源：Poco可移植组件库配置与使用[5]</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-text">环境配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Windows"><span class="toc-text">Windows</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Ubuntu"><span class="toc-text">Ubuntu</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web%E6%9C%8D%E5%8A%A1%E7%A4%BA%E4%BE%8B"><span class="toc-text">web服务示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Json%E8%A7%A3%E6%9E%90%E7%A4%BA%E4%BE%8B"><span class="toc-text">Json解析示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%A4%BA%E4%BE%8B"><span class="toc-text">多线程示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4%E7%A4%BA%E4%BE%8B"><span class="toc-text">日期时间示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90uuid%E7%A4%BA%E4%BE%8B"><span class="toc-text">生成uuid示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#poco-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B"><span class="toc-text">poco 网络编程[6]</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8poco%E5%BA%93%EF%BC%8C%E5%AE%9E%E7%8E%B0tcp-client%E4%BE%8B%E5%AD%90"><span class="toc-text">使用poco库，实现tcp client例子[7]</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#base-socket-connector-h%E6%96%87%E4%BB%B6%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%B8%8D%E7%94%A8%E6%94%B9%E5%8A%A8"><span class="toc-text">base_socket_connector.h文件，可以不用改动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#base-tcp-client-h%EF%BC%8C%E6%A0%B9%E6%8D%AE%E5%BA%94%E7%94%A8%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%BF%9B%E8%A1%8C%E4%BF%AE%E6%94%B9"><span class="toc-text">base_tcp_client.h，根据应用，可以进行修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#main-c%EF%BC%9A"><span class="toc-text">main.c：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#makefile%EF%BC%9A"><span class="toc-text">makefile：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%80%90C-%E3%80%91%E9%83%AD%E8%80%81%E4%BA%8C%E5%8D%9A%E6%96%87%E4%B9%8B%EF%BC%9AC-%E7%9B%AE%E5%BD%95"><span class="toc-text">【C++】郭老二博文之：C++目录[8]</span></a></li></ol></div></div></span><span class="Abstract">Keywords <span class="keywords-content"></span></span><hr class="AbstractLine"><span class="Abstract">Citation <span class="keywords-content">Yao Qing-sheng&period;Poco库学习&period;FUTURE & CIVILIZATION Natural/Social Philosophy & Infomation Sciences&comma;20240522&period; https://yaoqs.github.io/20240522/poco-ku-xue-xi/</span></span><hr class="AbstractLine"></section><section><p>POCO库是强大的的跨平台C<ins>库，可以用来编写多平台的网络应用程序，这些平台包括桌面端、服务端、移动端、IOT(物联网)、嵌入式系统等。总的来说是一个非常强大的综合性库。Poco 是一个开源的、跨平台的C</ins>库，它提供了大量的基础工具和服务，旨在简化和加速软件开发过程。该项目由Poco Software Foundation维护，拥有广泛的社区支持，并在各种工业级应用中被广泛采用。Poco是一个功能丰富、易于使用的跨平台C++开发框架，全称为&quot;POrtable COmponents&quot;，它提供了一系列的类库和工具，用于开发跨平台、高性能、可扩展的应用程序。</p><p>项目地址:<a target="_blank" rel="noopener external nofollow noreferrer" href="https://gitcode.com/pocoproject/poco">https://gitcode.com/pocoproject/poco</a></p><h2 id="为什么使用Poco库？"><a class="header-anchor" href="#为什么使用Poco库？">※</a>为什么使用Poco库？</h2><ol><li>支持跨平台</li><li>性能表现优异</li><li>API使用方便,便于上手</li><li>库可以拆分使用,容易实现轻量化调用</li><li>功能模块丰富</li><li>Poco C++库是在Boost软件许可证下授权的，既可以用来开发非商业应用，也可以用来开发商业应用。可以说是可以自由使用的了。</li></ol><h2 id="POCO库都能做哪些事？"><a class="header-anchor" href="#POCO库都能做哪些事？">※</a>POCO库都能做哪些事？</h2><p>根据Poco官方文档介绍Poco库支持的功能组如下：</p><ol><li>类型和字节序操作</li><li>错误处理和调试</li><li>内存管理</li><li>字符串和文本的格式化</li><li>平台和环境的操作和处理</li><li>随机数生成和各种哈希算法</li><li>时间和日期处理</li><li>文件操作系统处理</li><li>通知和事件</li><li>各种流处理</li><li>日志操作</li><li>动态的库操作</li><li>进程管理</li><li>url和uuid的生成和操作</li><li>XML和Json文件操作</li><li>网络编程</li><li>客户端程序和网络程序的编写</li><li>文件系统的支持和配置</li><li>日志系统的配置</li></ol><p>总的来说就是能用到的功能poco库都支持，可以说是非常强大了。</p><h2 id="技术分析"><a class="header-anchor" href="#技术分析">※</a>技术分析</h2><p>Poco 库包含多个模块，涵盖了网络编程、XML处理、数据库接口、加密、日期/时间操作、日志记录、JSON解析等多种功能。以下是其核心组件和技术亮点：</p><ul><li>网络编程：Poco 提供了全面的网络API，包括HTTP、HTTPS、FTP、SMTP、SOCKS等协议的支持，使得开发者可以轻松创建网络客户端和服务端应。</li><li>数据存取：Poco 包含ODBC和JDBC桥接器，允许无缝连接到多种关系型数据库系统，同时还提供了一个SQLite嵌入式数据库引擎。</li><li>加密与安全性：内置了OpenSSL库的封装，支持SSL/TLS加密，可用于安全的网络通信和证书管理。</li><li>XML和JSON解析：Poco 提供了高效的XML和JSON解析器与生成器，便于数据交换和配置文件处理。</li><li>线程与并发：提供线程管理和同步原语，使得多线程编程变得更简单，同时也支持异步事件模型。</li><li>日志系统：灵活的日志记录机制，可自定义输出级别、格式和目标，方便调试和监控。</li><li>国际化和本地化：支持多种语言和地区的字符串处理，为全球化的应用程序提供便利。</li><li>跨平台兼容性：Poco 可在Windows、Linux、macOS、iOS、Android等多个操作系统上运行，实现了良好的平台一致性。</li></ul><h2 id="应用场景"><a class="header-anchor" href="#应用场景">※</a>应用场景</h2><p>由于其丰富的功能和灵活性，Poco 在以下场景中尤其有用：</p><ul><li>建立高性能的Web服务或API。</li><li>开发需要网络通信的桌面应用，如文件传输工具。</li><li>构建复杂的分布式系统，利用其并发和线程管理能力。</li><li>数据处理和存储，无论是本地还是远程数据库。</li><li>创建安全的应用程序，例如需要加密和身份验证的系统。</li><li>编写需要多语言支持的国际化应用。</li></ul><h2 id="特点与优势"><a class="header-anchor" href="#特点与优势">※</a>特点与优势</h2><ul><li>高效性：Poco 库设计精良，注重性能优化，代码轻量且易于集成。</li><li>模块化：各个组件独立，可根据需要选择使用，避免了不必要的资源开销。</li><li>易用性：API 设计简洁，文档详尽，便于学习和使用。</li><li>活跃的社区：社区成员积极贡献代码，定期更新，问题解决速度快。</li><li>广泛的依赖项管理：兼容CMake，可以与其他开源项目轻松配合。</li></ul><h2 id="Poco库的一些主要特点和功能"><a class="header-anchor" href="#Poco库的一些主要特点和功能">※</a>Poco库的一些主要特点和功能</h2><ol><li>跨平台支持：Poco库支持多个操作系统，包括Windows、Linux、macOS等，使得开发者可以编写可移植的代码。它提供了对操作系统API的抽象封装，简化了跨平台开发过程。</li><li>组件化设计：Poco库的设计基于组件化思想，将常用的功能封装成独立的可重用组件。每个组件都提供了清晰而一致的接口，开发者可以根据需选择并使用适当的组件。</li><li>网络和通信：Poco库提供了强大而易用的网络和通信功能，包括HTTP、SMTP、POP3、FTP、WebSocket、TCP/UDP等协议的支持，以及HTTP服器和客户端的实现。</li><li>数据库访问：Poco库具有对多种数据库的支持，包括MySQL、SQLite、PostgreSQL、Oracle等。它提供了简单而灵活的接口，方便进行数据库接、查询和事务处理。</li><li>加密和安全：Poco库提供了包括AES、RSA、HMAC、SSL等在内的各种加密算法的支持，以及摘要、签名、证书管理等安全功能。</li><li>多线程和并发：Poco库提供了多线程和并发编程的支持，包括线程、互斥锁、条件变量、线程池等工具，方便编写高效的并发代码。</li><li>XML和JSON处理：Poco库提供了对XML和JSON格式的解析、生成和处理的支持，方便开发者进行配置文件解析、数据交换等操作。</li><li>文件系统和IO操作：Poco库提供了强大的文件系统和IO操作功能，包括文件读写、目录遍历、文件监控等，简化了文件和目录处理的过程。</li><li>单元测试和文档生成：Poco库内置了用于单元测试和文档生成的工具集，方便开发者进行代码测试、文档编写和生成。</li></ol><h2 id="源码下载和库编译？"><a class="header-anchor" href="#源码下载和库编译？">※</a>源码下载和库编译？</h2><p>Poco库的官网地址<a target="_blank" rel="noopener external nofollow noreferrer" href="https://pocoproject.org/index.html">https://pocoproject.org/index.html</a></p><p>Poco库的项目地址<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/pocoproject/poco/tree/master">https://github.com/pocoproject/poco/tree/master</a></p><p>Poco库可以根据使用需求不同，编译成静态库或者动态库，编译方法很简单，这里就不再做详细介绍了。</p><h2 id="Poco库常用功能"><a class="header-anchor" href="#Poco库常用功能">※</a>Poco库常用功能</h2><p>MD5值计算、Base64加密计算、HMAC-MD5计算</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//MD5值的计算</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco\MD5Engine.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco\DigestStream.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco\StreamCopier.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">using</span> Poco::DigestEngine;</span><br><span class="line"><span class="keyword">using</span> Poco::MD5Engine;</span><br><span class="line"><span class="keyword">using</span> Poco::DigestOutputStream;</span><br><span class="line"><span class="keyword">using</span> Poco::StreamCopier;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//base64的计算</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco\Base64Decoder.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco\StreamCopier.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco\Base64Encoder.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">using</span> Poco::Base64Encoder;</span><br><span class="line"><span class="keyword">using</span> Poco::StreamCopier;</span><br><span class="line"><span class="keyword">using</span> Poco::Base64Decoder;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//计算HMAC-MD5值</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/HMACEngine.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/MD5Engine.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/DigestStream.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/StreamCopier.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">using</span> Poco::DigestEngine;</span><br><span class="line"><span class="keyword">using</span> Poco::HMACEngine;</span><br><span class="line"><span class="keyword">using</span> Poco::MD5Engine;</span><br><span class="line"><span class="keyword">using</span> Poco::DigestOutputStream;</span><br><span class="line"><span class="keyword">using</span> Poco::StreamCopier;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="comment">//计算文件的MD5值</span></span><br><span class="line"> <span class="function">ifstream <span class="title">inputStream</span><span class="params">(<span class="string">&quot;test.txt&quot;</span>, ios::binary)</span></span>;</span><br><span class="line"> MD5Engine md5;</span><br><span class="line"> <span class="function">DigestOutputStream <span class="title">dos</span><span class="params">(md5)</span></span>;</span><br><span class="line"> StreamCopier::<span class="built_in">copyStream</span>(inputStream, dos);</span><br><span class="line"> dos.<span class="built_in">close</span>();</span><br><span class="line"> cout &lt;&lt; DigestEngine::<span class="built_in">digestToHex</span>(md<span class="number">5.</span><span class="built_in">digest</span>()) &lt;&lt; std::endl;</span><br><span class="line"> cout &lt;&lt; <span class="string">&quot;完成md5值的计算&quot;</span> &lt;&lt; endl;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">//计算字符串的MD5值</span></span><br><span class="line"> std::string INPUT_STRING = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"> <span class="function">stringstream <span class="title">stringStream</span><span class="params">(INPUT_STRING)</span></span>;</span><br><span class="line"> StreamCopier::<span class="built_in">copyStream</span>(stringStream, dos);</span><br><span class="line"> dos.<span class="built_in">close</span>();</span><br><span class="line"> cout &lt;&lt; DigestEngine::<span class="built_in">digestToHex</span>(md<span class="number">5.</span><span class="built_in">digest</span>()) &lt;&lt; std::endl;</span><br><span class="line"> cout &lt;&lt; <span class="string">&quot;字符串md5值计算完毕&quot;</span> &lt;&lt; endl;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">//对文件进行base64加密</span></span><br><span class="line"> <span class="function">ifstream <span class="title">base64EncodeInputStream</span><span class="params">(<span class="string">&quot;test.txt&quot;</span>, ios::binary)</span></span>;</span><br><span class="line"> <span class="function">ofstream <span class="title">base64EncodeOutputStream</span><span class="params">(<span class="string">&quot;encoderesult.txt&quot;</span>)</span></span>;</span><br><span class="line"> <span class="function">Base64Encoder <span class="title">encoder</span><span class="params">(base64EncodeOutputStream)</span></span>;</span><br><span class="line"> StreamCopier::<span class="built_in">copyStream</span>(base64EncodeInputStream, encoder);</span><br><span class="line"> cout &lt;&lt; <span class="string">&quot;完成base64加密&quot;</span> &lt;&lt; endl;</span><br><span class="line"> encoder.<span class="built_in">close</span>();</span><br><span class="line"> </span><br><span class="line"> <span class="comment">//对文件进行解密</span></span><br><span class="line"> <span class="function">ofstream <span class="title">base64DecodeOutputStream</span><span class="params">(<span class="string">&quot;decoderesult.txt&quot;</span>)</span></span>;</span><br><span class="line"> <span class="function">ifstream <span class="title">base64DecodeInputStream</span><span class="params">(<span class="string">&quot;encoderesult.txt&quot;</span>)</span></span>;</span><br><span class="line"> <span class="function">Base64Decoder <span class="title">decoder</span><span class="params">(base64DecodeInputStream)</span></span>;</span><br><span class="line"> StreamCopier::<span class="built_in">copyStream</span>(decoder,base64DecodeOutputStream);</span><br><span class="line"> </span><br><span class="line"> <span class="comment">//对字符串进行加密</span></span><br><span class="line"> <span class="function">stringstream <span class="title">strbase64encodeinputstream</span><span class="params">(string(<span class="string">&quot;ceshibase64&quot;</span>))</span></span>;</span><br><span class="line"> string strbase64encodeoutputStr;</span><br><span class="line"> stringstream strencodeOutputStream;</span><br><span class="line"> </span><br><span class="line"> <span class="function">Base64Encoder <span class="title">stringencodr</span><span class="params">(strencodeOutputStream)</span></span>;</span><br><span class="line"> StreamCopier::<span class="built_in">copyStream</span>(strbase64encodeinputstream, stringencodr);</span><br><span class="line"> stringencodr.<span class="built_in">close</span>();</span><br><span class="line"> strencodeOutputStream &gt;&gt; strbase64encodeoutputStr;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">//对字符串进行解密</span></span><br><span class="line"> <span class="function">stringstream <span class="title">strdecodeInputstream</span><span class="params">(strbase64encodeoutputStr)</span></span>;</span><br><span class="line"> stringstream strdecodeOutputstream;</span><br><span class="line"> string decodeResult;</span><br><span class="line"> <span class="function">Base64Decoder <span class="title">stringdecoder</span><span class="params">(strdecodeInputstream)</span></span>;</span><br><span class="line"> StreamCopier::<span class="built_in">copyStream</span>(stringdecoder, strdecodeOutputstream);</span><br><span class="line"> strdecodeOutputstream &gt;&gt; decodeResult;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">//计算文件的HMAC-MD5值</span></span><br><span class="line"> <span class="function">string <span class="title">passphrase</span><span class="params">(<span class="string">&quot;hmac-key&quot;</span>)</span></span>;</span><br><span class="line"> <span class="function">ifstream <span class="title">hmacinputStream</span><span class="params">(<span class="string">&quot;test.txt&quot;</span>, ios::binary)</span></span>;</span><br><span class="line"> </span><br><span class="line"> <span class="function">HMACEngine&lt;MD5Engine&gt; <span class="title">hmac</span><span class="params">(passphrase)</span></span>;</span><br><span class="line"> <span class="function">DigestOutputStream <span class="title">hmacdos</span><span class="params">(hmac)</span></span>;</span><br><span class="line"> StreamCopier::<span class="built_in">copyStream</span>(hmacinputStream, hmacdos);</span><br><span class="line"> hmacdos.<span class="built_in">close</span>();</span><br><span class="line"> cout &lt;&lt; DigestEngine::<span class="built_in">digestToHex</span>(hmac.<span class="built_in">digest</span>()) &lt;&lt; std::endl;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">//计算字符串的HMAC-MD5值</span></span><br><span class="line"> <span class="function">stringstream <span class="title">hmacStrinputStream</span><span class="params">(<span class="string">&quot;ceshishiyong&quot;</span>)</span></span>;</span><br><span class="line"> <span class="function">HMACEngine&lt;MD5Engine&gt; <span class="title">hStrmac</span><span class="params">(passphrase)</span></span>;</span><br><span class="line"> <span class="function">DigestOutputStream <span class="title">hmaStrcdos</span><span class="params">(hStrmac)</span></span>;</span><br><span class="line"> StreamCopier::<span class="built_in">copyStream</span>(hmacStrinputStream, hmaStrcdos);</span><br><span class="line"> hmaStrcdos.<span class="built_in">close</span>();</span><br><span class="line"> cout &lt;&lt; DigestEngine::<span class="built_in">digestToHex</span>(hStrmac.<span class="built_in">digest</span>()) &lt;&lt; std::endl;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="使用Poco库来搭建服务程序"><a class="header-anchor" href="#使用Poco库来搭建服务程序">※</a>使用Poco库来搭建服务程序</h2><p>服务的程序类似于一个线程池程序，每个人物都是是一个子线程运行在对应的线程池当中。线程池的程序类似于下面:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Util/ServerApplication.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Logger.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyServer</span> : <span class="keyword">public</span> Poco::Util::ServerApplication</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">     <span class="built_in">MyServer</span>();</span><br><span class="line">     <span class="keyword">virtual</span> ~ <span class="built_in">MyServer</span>();</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Poco::Util::ServerApplication overridables</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">initialize</span><span class="params">(Poco::Util::Application &amp;self)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">uninitialize</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">const</span> std::vector&lt;std::string&gt;&amp; args)</span> <span class="keyword">override</span></span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"> <span class="function"><span class="type">void</span> <span class="title">createLogDir</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>线程池管理器就是所谓的服务器主程序，主程序继承自Poco::Utils::ServerApplication</p><p>主要重写三个接口</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//initialize是初始化接口，在初始化服务器的时候被调用，做些初始化操作</span></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">initialize</span><span class="params">(Poco::Util::Application &amp;self)</span> <span class="keyword">override</span></span>;</span><br><span class="line"><span class="comment">//uninitialize是清理操作，在服务器终止的时候被调用，做一些清理的操作</span></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">uninitialize</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line"><span class="comment">//main是主函数主要负责对应的主程序</span></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">const</span> std::vector&lt;std::string&gt;&amp; args)</span> <span class="keyword">override</span></span>;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MyServer.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/TaskManager.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/AutoPtr.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/ConsoleChannel.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/FileChannel.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/SplitterChannel.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/FormattingChannel.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/PatternFormatter.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/SimpleFileChannel.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Shlobj.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Shlwapi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WinBase.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyServer::initialize</span><span class="params">(Poco::Util::Application &amp;self)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ServerApplication::<span class="built_in">initialize</span>(self);</span><br><span class="line">    <span class="built_in">logger</span>().<span class="built_in">information</span>(<span class="string">&quot;Service is starting up&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyServer::uninitialize</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">logger</span>().<span class="built_in">information</span>(<span class="string">&quot;Service is shutting down&quot;</span>);</span><br><span class="line">    ServerApplication::<span class="built_in">uninitialize</span>();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">int</span>  <span class="title">MyServer::main</span><span class="params">(<span class="type">const</span> std::vector&lt;std::string&gt;&amp; args)</span></span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line"> HANDLE hMutext = <span class="built_in">CreateMutexA</span>(<span class="literal">NULL</span>, TRUE, <span class="string">&quot; My-service-mutext&quot;</span>);</span><br><span class="line">    <span class="built_in">logger</span>().<span class="built_in">information</span>(<span class="string">&quot;Service is running as %s ...&quot;</span>, </span><br><span class="line">        <span class="built_in">config</span>().<span class="built_in">getBool</span>(<span class="string">&quot;application.runAsService&quot;</span>, <span class="literal">false</span>) </span><br><span class="line">            ? std::<span class="built_in">string</span>(<span class="string">&quot;service&quot;</span>) : std::<span class="built_in">string</span>(<span class="string">&quot;command line&quot;</span>));</span><br><span class="line"> </span><br><span class="line">    Poco::TaskManager taskManager;</span><br><span class="line"> <span class="comment">//版本更新</span></span><br><span class="line">    taskManager.<span class="built_in">start</span>(<span class="keyword">new</span> <span class="built_in">UpdateTask</span>());</span><br><span class="line">    <span class="comment">//等待任务取消</span></span><br><span class="line">    <span class="built_in">waitForTerminationRequest</span>();</span><br><span class="line">    taskManager.<span class="built_in">cancelAll</span>();</span><br><span class="line">    <span class="comment">//等待取消操作完成</span></span><br><span class="line">    taskManager.<span class="built_in">joinAll</span>();</span><br><span class="line"> </span><br><span class="line"> <span class="built_in">ReleaseMutex</span>(hMutext);</span><br><span class="line"> hMutext = INVALID_HANDLE_VALUE;</span><br><span class="line">   <span class="keyword">return</span> Application::EXIT_OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>服务器中的每个人物都是一个线程类似于QT中的QRunnable</p><p>Poco中的程序中的每一个人物都继承于Task类，</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Task.h&quot;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyUpdateTask</span> : <span class="keyword">public</span> Poco::Task</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MyUpdateTask</span>();</span><br><span class="line">    <span class="keyword">virtual</span> ~ <span class="built_in">MyUpdateTask</span>();</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Poco::Task overridables</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//runTask是入口函数</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">runTask</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>主函数中启动服务程序的方法</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MyServer.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _DEBUG</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> HYPYServer server;</span><br><span class="line"> server.<span class="built_in">main</span>(std::<span class="built_in">vector</span>&lt;std::string&gt;());</span><br><span class="line"> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="built_in">POCO_SERVER_MAIN</span>(HYPYServer)</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h2 id="使用Poco库进行Https请求访问服务器"><a class="header-anchor" href="#使用Poco库进行Https请求访问服务器">※</a>使用Poco库进行Https请求访问服务器</h2><h3 id="https-Get-请求"><a class="header-anchor" href="#https-Get-请求">※</a>https Get 请求</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">UpdateTask::fetchUpdateInfoFromHTTPServer</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//请求的参数</span></span><br><span class="line">    std::string arg1 = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">    std::string arg2 = <span class="string">&quot;2&quot;</span>;</span><br><span class="line">    std::string arg3 = <span class="string">&quot;3&quot;</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//拼接对应的请求</span></span><br><span class="line"> Config config;</span><br><span class="line">    std::string path = <span class="string">&quot;/api/v1/update&quot;</span>;</span><br><span class="line">    Poco::URI uri;</span><br><span class="line">    uri.<span class="built_in">setScheme</span>(config.<span class="built_in">getServerScheme</span>());</span><br><span class="line">    uri.<span class="built_in">setHost</span>(config.<span class="built_in">getServerAddr</span>());</span><br><span class="line">    uri.<span class="built_in">setPort</span>(config.<span class="built_in">getServerPort</span>());</span><br><span class="line">    uri.<span class="built_in">setPath</span>(path);</span><br><span class="line">    uri.<span class="built_in">addQueryParameter</span>(<span class="string">&quot;arg1&quot;</span>, arg1);</span><br><span class="line">    uri.<span class="built_in">addQueryParameter</span>(<span class="string">&quot;arg2&quot;</span>, arg2);</span><br><span class="line">    uri.<span class="built_in">addQueryParameter</span>(<span class="string">&quot;arg3&quot;</span>, arg3);</span><br><span class="line"> </span><br><span class="line"> Poco::Net::HTTPSClientSession* https_session = OSUtils::CommonUtils::<span class="built_in">GetHttpsClientSession</span>();</span><br><span class="line"> https_session-&gt;<span class="built_in">setPort</span>(uri.<span class="built_in">getPort</span>());</span><br><span class="line"> https_session-&gt;<span class="built_in">setHost</span>(uri.<span class="built_in">getHost</span>());</span><br><span class="line">    <span class="function">std::string <span class="title">pathAndQuery</span><span class="params">(uri.getPathAndQuery())</span></span>;</span><br><span class="line">    </span><br><span class="line">    Poco::<span class="function">Net::HTTPRequest <span class="title">request</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        Poco::Net::HTTPRequest::HTTP_GET, pathAndQuery,</span></span></span><br><span class="line"><span class="params"><span class="function">        Poco::Net::HTTPMessage::HTTP_1_1)</span></span>;</span><br><span class="line">    Poco::Net::HTTPResponse response;</span><br><span class="line"> https_session-&gt;<span class="built_in">sendRequest</span>(request);</span><br><span class="line">    std::istream &amp;streamIn = https_session-&gt;<span class="built_in">receiveResponse</span>(response);</span><br><span class="line"> </span><br><span class="line">    std::ostringstream responseStream;</span><br><span class="line">    Poco::StreamCopier::<span class="built_in">copyStream</span>(streamIn, responseStream);</span><br><span class="line"> </span><br><span class="line">    m_responseContent = responseStream.<span class="built_in">str</span>();</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">delete</span> https_session;</span><br><span class="line"> https_session = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">return</span> response.<span class="built_in">getStatus</span>() == Poco::Net::HTTPResponse::HTTP_OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="HTTP-POST下载请求"><a class="header-anchor" href="#HTTP-POST下载请求">※</a>HTTP POST下载请求</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">MyUpdateTask::UpdateWork</span><span class="params">(std::string loginid, std::string clientid, std::string&amp; filePath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="keyword">try</span></span><br><span class="line"> &#123;</span><br><span class="line">  Config config;</span><br><span class="line">  std::string path = <span class="string">&quot;/api/v1/dict/download&quot;</span>;</span><br><span class="line">  Poco::URI uri;</span><br><span class="line">  uri.<span class="built_in">setScheme</span>(config.<span class="built_in">getServerScheme</span>());</span><br><span class="line">  uri.<span class="built_in">setHost</span>(config.<span class="built_in">getServerAddr</span>());</span><br><span class="line">  uri.<span class="built_in">setPort</span>(config.<span class="built_in">getServerPort</span>());</span><br><span class="line">  uri.<span class="built_in">setPath</span>(path);</span><br><span class="line"> </span><br><span class="line">  Poco::Net::HTTPSClientSession* https_session = OSUtils::CommonUtils::<span class="built_in">GetHttpsClientSession</span>();</span><br><span class="line">  https_session-&gt;<span class="built_in">setHost</span>(uri.<span class="built_in">getHost</span>());</span><br><span class="line">  https_session-&gt;<span class="built_in">setPort</span>(uri.<span class="built_in">getPort</span>());</span><br><span class="line"> </span><br><span class="line">  Poco::<span class="function">Net::HTTPRequest <span class="title">request</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">   Poco::Net::HTTPRequest::HTTP_POST, uri.getPathAndQuery(),</span></span></span><br><span class="line"><span class="params"><span class="function">   Poco::Net::HTTPMessage::HTTP_1_1)</span></span>;</span><br><span class="line"> </span><br><span class="line">  Poco::Net::HTMLForm form;</span><br><span class="line">  form.<span class="built_in">add</span>(<span class="string">&quot;loginid&quot;</span>, loginid);</span><br><span class="line">  form.<span class="built_in">add</span>(<span class="string">&quot;clientid&quot;</span>, clientid);</span><br><span class="line">  form.<span class="built_in">prepareSubmit</span>(request);</span><br><span class="line"> </span><br><span class="line">  form.<span class="built_in">write</span>(https_session-&gt;<span class="built_in">sendRequest</span>(request));</span><br><span class="line"> </span><br><span class="line">  Poco::Net::HTTPResponse response;</span><br><span class="line">  std::istream &amp;streamIn = https_session-&gt;<span class="built_in">receiveResponse</span>(response);</span><br><span class="line"> </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (response.<span class="built_in">getStatus</span>() != Poco::Net::HTTPResponse::HTTP_OK)</span><br><span class="line">  &#123;</span><br><span class="line">   <span class="keyword">delete</span> https_session;</span><br><span class="line">   https_session = <span class="literal">nullptr</span>;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  std::ostringstream responseStream;</span><br><span class="line">  Poco::StreamCopier::<span class="built_in">copyStream</span>(streamIn, responseStream);</span><br><span class="line">  std::string resultStr = responseStream.<span class="built_in">str</span>();</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">delete</span> https_session;</span><br><span class="line">  https_session = <span class="literal">nullptr</span>;</span><br><span class="line"> </span><br><span class="line">  Poco::JSON::Parser parser;</span><br><span class="line">  <span class="keyword">auto</span> root = parser.<span class="built_in">parse</span>(resultStr);</span><br><span class="line">  Poco::JSON::Object::Ptr objRoot = root.<span class="built_in">extract</span>&lt;Poco::JSON::Object::Ptr&gt;();</span><br><span class="line">  <span class="keyword">if</span> (!objRoot)</span><br><span class="line">   <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line"> </span><br><span class="line">  <span class="type">int</span> codeResult = objRoot-&gt;<span class="built_in">getValue</span>&lt;<span class="type">int</span>&gt;(<span class="string">&quot;code&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (codeResult == <span class="number">200</span>)</span><br><span class="line">  &#123;</span><br><span class="line">   </span><br><span class="line">   dictFilePath = objRoot-&gt;<span class="built_in">getValue</span>&lt;std::string&gt;(<span class="string">&quot;result&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> codeResult;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="built_in">catch</span> (...)</span><br><span class="line"> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="https-Post-MultiPart请求"><a class="header-anchor" href="#https-Post-MultiPart请求">※</a>https Post MultiPart请求</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">MyUpdateTask::UpdateWork</span><span class="params">(std::string loginid, std::string clientid, std::string path)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="keyword">try</span></span><br><span class="line"> &#123;</span><br><span class="line">        <span class="comment">//获得对应的请求参数</span></span><br><span class="line">  Config config;</span><br><span class="line">  std::string path = <span class="string">&quot;/api/v1/dict/ceshi&quot;</span>;</span><br><span class="line">  Poco::URI uri;</span><br><span class="line">  uri.<span class="built_in">setScheme</span>(config.<span class="built_in">getServerScheme</span>());</span><br><span class="line">  uri.<span class="built_in">setHost</span>(config.<span class="built_in">getServerAddr</span>());</span><br><span class="line">  uri.<span class="built_in">setPort</span>(config.<span class="built_in">getServerPort</span>());</span><br><span class="line">  uri.<span class="built_in">setPath</span>(path);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//获得对应的会话客户端</span></span><br><span class="line">  Poco::Net::HTTPSClientSession* https_session = OSUtils::CommonUtils::<span class="built_in">GetHttpsClientSession</span>();</span><br><span class="line">  https_session-&gt;<span class="built_in">setHost</span>(uri.<span class="built_in">getHost</span>());</span><br><span class="line">  https_session-&gt;<span class="built_in">setPort</span>(uri.<span class="built_in">getPort</span>());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//生成对应的请求</span></span><br><span class="line">  Poco::<span class="function">Net::HTTPRequest <span class="title">request</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">   Poco::Net::HTTPRequest::HTTP_POST, uri.getPathAndQuery(),</span></span></span><br><span class="line"><span class="params"><span class="function">   Poco::Net::HTTPMessage::HTTP_1_1)</span></span>;</span><br><span class="line">  request.<span class="built_in">setContentType</span>(<span class="string">&quot;multipart/form-data&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//在表单中添加对应的参数和文件</span></span><br><span class="line">  Poco::Net::HTMLForm form;</span><br><span class="line">  form.<span class="built_in">setEncoding</span>(Poco::Net::HTMLForm::ENCODING_MULTIPART);</span><br><span class="line">  form.<span class="built_in">add</span>(<span class="string">&quot;loginid&quot;</span>, loginid);</span><br><span class="line">  form.<span class="built_in">add</span>(<span class="string">&quot;clientid&quot;</span>, clientid);</span><br><span class="line">  form.<span class="built_in">addPart</span>(<span class="string">&quot;dict&quot;</span>, <span class="keyword">new</span> Poco::Net::<span class="built_in">FilePartSource</span>(path));</span><br><span class="line">  form.<span class="built_in">prepareSubmit</span>(request);</span><br><span class="line">  form.<span class="built_in">write</span>(https_session-&gt;<span class="built_in">sendRequest</span>(request));</span><br><span class="line">  Poco::Net::HTTPResponse response;</span><br><span class="line">  std::istream &amp;streamIn = https_session-&gt;<span class="built_in">receiveResponse</span>(response);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (response.<span class="built_in">getStatus</span>() != Poco::Net::HTTPResponse::HTTP_OK)</span><br><span class="line">  &#123;</span><br><span class="line">   <span class="keyword">delete</span> https_session;</span><br><span class="line">   https_session = <span class="literal">nullptr</span>;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line"> </span><br><span class="line">  std::ostringstream responseStream;</span><br><span class="line">  Poco::StreamCopier::<span class="built_in">copyStream</span>(streamIn, responseStream);</span><br><span class="line">  std::string resultStr = responseStream.<span class="built_in">str</span>();</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">delete</span> https_session;</span><br><span class="line">  https_session = <span class="literal">nullptr</span>;</span><br><span class="line">  </span><br><span class="line">  Poco::JSON::Parser parser;</span><br><span class="line">  <span class="keyword">auto</span> root = parser.<span class="built_in">parse</span>(resultStr);</span><br><span class="line">  Poco::JSON::Object::Ptr objRoot = root.<span class="built_in">extract</span>&lt;Poco::JSON::Object::Ptr&gt;();</span><br><span class="line">  <span class="keyword">if</span> (!objRoot)</span><br><span class="line">   <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line"> </span><br><span class="line">  <span class="type">int</span> codeResult = objRoot-&gt;<span class="built_in">getValue</span>&lt;<span class="type">int</span>&gt;(<span class="string">&quot;code&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span>(codeResult == <span class="number">200</span>)</span><br><span class="line">  &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> codeResult;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="built_in">catch</span> (...)</span><br><span class="line"> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="通过URL下载文件"><a class="header-anchor" href="#通过URL下载文件">※</a>通过URL下载文件</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Poco::URI <span class="title">uri</span><span class="params">(addrs.at(index).fileUrl)</span></span>;</span><br><span class="line">Poco::Net::HTTPSClientSession* https_session = OSUtils::CommonUtils::<span class="built_in">GetHttpsClientSession</span>();</span><br><span class="line">https_session-&gt;<span class="built_in">setPort</span>(uri.<span class="built_in">getPort</span>());</span><br><span class="line">https_session-&gt;<span class="built_in">setHost</span>(uri.<span class="built_in">getHost</span>());</span><br><span class="line"> </span><br><span class="line">Poco::<span class="function">Net::HTTPRequest <span class="title">request</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function"> Poco::Net::HTTPRequest::HTTP_GET, uri.getPathAndQuery(),</span></span></span><br><span class="line"><span class="params"><span class="function"> Poco::Net::HTTPMessage::HTTP_1_1)</span></span>;</span><br><span class="line">Poco::Net::HTTPResponse response;</span><br><span class="line">https_session-&gt;<span class="built_in">sendRequest</span>(request);</span><br><span class="line">std::istream &amp;streamIn = https_session-&gt;<span class="built_in">receiveResponse</span>(response);</span><br><span class="line"><span class="keyword">if</span> (response.<span class="built_in">getStatus</span>() == Poco::Net::HTTPResponse::HTTP_OK)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="使用到的生成https请求的客户端"><a class="header-anchor" href="#使用到的生成https请求的客户端">※</a>使用到的生成https请求的客户端</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Poco::Net::HTTPSClientSession* OSUtils::CommonUtils::<span class="built_in">GetHttpsClientSession</span>()</span><br><span class="line">&#123;</span><br><span class="line"> std::string certificate_path = OSUtils::PathUtils::<span class="built_in">getCertificatePath</span>();</span><br><span class="line"> <span class="function">SSLManager::InvalidCertificateHandlerPtr <span class="title">handlerPtr</span><span class="params">(<span class="keyword">new</span> AcceptCertificateHandler(<span class="literal">false</span>))</span></span>;</span><br><span class="line"> Context::Ptr context = <span class="keyword">new</span> <span class="built_in">Context</span>(Context::TLSV1_2_CLIENT_USE, certificate_path, Poco::Net::Context::VERIFY_NONE, <span class="number">9</span>);</span><br><span class="line"> SSLManager::<span class="built_in">instance</span>().<span class="built_in">initializeClient</span>(<span class="literal">nullptr</span>, handlerPtr, context);</span><br><span class="line"> HTTPSClientSession *session = <span class="keyword">new</span> <span class="built_in">HTTPSClientSession</span>(context);</span><br><span class="line"> session-&gt;<span class="built_in">setTimeout</span>(<span class="number">5000</span> * <span class="number">1000</span>);</span><br><span class="line"> <span class="type">int</span> timeout_sec = session-&gt;<span class="built_in">getTimeout</span>().<span class="built_in">seconds</span>();</span><br><span class="line"> <span class="keyword">return</span> session;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Poco库解压缩文件"><a class="header-anchor" href="#Poco库解压缩文件">※</a>Poco库解压缩文件</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ifstream <span class="title">instream</span><span class="params">(filepath, ios::binary)</span></span>;</span><br><span class="line">Poco::<span class="function">Zip::Decompress <span class="title">decompress</span><span class="params">(instream, fileDir)</span></span>;</span><br><span class="line">decompress.<span class="built_in">decompressAllFiles</span>();</span><br><span class="line">instream.<span class="built_in">close</span>();</span><br><span class="line"><span class="function">File  <span class="title">zip_file</span><span class="params">(filepath)</span></span>;</span><br><span class="line"><span class="keyword">if</span> (zip_file.<span class="built_in">exists</span>())</span><br><span class="line"> zip_file.<span class="built_in">remove</span>();</span><br></pre></td></tr></table></figure><h2 id="POCO库中文编程参考指南（11）如何使用Reactor框架？"><a class="header-anchor" href="#POCO库中文编程参考指南（11）如何使用Reactor框架？">※</a>POCO库中文编程参考指南（11）如何使用Reactor框架？<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></h2><h2 id="Poco-Reactor模式-SocketReactor-StreamSocket"><a class="header-anchor" href="#Poco-Reactor模式-SocketReactor-StreamSocket">※</a>Poco Reactor模式 SocketReactor StreamSocket<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup></h2><p>使用方法</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Poco::Observer&lt;MyEventHandler, SocketNotification&gt; <span class="title">obs</span><span class="params">(*<span class="keyword">this</span>, &amp;MyEventHandler::handleMyEvent)</span></span>;</span><br><span class="line">reactor.<span class="built_in">addEventHandler</span>(obs);</span><br><span class="line"></span><br><span class="line"><span class="function">Poco::Observer&lt;MyEventHandler, SocketNotification&gt; <span class="title">obs</span><span class="params">(*<span class="keyword">this</span>, &amp;MyEventHandler::handleMyEvent)</span></span>;</span><br><span class="line">reactor.<span class="built_in">removeEventHandler</span>(obs);</span><br></pre></td></tr></table></figure><p>示例</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TCPClient</span> : <span class="keyword">public</span> Poco::Runnable</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">TCPClient</span>(std::string master_ip, Poco::UInt16 master_port) : <span class="built_in">master_ip_</span>(master_ip), <span class="built_in">master_port_</span>(master_port)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">connect</span>();</span><br><span class="line">        <span class="built_in">register_handle</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">TCPClient</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;~TCPClient()!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">stop</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">connect</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        Poco::<span class="function">Net::SocketAddress <span class="title">sa</span><span class="params">(master_ip_, master_port_)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            socket_.<span class="built_in">connect</span>(sa);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (socket_.<span class="built_in">impl</span>() != <span class="literal">NULL</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (socket_.<span class="built_in">impl</span>()-&gt;<span class="built_in">sockfd</span>() != POCO_INVALID_SOCKET)</span><br><span class="line">                &#123;</span><br><span class="line"></span><br><span class="line">                    std::cout &lt;&lt; <span class="string">&quot;connect Succeed&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">catch</span> (Poco::Net::ConnectionRefusedException &amp;)</span><br><span class="line">        &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;connect ConnectionRefusedException&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            ret = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">catch</span> (Poco::Net::InvalidSocketException &amp;)</span><br><span class="line">        &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;connect InvalidSocketException&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            ret = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">catch</span> (Poco::Net::NetException &amp;)</span><br><span class="line">        &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;connect NetException&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            ret = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">catch</span> (Poco::TimeoutException &amp;)</span><br><span class="line">        &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;connect time out&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            ret = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">catch</span> (Poco::IOException &amp;)</span><br><span class="line">        &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;connect IOException&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            ret = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">register_handle</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        reactor_.<span class="built_in">addEventHandler</span>(socket_, Poco::<span class="built_in">NObserver</span>&lt;TCPClient, Poco::Net::ReadableNotification&gt;(*<span class="keyword">this</span>, &amp;TCPClient::onSocketReadable));</span><br><span class="line">        reactor_.<span class="built_in">addEventHandler</span>(socket_, Poco::<span class="built_in">NObserver</span>&lt;TCPClient, Poco::Net::WritableNotification&gt;(*<span class="keyword">this</span>, &amp;TCPClient::onSocketWritable));</span><br><span class="line">        reactor_.<span class="built_in">addEventHandler</span>(socket_, Poco::<span class="built_in">NObserver</span>&lt;TCPClient, Poco::Net::ShutdownNotification&gt;(*<span class="keyword">this</span>, &amp;TCPClient::onSocketShutdown));</span><br><span class="line">        reactor_.<span class="built_in">addEventHandler</span>(socket_, Poco::<span class="built_in">NObserver</span>&lt;TCPClient, Poco::Net::ErrorNotification&gt;(*<span class="keyword">this</span>, &amp;TCPClient::onSocketError));</span><br><span class="line">        reactor_.<span class="built_in">addEventHandler</span>(socket_, Poco::<span class="built_in">NObserver</span>&lt;TCPClient, Poco::Net::TimeoutNotification&gt;(*<span class="keyword">this</span>, &amp;TCPClient::onSocketTimeout));</span><br><span class="line"></span><br><span class="line">        std::string data = <span class="string">&quot;register_handle!&quot;</span>;</span><br><span class="line">        std::cout &lt;&lt; data &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">unregister_handle</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::string data = <span class="string">&quot;unregister_handle!&quot;</span>;</span><br><span class="line">        std::cout &lt;&lt; data &lt;&lt; std::endl;</span><br><span class="line">        reactor_.<span class="built_in">removeEventHandler</span>(socket_, Poco::<span class="built_in">NObserver</span>&lt;TCPClient, Poco::Net::ReadableNotification&gt;(*<span class="keyword">this</span>, &amp;TCPClient::onSocketReadable));</span><br><span class="line">        reactor_.<span class="built_in">removeEventHandler</span>(socket_, Poco::<span class="built_in">NObserver</span>&lt;TCPClient, Poco::Net::WritableNotification&gt;(*<span class="keyword">this</span>, &amp;TCPClient::onSocketWritable));</span><br><span class="line">        reactor_.<span class="built_in">removeEventHandler</span>(socket_, Poco::<span class="built_in">NObserver</span>&lt;TCPClient, Poco::Net::ShutdownNotification&gt;(*<span class="keyword">this</span>, &amp;TCPClient::onSocketShutdown));</span><br><span class="line">        reactor_.<span class="built_in">removeEventHandler</span>(socket_, Poco::<span class="built_in">NObserver</span>&lt;TCPClient, Poco::Net::ErrorNotification&gt;(*<span class="keyword">this</span>, &amp;TCPClient::onSocketError));</span><br><span class="line">        reactor_.<span class="built_in">removeEventHandler</span>(socket_, Poco::<span class="built_in">NObserver</span>&lt;TCPClient, Poco::Net::TimeoutNotification&gt;(*<span class="keyword">this</span>, &amp;TCPClient::onSocketTimeout));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">stop</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">unregister_handle</span>();</span><br><span class="line"></span><br><span class="line">        socket_.<span class="built_in">close</span>();</span><br><span class="line">        reactor_.<span class="built_in">stop</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        reactor_.<span class="built_in">run</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onSocketReadable</span><span class="params">(<span class="type">const</span> Poco::AutoPtr&lt;Poco::Net::ReadableNotification&gt; &amp;pNf)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;ReadableNotification!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> data[<span class="number">1025</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="type">int</span> len = socket_.<span class="built_in">receiveBytes</span>(data, <span class="number">1024</span>);</span><br><span class="line">        <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;receiveBytes:&quot;</span> &lt;&lt; data &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot; onSocketReadable error&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            <span class="built_in">stop</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onSocketWritable</span><span class="params">(<span class="type">const</span> Poco::AutoPtr&lt;Poco::Net::WritableNotification&gt; &amp;pNf)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// std::cout &lt;&lt; &quot;WritableNotification&quot; &lt;&lt; std::endl;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onSocketShutdown</span><span class="params">(<span class="type">const</span> Poco::AutoPtr&lt;Poco::Net::ShutdownNotification&gt; &amp;pNf)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// std::cout &lt;&lt; &quot;ShutdownNotification!&quot; &lt;&lt; std::endl;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onSocketError</span><span class="params">(<span class="type">const</span> Poco::AutoPtr&lt;Poco::Net::ErrorNotification&gt; &amp;pNf)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// std::cout &lt;&lt; &quot;ErrorNotification!&quot; &lt;&lt; std::endl;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onSocketTimeout</span><span class="params">(<span class="type">const</span> Poco::AutoPtr&lt;Poco::Net::TimeoutNotification&gt; &amp;pNf)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// std::cout &lt;&lt; &quot;TimeoutNotification!&quot; &lt;&lt; std::endl;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onIdleNotification</span><span class="params">(<span class="type">const</span> Poco::AutoPtr&lt;Poco::Net::IdleNotification&gt; &amp;pNf)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// std::cout &lt;&lt; &quot;IdleNotification!&quot; &lt;&lt; std::endl;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string master_ip_;</span><br><span class="line">    Poco::UInt16 master_port_;</span><br><span class="line">    Poco::Net::StreamSocket socket_;</span><br><span class="line">    Poco::Net::SocketReactor reactor_;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::string server_ip = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">    Poco::UInt16 server_port = <span class="number">2001</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">TCPClient <span class="title">c</span><span class="params">(server_ip, server_port)</span></span>;</span><br><span class="line"></span><br><span class="line">    Poco::Thread thread;</span><br><span class="line">    thread.<span class="built_in">start</span>(c);</span><br><span class="line">    thread.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="POCO库中文编程参考指南（11）如何使用Reactor框架？-v2"><a class="header-anchor" href="#POCO库中文编程参考指南（11）如何使用Reactor框架？-v2">※</a>POCO库中文编程参考指南（11）如何使用Reactor框架？<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup></h2><h3 id="Reactor-框架概述"><a class="header-anchor" href="#Reactor-框架概述">※</a>Reactor 框架概述</h3><p>POCO 中的 Reactor 框架是基于 Reactor 设计模式进行设计的。其中由 Handler 将某 Socket 产生的事件，发送到指定的对象的方法上，作为回调。</p><h3 id="光说不练假把式"><a class="header-anchor" href="#光说不练假把式">※</a>光说不练假把式</h3><p>PoechantReactorServer 类，基本与 PoechantTCPServer：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PoechantReactorServer</span>: <span class="keyword">public</span> ServerApplication</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">PoechantServer</span>() &#123;&#125; <span class="comment">//: _helpRequested(false) &#123;&#125;</span></span><br><span class="line">    ~<span class="built_in">PoechantServer</span>() &#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">initialize</span><span class="params">(Application&amp; self)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">loadConfiguration</span>();</span><br><span class="line">        ServerApplication::<span class="built_in">initialize</span>(self);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">uninitialize</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ServerApplication::<span class="built_in">uninitialize</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">const</span> std::vector&lt;std::string&gt;&amp; args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// …</span></span><br><span class="line">        <span class="keyword">return</span> Application::EXIT_OK;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>PoechantServiceHandler 类定义如下。起重机把onReadable和onShutdown的声音带来很大的麻烦</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PoechantServiceHandler</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">PoechantServiceHandler</span>(StreamSocket&amp; socket, SocketReactor&amp; reactor)；</span><br><span class="line">    ~<span class="built_in">PoechantServiceHandler</span>();</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onReadable</span><span class="params">(<span class="type">const</span> AutoPtr&lt;ReadableNotification&gt;&amp; pNf)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onShutdown</span><span class="params">(<span class="type">const</span> AutoPtr&lt;ShutdownNotification&gt;&amp; pNf)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">enum</span></span><br><span class="line">    &#123;</span><br><span class="line">        BUFFER_SIZE = <span class="number">1024</span></span><br><span class="line">    &#125;;</span><br><span class="line">    StreamSocket _socket;</span><br><span class="line">    SocketReactor&amp; _reactor;</span><br><span class="line">    <span class="type">char</span> *_pBuffer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>PoechantServiceHandler 实现：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">PoechantServiceHandler::<span class="built_in">PoechantServiceHandler</span>(StreamSocket&amp; socket, SocketReactor&amp; reactor)</span><br><span class="line">    :_socket(socket),</span><br><span class="line">     _reactor(reactor),</span><br><span class="line">     _pBuffer(<span class="keyword">new</span> <span class="type">char</span>[BUFFER_SIZE])</span><br><span class="line">&#123;</span><br><span class="line">    Application&amp; app = Application::<span class="built_in">instance</span>();</span><br><span class="line">    app.<span class="built_in">logger</span>().<span class="built_in">information</span>(<span class="string">&quot;Connection from&quot;</span> + socket.<span class="built_in">peerAddress</span>().<span class="built_in">toString</span>());</span><br><span class="line">    _reactor.<span class="built_in">addEventHandler</span>(_socket,</span><br><span class="line">        <span class="built_in">NObserver</span>&lt;PoechantServiceHandler,</span><br><span class="line">            ReadableNotification&gt;(*<span class="keyword">this</span>, &amp;PoechantServiceHandler::onReadable));</span><br><span class="line">    _reactor.<span class="built_in">addEventHandler</span>(_socket,</span><br><span class="line">        <span class="built_in">NObserver</span>&lt;PoechantServiceHandler,</span><br><span class="line">            ShutdownNotification&gt;(*<span class="keyword">this</span>, &amp;PoechantServiceHandler::onShutdown));</span><br><span class="line">&#125;</span><br><span class="line">~<span class="built_in">PoechantServiceHandler</span>()</span><br><span class="line">&#123;</span><br><span class="line">    Application&amp; app = Application::<span class="built_in">instance</span>();</span><br><span class="line">    app.<span class="built_in">logger</span>().<span class="built_in">information</span>(<span class="string">&quot;Disconnecting &quot;</span> + _socket.<span class="built_in">peerAddress</span>().<span class="built_in">toString</span>());</span><br><span class="line">    _reactor.<span class="built_in">removeEventHandler</span>(_socket,</span><br><span class="line">        <span class="built_in">NObserver</span>&lt;PoechantServiceHandler,</span><br><span class="line">            ReadableNotification&gt;(*<span class="keyword">this</span>, &amp;PoechantServiceHandler::onReadable));</span><br><span class="line">    _reactor.<span class="built_in">removeEventHandler</span>(_socket,</span><br><span class="line">        <span class="built_in">NObserver</span>&lt;PoechantServiceHandler,</span><br><span class="line">            ShutdownNotification&gt;(*<span class="keyword">this</span>, &amp;PoechantServiceHandler::onShutdown));</span><br><span class="line">    <span class="keyword">delete</span> [] _pBuffer;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">onReadable</span><span class="params">(<span class="type">const</span> AutoPtr&lt;ReadableNotification&gt;&amp; pNf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Receive data from StreamSocket</span></span><br><span class="line">    <span class="type">int</span> n = _socket.<span class="built_in">receiveBytes</span>(_pBuffer, BUFFER_SIZE);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Send data back the client </span></span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">0</span>)</span><br><span class="line">        _socket.<span class="built_in">sendBytes</span>(_pBuffer, n);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">delete</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// When ShutdownNotification is detected, this method will be invoked.</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">onShutdown</span><span class="params">(<span class="type">const</span> AutoPtr&lt;ShutdownNotification&gt;&amp; pNf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">delete</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">const</span> std::vector&lt;std::string&gt;&amp; args)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> port = (<span class="type">unsigned</span> <span class="type">short</span>) <span class="built_in">config</span>().<span class="built_in">getInt</span>(<span class="string">&quot;PoechantReactor.port&quot;</span>, <span class="number">12345</span>);</span><br><span class="line">    <span class="function">ServerSocket <span class="title">serverSocket</span><span class="params">(port)</span></span>;</span><br><span class="line">    SocketReactor reactor;</span><br><span class="line">    <span class="function">SocketAcceptor&lt;PoechantServiceHandler&gt; <span class="title">acceptor</span><span class="params">(serverSocket, reactor)</span></span>;</span><br><span class="line"> </span><br><span class="line">    reactor.<span class="built_in">run</span>();</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">waitForTerminationRequest</span>();</span><br><span class="line">    reactor.<span class="built_in">stop</span>();</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> Application::EXIT_OK;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">PoechantServer</span>().<span class="built_in">run</span>(argc, argv);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Clinet-测试代码"><a class="header-anchor" href="#Clinet-测试代码">※</a>Clinet 测试代码</h3><p>同《<a target="_blank" rel="noopener external nofollow noreferrer" href="http://blog.csdn.net/poechant/article/details/7484781">POCO库中文编程参考指南（10）如何使用TCPServer框架？</a>》中的 Client 测试用例。</p><h2 id="Reactor模式以及Poco-SocketReactor-源码浅析"><a class="header-anchor" href="#Reactor模式以及Poco-SocketReactor-源码浅析">※</a>Reactor模式以及Poco SocketReactor 源码浅析<sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup></h2><h3 id="常见的五种IO模式"><a class="header-anchor" href="#常见的五种IO模式">※</a>常见的五种IO模式</h3><hr><p>服务器端编程经常需要构造高性能的IO模型，Unix下可用的IO模型有五种：</p><ol><li><strong>阻塞式IO</strong></li><li><strong>非阻塞式IO</strong></li><li><strong>IO复用（select/poll/epoll）</strong></li><li><strong>信号驱动式IO（SIGIO）</strong></li><li><strong>异步IO（Asynchronous IO）</strong></li></ol><h4 id="同步和异步"><a class="header-anchor" href="#同步和异步">※</a>同步和异步</h4><p>描述的是用户线程调用IO操作相关的系统调用时，是否需要等待内核IO操作完成。</p><p><strong>区别</strong>：</p><ul><li><p>同步IO操作：<strong>需要等待</strong>内核IO操作完成。用户线程在调用系统调用时，会向内核发起IO操作的请求，内核会立即执行IO操作，只有IO操作完成时才会返回。</p></li><li><p>异步IO操作：<strong>不需要等待</strong>内核IO操作完成。用户线程调用系统调用时，向内核发起IO操作请求后，<strong>立即返回</strong>。内核接收到请求后会自行执行IO操作，当数据就绪时，直接将数据从内核缓冲区复制到用户缓冲区，并<strong>通知</strong>用户线程。</p></li></ul><p>异步IO需要操作系统支持，目前有Lunix 的 AIO 和 Windows 的 IOCP 。</p><h4 id="阻塞与非阻塞式IO"><a class="header-anchor" href="#阻塞与非阻塞式IO">※</a>阻塞与非阻塞式IO</h4><p>描述的是内核的IO操作是否需要等待数据就绪。</p><p><strong>区别</strong>：</p><table><thead><tr><th></th><th>读</th><th>写</th></tr></thead><tbody><tr><td>阻 塞IO</td><td>内核会等待直到网络数据到达并复制到应用进程的缓冲区中或者发生错误才返回，期间会挂起线程</td><td>内核会直到将用户数据复制到内核缓冲区中或者发生错误才返回，期间会挂起线程</td></tr><tr><td>非阻塞IO</td><td>如果有数据到达，内核将会复制到用户缓冲区并返回，如果没有数据到达，则将立即返回一个EWOULDBLOCK错误</td><td>如果内核缓冲区有空间，则将其复制到内核缓冲区，如果内核缓冲区已满，则立即返回一个EWOULDBLOCK错误</td></tr><tr><td></td><td></td><td></td></tr></tbody></table><p>通常在实际使用中，阻塞IO会挂起用户线程，不会造成负担，但非阻塞IO需要用户去进行轮询才能保证数据及时收到，会耗费大量CPU时间。</p><p>阻塞IO流程图：</p><p><img src="http://leiyiming.com/img/in-post/post-poco/reactor/1.png" alt=""></p><p>非阻塞IO流程图：</p><p><img src="http://leiyiming.com/img/in-post/post-poco/reactor/2.png" alt="2"></p><h4 id="IO复用"><a class="header-anchor" href="#IO复用">※</a>IO复用</h4><p>IO复用的关键在于使用多路分离器（select/poll/epoll）去监听 socket 是否就绪，并返回相应的事件和文件描述符。</p><p><strong>IO多路复用模型</strong>的流程图如下图所示，使用select可以避免非阻塞IO模型中轮询等待的问题。用户首先将需要监视的socket添加到select中，当数据到达时，select被激活，select函数返回，用户线程发起read请求，读取数据并继续执行。</p><p><img src="http://leiyiming.com/img/in-post/post-poco/reactor/3.png" alt="3"></p><p>从流程上来看，IO 复用并没有比同步阻塞模型有更大的优势，甚至还多了添加监视socket，以及调用select函数的额外操作。但是，使用 IO 复用最大的优势是<strong>可以在一个线程内同时处理多个socket的IO请求</strong>。用户可以注册多个socket，不断地调用多路分离函数获得就绪的文件描述符，然后进行IO操作，即可达到在同一个线程内同时处理多个IO请求的目的。而在同步阻塞模型中，必须通过多线程的方式才能达到这个目的。</p><h3 id="Reactor-模式"><a class="header-anchor" href="#Reactor-模式">※</a>Reactor 模式</h3><hr><p>在上述的多路IO复用模型中，其实用户线程可以通过辅助线程去等待select函数的返回结果，当select函数返回时，辅助线程通过消息通知用户线程，用户现场根据消息来确定就绪的socket，然后发起读写请求。<strong>Reactor模式</strong> 的原理就与此类似，其流程图如下：</p><p><img src="http://leiyiming.com/img/in-post/post-poco/reactor/4.png" alt="4"></p><p>用户线程通过向 <strong>Reactor</strong> 注册事件处理器，并立即返回执行后续操作，Reactor进行调用 <code>select</code> 请求，并轮询其结果，当select函数返回即有可读的socket时，Reactor就通知用户线程，执行注册的事件处理器进行数据的读取、处理工作。其类图如下：</p><p><img src="http://leiyiming.com/img/in-post/post-poco/reactor/5.png" alt="5"></p><p><strong>Handle</strong>：Linux上的文件操作符，Windows上的句柄，在网络编程中通常是Socket。这里统称事件源。</p><p><strong>Event Demutiplexer</strong>：多路复用器。由操作系统提供的IO多路复用机制，比如 select/epoll 。使用时用户需要将其关心的事件源注册到多路复用器上，当有事件发生时，多路复用器会从多个事件源中选出对应的事件源。</p><p><strong>Reactor</strong>：事件管理的接口，提供对外的注册事件和注销事件的接口，内部则使用多路复用器注册和注销事件；运行时启动事件循环，当有事件进入就绪状态时，通知事件处理器，通过注册事件的回调函数处理事件。</p><p><strong>Enevt Handler</strong>：事件处理的接口类，每个接口对应了一种类型的事件，供Reactor在相应事件发生时调用，执行相应的事件处理。</p><h3 id="Poco-中的-Reactor"><a class="header-anchor" href="#Poco-中的-Reactor">※</a>Poco 中的 Reactor</h3><hr><p>Poco中实现了Reactor模式，并整合了Acceptor-Connetor模式的服务器。下面是Poco中Reactor包的重要的类的概述：</p><p><strong>SocketReactor</strong>：模式中的Reactor，提供了注册事件和注销事件的接口。</p><p><strong>SocketNotifier</strong>：模式内部用于通知事件处理器的类。</p><p><strong>SocketAcceptor</strong>：Acceptor-Connetor模式的Acceptor。</p><p><strong>SocketConnector</strong>：Acceptor-Connetor模式的Connetor。</p><p><strong>ParallelSocketAcceptor</strong>：多线程版的 SocketAcceptor，与单线程版唯一的区别在于构造和轮询中被声明和使用的 SocketReactor 对象的个数（缺省值等于处理器个数）。</p><p><strong>SocketNotification</strong>：SocketReactor 生成的所有消息的基类。一共有六个派生类，分别是： ErrorNotification，IdleNotification，ReadableNotification，ShutdownNotification，TimeoutNotification，WritableNotification。</p><h3 id="使用方法"><a class="header-anchor" href="#使用方法">※</a>使用方法</h3><hr><h4 id="Reactor"><a class="header-anchor" href="#Reactor">※</a>Reactor</h4><p><strong>SocketReactor</strong> 提供了注册事件和注销事件的接口，第一个参数代表了事件源，第二个参数代表了注册的事件处理器，这里使用了Poco的Observer。当某个 socket 就绪时，Observer就会接收到相应的消息，来根据不同的消息类型调用不同的回调函数进行处理。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">addEventHandler</span><span class="params">(<span class="type">const</span> Socket&amp; socket, <span class="type">const</span> Poco::AbstractObserver&amp; observer)</span></span>;</span><br><span class="line"> <span class="comment">/// Registers an event handler with the SocketReactor.</span></span><br><span class="line"> <span class="comment">///</span></span><br><span class="line"> <span class="comment">/// Usage:</span></span><br><span class="line"> <span class="comment">///     Poco::Observer&lt;MyEventHandler, SocketNotification&gt; obs(*this, &amp;MyEventHandler::handleMyEvent);</span></span><br><span class="line"> <span class="comment">///     reactor.addEventHandler(obs);</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">removeEventHandler</span><span class="params">(<span class="type">const</span> Socket&amp; socket, <span class="type">const</span> Poco::AbstractObserver&amp; observer)</span></span>;</span><br><span class="line"> <span class="comment">/// Unregisters an event handler with the SocketReactor.</span></span><br><span class="line"> <span class="comment">///</span></span><br><span class="line"> <span class="comment">/// Usage:</span></span><br><span class="line"> <span class="comment">///     Poco::Observer&lt;MyEventHandler, SocketNotification&gt; obs(*this, &amp;MyEventHandler::handleMyEvent);</span></span><br><span class="line"> <span class="comment">///     reactor.removeEventHandler(obs);</span></span><br></pre></td></tr></table></figure><h4 id="SocketAcceptor"><a class="header-anchor" href="#SocketAcceptor">※</a>SocketAcceptor</h4><p>在Poco中使用了 <strong>SocketAcceptor</strong> 来监听客户端的连接，其采用了经典的Acceptor-Connetor模式，将客户端服务端解耦为三个组件，分别是：<strong>Acceptors</strong>，<strong>Connectors</strong> 和 <strong>Service Handlers</strong>。</p><p><strong>SocketAcceptor 的工作原理</strong>：它有一个重要的模板参数 <strong>class ServiceHandler</strong> 。构造时需要传入 SocketReactor 和 ServerSocket 对象的引用，然后向 SocketReactor 对象注册传入的 <strong>ServerSocket</strong> 和对 <strong>ReadableNotification</strong> 关心的 Observer，这个 Observer 在内部会注册一个 <code>onAccept</code> 回调函数。</p><p>当有客户端发起连接请求时，ServerSocket 被 select 选中，Observer 接收到 ReadableNotification 消息并调用 <code>onAccept</code> ，然后创建一个 <strong>ServiceHandler</strong> 对象。</p><p>ServiceHandler 对象的作用就是和客户端进行通信，其在Reactor模式中对应的就是Event Handler，只不过 Poco 中使用了自己的消息机制，不需要用户自己通过多态来实现消息通知，所以用户需要做的只是实现 ServiceHandler 。</p><p>下面的代码就是开启服务器的代码，分别声明一个 ServerSocket 对象，一个 SocketReactor 对象，一个 ParallelSocketAcceptor 对象，然后调用 SocketReactor 的 <code>run</code> 方法就可以了，当有客户端连接时，会自动生成一个 ServerHandler 对象处理连接。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Poco::<span class="function">Net::ServerSocket <span class="title">serverSocket</span><span class="params">(<span class="number">4569</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">Poco::Net::SocketReactor reactor;</span><br><span class="line"></span><br><span class="line">Poco::<span class="function">Net::ParallelSocketAcceptor&lt;ServerHandler, Poco::Net::SocketReactor&gt; <span class="title">acceptor</span><span class="params">(serverSocket, reactor)</span></span>;</span><br><span class="line"></span><br><span class="line">reactor.<span class="built_in">run</span>();</span><br></pre></td></tr></table></figure><h4 id="ServiceHandler"><a class="header-anchor" href="#ServiceHandler">※</a>ServiceHandler</h4><p>ServiceHandler 的责任是提供处理消息的回调函数，并向 SocketReactor 注册 Observer。当对应事件发生时，SocketReactor 能根据被 select 的 socket 向某个 Observer 发出特定的消息，对应的回调函数就能够执行相应的处理。</p><p>首先，设计 ServiceHandler 时，它的构造函数必须只含有 StreamSocket 和 ServiceReactor 类型的引用参数。例如：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">MyServiceHandler</span>(<span class="type">const</span> StreamSocket&amp; socket, ServiceReactor&amp; reactor)</span><br></pre></td></tr></table></figure><p>其次，ServiceHandler 必须提供相应 SocketNotification 的 Observer 并添加回调函数，并且需要调用 SocketReactor 的 <code>addEventHandler</code> 方法来注册。这样就可以正常使用了Poco的Reactor模式了。</p><p>ServerHandler 示例声明：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ServerHandler</span> : <span class="keyword">public</span> Poco::RefCountedObject &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ServerHandler</span>(Poco::Net::StreamSocket&amp; socket, Poco::Net::SocketReactor&amp; reactor);</span><br><span class="line">    ~<span class="built_in">ServerHandler</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//回调函数</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">OnReadable</span><span class="params">(Poco::Net::ReadableNotification* pNf)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">OnWriteable</span><span class="params">(Poco::Net::WritableNotification* pNf)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">OnError</span><span class="params">(Poco::Net::ErrorNotification* pNf)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">OnTimeout</span><span class="params">(Poco::Net::TimeoutNotification* pNf)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">OnShutdown</span><span class="params">(Poco::Net::ShutdownNotification* pNf)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Poco::Net::StreamSocket         _socket;</span><br><span class="line">    Poco::Net::SocketReactor&amp;       _reactor;</span><br><span class="line">  </span><br><span class="line">    Poco::Observer&lt;ServerHandler, Poco::Net::ReadableNotification&gt; _or;</span><br><span class="line">    Poco::Observer&lt;ServerHandler, Poco::Net::WritableNotification&gt; _ow;</span><br><span class="line">    Poco::Observer&lt;ServerHandler, Poco::Net::ErrorNotification&gt;    _oe;</span><br><span class="line">    Poco::Observer&lt;ServerHandler, Poco::Net::TimeoutNotification&gt;  _ot;</span><br><span class="line">    Poco::Observer&lt;ServerHandler, Poco::Net::ShutdownNotification&gt; _os;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>实现：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">ServerHandler::<span class="built_in">ServerHandler</span>(StreamSocket &amp; socket, SocketReactor &amp; reactor)</span><br><span class="line">    :_logger(Poco::Logger::<span class="built_in">get</span>(<span class="string">&quot;ReactorServer.ServerHandler&quot;</span>))</span><br><span class="line">    , _socket(socket)</span><br><span class="line">    , _reactor(reactor)</span><br><span class="line">    , _or(*<span class="keyword">this</span>, &amp;ServerHandler::OnReadable)</span><br><span class="line">    , _ow(*<span class="keyword">this</span>, &amp;ServerHandler::OnWriteable)</span><br><span class="line">    , _oe(*<span class="keyword">this</span>, &amp;ServerHandler::OnError)</span><br><span class="line">    , _ot(*<span class="keyword">this</span>, &amp;ServerHandler::OnTimeout)</span><br><span class="line">    , _os(*<span class="keyword">this</span>, &amp;ServerHandler::OnShutdown)</span><br><span class="line">&#123;</span><br><span class="line">    _address = socket.<span class="built_in">peerAddress</span>().<span class="built_in">toString</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">AddReactorEventHandlers</span>();</span><br><span class="line"></span><br><span class="line">    _socket.<span class="built_in">setNoDelay</span>(<span class="literal">true</span>);</span><br><span class="line">    _socket.<span class="built_in">setBlocking</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ServerHandler::~<span class="built_in">ServerHandler</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">RemoveReactorEventHandlers</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ServerHandler::AddReactorEventHandlers</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    _reactor.<span class="built_in">addEventHandler</span>(_socket, _oe);</span><br><span class="line">    _reactor.<span class="built_in">addEventHandler</span>(_socket, _os);</span><br><span class="line">    _reactor.<span class="built_in">addEventHandler</span>(_socket, _or);</span><br><span class="line">    _reactor.<span class="built_in">addEventHandler</span>(_socket, _ow);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ServerHandler::RemoveReactorEventHandlers</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    _reactor.<span class="built_in">removeEventHandler</span>(_socket, _oe);</span><br><span class="line">    _reactor.<span class="built_in">removeEventHandler</span>(_socket, _os);</span><br><span class="line">    _reactor.<span class="built_in">removeEventHandler</span>(_socket, _or);</span><br><span class="line">    _reactor.<span class="built_in">removeEventHandler</span>(_socket, _ow);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>至此，Poco Reactor 基本的使用方法是这些了，关键在于实现 ServerHandler 并向 SocketReactor 注册，通过 SocketAcceptor 监听客户端连接，并自动生成 ServerHandler 实例。ServerHandler 中还可以根据用户自己的需求来进行扩展，比如实现读写缓冲区，解析包，心跳等等。</p><p>具体的项目移位链接：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/Missmiaom/ReactorServer.git">ReactorServer</a></p><h3 id="SocketReactor-核心代码解读"><a class="header-anchor" href="#SocketReactor-核心代码解读">※</a>SocketReactor 核心代码解读</h3><hr><p>Reactor 模式依赖于操作系统提供的 <code>select</code> 操作，<code>select</code> 能够轮询检查多个 Socket 的状态，包括检查可读状态，可写状态以及错误信息状态。当某个 Socket 的某一个状态就绪时，<code>select</code> 能够将其标识符置1，使用者可以根据标识符来判断 Socket 的状态。</p><p>在 Poco 的 Net 包中，<code>Poco::NET::Socket</code> 封装了操作系统提供 <code>select</code> 方法，并声明为静态函数，以供其他类使用，其声明如下：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">select</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  SocketList &amp; readList,</span></span></span><br><span class="line"><span class="params"><span class="function">  SocketList &amp; writeList,</span></span></span><br><span class="line"><span class="params"><span class="function">  SocketList &amp; exceptList,</span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="type">const</span> Poco::Timespan &amp; timeout</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure><p><code>SocketList</code> 由 <code>typedef std::vector&lt;Socket&gt; SocketList;</code> 声明。readList、writeList、exceptList 分别是需要轮询状态的 Sokcet 集合。</p><p>SocketReactor 会先将通过其 <code>addEventHandler</code> 方法注册的 Socket 按照是否注册消息类型来构建三个集合：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (EventHandlerMap::iterator it = _handlers.<span class="built_in">begin</span>(); it != _handlers.<span class="built_in">end</span>(); ++it)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (it-&gt;second-&gt;<span class="built_in">accepts</span>(_pReadableNotification))</span><br><span class="line">  &#123;</span><br><span class="line">    readable.<span class="built_in">push_back</span>(it-&gt;first);</span><br><span class="line">    nSockets++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (it-&gt;second-&gt;<span class="built_in">accepts</span>(_pWritableNotification))</span><br><span class="line">  &#123;</span><br><span class="line">    writable.<span class="built_in">push_back</span>(it-&gt;first);</span><br><span class="line">    nSockets++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (it-&gt;second-&gt;<span class="built_in">accepts</span>(_pErrorNotification))</span><br><span class="line">  &#123;</span><br><span class="line">    except.<span class="built_in">push_back</span>(it-&gt;first);</span><br><span class="line">    nSockets++;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后，通过 <code>Poco::NET::Socket::select</code> 方法将集合中准备就绪的 Socket 挑出（底层通过std::swap交换），然后向 Socket 的 Observer 发送相应通知，如果没有就绪的话就进入等待：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (nSockets == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">onIdle</span>();</span><br><span class="line">  Thread::<span class="built_in">trySleep</span>(_timeout.<span class="built_in">totalMilliseconds</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (Socket::<span class="built_in">select</span>(readable, writable, except, _timeout))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">onBusy</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (Socket::SocketList::iterator it = readable.<span class="built_in">begin</span>(); it != readable.<span class="built_in">end</span>(); ++it)</span><br><span class="line">   <span class="built_in">dispatch</span>(*it, _pReadableNotification);</span><br><span class="line">  <span class="keyword">for</span> (Socket::SocketList::iterator it = writable.<span class="built_in">begin</span>(); it != writable.<span class="built_in">end</span>(); ++it)</span><br><span class="line">   <span class="built_in">dispatch</span>(*it, _pWritableNotification);</span><br><span class="line">  <span class="keyword">for</span> (Socket::SocketList::iterator it = except.<span class="built_in">begin</span>(); it != except.<span class="built_in">end</span>(); ++it)</span><br><span class="line">   <span class="built_in">dispatch</span>(*it, _pErrorNotification);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="参考文献"><a class="header-anchor" href="#参考文献">※</a>参考文献</h3><hr><p><a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.cnblogs.com/fanzhidongyzby/p/4098546.html">高性能IO模型浅析</a></p><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://pocoproject.org/slides/200-Network.pdf">Poco官方文档之Network Programming</a></p><p><a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.cnblogs.com/xiehongfeng100/p/4820686.html">libevent之Reactor模式</a></p><h2 id="开源：Poco可移植组件库配置与使用"><a class="header-anchor" href="#开源：Poco可移植组件库配置与使用">※</a>开源：Poco可移植组件库配置与使用<sup class="footnote-ref"><a href="#fn5" id="fnref5">[5]</a></sup></h2><h3 id="环境配置"><a class="header-anchor" href="#环境配置">※</a>环境配置</h3><h4 id="Windows"><a class="header-anchor" href="#Windows">※</a>Windows</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cd poco</span><br><span class="line">mkdir cmake-build</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入build并编译</span></span><br><span class="line">cd cmake-build</span><br><span class="line">cmake ..</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">管理员身份运行</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">生成lib</span></span><br><span class="line">cmake --build . --config Release</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装</span></span><br><span class="line">cmake --build . --target install</span><br></pre></td></tr></table></figure><h4 id="Ubuntu"><a class="header-anchor" href="#Ubuntu">※</a>Ubuntu</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt安装</span></span><br><span class="line"><span class="built_in">sudo</span> apt install libpoco-dev</span><br><span class="line"><span class="comment"># 源码安装</span></span><br><span class="line"><span class="comment"># 安装依赖</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get install -y g++ make openssl libssl-dev</span><br><span class="line"><span class="comment"># 下载解压</span></span><br><span class="line">wget https://pocoproject.org/releases/poco-1.11.0/poco-1.11.0-all.tar.gz</span><br><span class="line">tar -xvf poco-1.11.0-all.tar.gz</span><br><span class="line"><span class="comment"># 编译</span></span><br><span class="line"><span class="built_in">cd</span> poco-1.11.0-all</span><br><span class="line">./configure --no-tests --no-samples</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake .. &amp;&amp; make</span><br><span class="line"><span class="built_in">sudo</span> make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 链接需要用到的组件，-lPocoFoundation -lPocoUtil -lPocoNet -lPocoXML是4个基本组件</span></span><br><span class="line">g++ -o main main.cpp -lPocoFoundation -lPocoUtil -lPocoNet -lPocoJSON &amp;&amp; ./main</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="web服务示例"><a class="header-anchor" href="#web服务示例">※</a>web服务示例</h3><p>官方示例，实现了一个简单的多线程web服务器，为单个HTML页面提供服务，使用Foundation, Net和Util库，生成的网页在8080端口：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Net/HTTPServer.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Net/HTTPRequestHandler.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Net/HTTPRequestHandlerFactory.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Net/HTTPServerRequest.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Net/HTTPServerResponse.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Net/ServerSocket.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Util/ServerApplication.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Poco;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Poco::Net;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Poco::Util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloRequestHandler</span>: <span class="keyword">public</span> HTTPRequestHandler</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handleRequest</span><span class="params">(HTTPServerRequest&amp; request, HTTPServerResponse&amp; response)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Application&amp; app = Application::<span class="built_in">instance</span>();</span><br><span class="line">        app.<span class="built_in">logger</span>().<span class="built_in">information</span>(<span class="string">&quot;Request from %s&quot;</span>, request.<span class="built_in">clientAddress</span>().<span class="built_in">toString</span>());</span><br><span class="line"></span><br><span class="line">        response.<span class="built_in">setChunkedTransferEncoding</span>(<span class="literal">true</span>);</span><br><span class="line">        response.<span class="built_in">setContentType</span>(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line"></span><br><span class="line">        response.<span class="built_in">send</span>()</span><br><span class="line">            &lt;&lt; <span class="string">&quot;&lt;html&gt;&quot;</span></span><br><span class="line">            &lt;&lt; <span class="string">&quot;&lt;head&gt;&lt;title&gt;Hello&lt;/title&gt;&lt;/head&gt;&quot;</span></span><br><span class="line">            &lt;&lt; <span class="string">&quot;&lt;body&gt;&lt;h1&gt;Hello from the POCO Web Server&lt;/h1&gt;&lt;/body&gt;&quot;</span></span><br><span class="line">            &lt;&lt; <span class="string">&quot;&lt;/html&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloRequestHandlerFactory</span>: <span class="keyword">public</span> HTTPRequestHandlerFactory</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">HTTPRequestHandler* <span class="title">createRequestHandler</span><span class="params">(<span class="type">const</span> HTTPServerRequest&amp;)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> HelloRequestHandler;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WebServerApp</span>: <span class="keyword">public</span> ServerApplication</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">initialize</span><span class="params">(Application&amp; self)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">loadConfiguration</span>();</span><br><span class="line">        ServerApplication::<span class="built_in">initialize</span>(self);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">const</span> std::vector&lt;std::string&gt;&amp;)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        UInt16 port = <span class="built_in">static_cast</span>&lt;UInt16&gt;(<span class="built_in">config</span>().<span class="built_in">getUInt</span>(<span class="string">&quot;port&quot;</span>, <span class="number">8080</span>));</span><br><span class="line"></span><br><span class="line">        <span class="function">HTTPServer <span class="title">srv</span><span class="params">(<span class="keyword">new</span> HelloRequestHandlerFactory, port)</span></span>;</span><br><span class="line">        srv.<span class="built_in">start</span>();</span><br><span class="line">        <span class="built_in">logger</span>().<span class="built_in">information</span>(<span class="string">&quot;HTTP Server started on port %hu.&quot;</span>, port);</span><br><span class="line">        <span class="built_in">waitForTerminationRequest</span>();</span><br><span class="line">        <span class="built_in">logger</span>().<span class="built_in">information</span>(<span class="string">&quot;Stopping HTTP Server...&quot;</span>);</span><br><span class="line">        srv.<span class="built_in">stop</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Application::EXIT_OK;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">POCO_SERVER_MAIN</span>(WebServerApp)</span><br></pre></td></tr></table></figure><p>编译运行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -o main main.cpp -lPocoFoundation -lPocoNet -lPocoUtil  &amp;&amp; ./main</span><br></pre></td></tr></table></figure><h3 id="Json解析示例"><a class="header-anchor" href="#Json解析示例">※</a>Json解析示例</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/JSON/Object.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/JSON/Parser.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Dynamic/Var.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/JSON/Stringifier.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/* 解析json &amp; 从文件中解析json */</span></span><br><span class="line">    std::string jsonString = <span class="string">R&quot;(&#123;&quot;name&quot;: &quot;John&quot;, &quot;age&quot;: 30, &quot;city&quot;: &quot;New York&quot;&#125;)&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// std::ifstream file(&quot;data.json&quot;);</span></span><br><span class="line">    <span class="comment">// if (!file.is_open()) &#123;</span></span><br><span class="line">    <span class="comment">//     std::cerr &lt;&lt; &quot;Failed to open file.&quot; &lt;&lt; std::endl;</span></span><br><span class="line">    <span class="comment">//     return 1;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// std::string jsonString((std::istreambuf_iterator&lt;char&gt;(file)), std::istreambuf_iterator&lt;char&gt;());</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建 JSON 解析器</span></span><br><span class="line">    Poco::JSON::Parser parser;</span><br><span class="line">    Poco::Dynamic::Var result;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 解析 JSON 字符串</span></span><br><span class="line">        result = parser.<span class="built_in">parse</span>(jsonString);</span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> Poco::Exception&amp; ex) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;JSON parsing error: &quot;</span> &lt;&lt; ex.<span class="built_in">displayText</span>() &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将解析结果转换为 Poco::JSON::Object 类型</span></span><br><span class="line">    Poco::JSON::Object::Ptr object = result.<span class="built_in">extract</span>&lt;Poco::JSON::Object::Ptr&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取和操作 JSON 对象中的值</span></span><br><span class="line">    std::string name = object-&gt;<span class="built_in">getValue</span>&lt;std::string&gt;(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">    <span class="type">int</span> age = object-&gt;<span class="built_in">getValue</span>&lt;<span class="type">int</span>&gt;(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">    std::string city = object-&gt;<span class="built_in">getValue</span>&lt;std::string&gt;(<span class="string">&quot;city&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印结果</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Name: &quot;</span> &lt;&lt; name &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Age: &quot;</span> &lt;&lt; age &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;City: &quot;</span> &lt;&lt; city &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 生成json &amp; 写入到json文件 */</span></span><br><span class="line">    <span class="comment">// 创建 JSON 对象</span></span><br><span class="line">    Poco::JSON::Object jsonObject;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加键值对</span></span><br><span class="line">    jsonObject.<span class="built_in">set</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;John&quot;</span>);</span><br><span class="line">    jsonObject.<span class="built_in">set</span>(<span class="string">&quot;age&quot;</span>, <span class="number">30</span>);</span><br><span class="line">    jsonObject.<span class="built_in">set</span>(<span class="string">&quot;city&quot;</span>, <span class="string">&quot;New York&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将 JSON 对象转换为字符串</span></span><br><span class="line">    std::ostringstream oss;</span><br><span class="line">    Poco::JSON::Stringifier::<span class="built_in">stringify</span>(jsonObject, oss);</span><br><span class="line"></span><br><span class="line">    std::string jsonString2 = oss.<span class="built_in">str</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印生成的 JSON 字符串</span></span><br><span class="line">    std::cout &lt;&lt; jsonString2 &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// // 写入 JSON 字符串到文件</span></span><br><span class="line">    <span class="comment">// std::ofstream file(&quot;data.json&quot;);</span></span><br><span class="line">    <span class="comment">// if (file.is_open()) &#123;</span></span><br><span class="line">    <span class="comment">//     file &lt;&lt; jsonString2;</span></span><br><span class="line">    <span class="comment">//     file.close();</span></span><br><span class="line">    <span class="comment">//     std::cout &lt;&lt; &quot;JSON data has been written to file.&quot; &lt;&lt; std::endl;</span></span><br><span class="line">    <span class="comment">// &#125; else &#123;</span></span><br><span class="line">    <span class="comment">//     std::cerr &lt;&lt; &quot;Failed to open file.&quot; &lt;&lt; std::endl;</span></span><br><span class="line">    <span class="comment">//     return 1;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="多线程示例"><a class="header-anchor" href="#多线程示例">※</a>多线程示例</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Thread.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Runnable.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyTask</span> : <span class="keyword">public</span> Poco::Runnable</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;Thread ID: &quot;</span> &lt;&lt; Poco::Thread::<span class="built_in">currentTid</span>()</span><br><span class="line">                      &lt;&lt; <span class="string">&quot;  Task ID: &quot;</span> &lt;&lt; i &lt;&lt; std::endl;</span><br><span class="line">            Poco::Thread::<span class="built_in">sleep</span>(<span class="number">1000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 创建线程任务对象</span></span><br><span class="line">    MyTask task;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建线程对象并启动</span></span><br><span class="line">    Poco::Thread thread;</span><br><span class="line">    thread.<span class="built_in">start</span>(task);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 主线程继续执行其他任务</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Main Thread ID: &quot;</span> &lt;&lt; Poco::Thread::<span class="built_in">currentTid</span>()</span><br><span class="line">                  &lt;&lt; <span class="string">&quot;  Main Task ID: &quot;</span> &lt;&lt; i &lt;&lt; std::endl;</span><br><span class="line">        Poco::Thread::<span class="built_in">sleep</span>(<span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 等待子线程结束</span></span><br><span class="line">    thread.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="日期时间示例"><a class="header-anchor" href="#日期时间示例">※</a>日期时间示例</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/DateTime.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/DateTimeFormatter.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 获取当前日期和时间</span></span><br><span class="line">    Poco::DateTime now;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 格式化日期和时间为字符串</span></span><br><span class="line">    std::string formattedDateTime = Poco::DateTimeFormatter::format(now, <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 输出格式化后的日期和时间</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Formatted Date and Time: &quot;</span> &lt;&lt; formattedDateTime &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取日期部分</span></span><br><span class="line">    <span class="function">Poco::DateTime <span class="title">date</span><span class="params">(now.year(), now.month(), now.day())</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 格式化日期为字符串</span></span><br><span class="line">    std::string formattedDate = Poco::DateTimeFormatter::format(date, <span class="string">&quot;%Y-%m-%d&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 输出格式化后的日期</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Formatted Date: &quot;</span> &lt;&lt; formattedDate &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="生成uuid示例"><a class="header-anchor" href="#生成uuid示例">※</a>生成uuid示例</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/UUIDGenerator.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/UUID.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 使用默认的UUID生成器</span></span><br><span class="line">    Poco::UUIDGenerator generator;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成一个随机UUID</span></span><br><span class="line">    Poco::UUID uuid1 = generator.<span class="built_in">createRandom</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成一个基于时间的UUID</span></span><br><span class="line">    Poco::UUID uuid2 = generator.<span class="built_in">createOne</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 输出UUID</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Random UUID: &quot;</span> &lt;&lt; uuid<span class="number">1.</span><span class="built_in">toString</span>() &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Time-based UUID: &quot;</span> &lt;&lt; uuid<span class="number">2.</span><span class="built_in">toString</span>() &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="poco-网络编程"><a class="header-anchor" href="#poco-网络编程">※</a>poco 网络编程<sup class="footnote-ref"><a href="#fn6" id="fnref6">[6]</a></sup></h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">讲一下，网络IO模型有哪几个种类，  </span><br><span class="line"> </span><br><span class="line">阻塞：</span><br><span class="line">1.一问一答(send()一个，recv() 一个)</span><br><span class="line">2.一问多答(send()一个，recv() 多个)</span><br><span class="line"> </span><br><span class="line">非阻塞：</span><br><span class="line">1.一个线程一直recv(), send() 按需发送</span><br><span class="line">2.一个线程send()，一个线程recv()</span><br><span class="line"> </span><br><span class="line">所有的网络IO模型 ,建议参考 陈硕 &lt;linux网络编程&gt;</span><br></pre></td></tr></table></figure><p>参考<a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/liu251/article/details/8351197">【翻译】两种高性能I/O设计模式(Reactor/Proactor)的比较</a></p><p>还需要根据自己的业务 确认使用长连接,短连接(有状态,无状态), TCP还是UDP, 服务端超时T线, 黑名单, !<br>如何使用POCO 最好还是应该从代码实现来看，确认各个类的继承关系，全部看完基本就知道，自己要用什么了。（使用参考TestSuit,Sample）</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">看需求，确认用哪个类，</span><br><span class="line">    - 如果你用http进行POST GET REQUEST处理，那么 *HTTP、HTTPClient、 HTTPServer*应该是你的选择，</span><br><span class="line">    - 如果你要用ping命令探查一些主机是否在线，那么就用*ICMP* 。</span><br><span class="line">    - 如果要用socket进行收发数据，</span><br><span class="line"></span><br><span class="line">   先确认 是写client端还是Server端, 使用TCP还是UDP，是阻塞还是非阻塞，是否有发广播等等...</span><br><span class="line">    client可以用：【Socket】中的Socket,StreamSocket, RawSocket,DatagramSocket...</span><br><span class="line"></span><br><span class="line">    Server可以用：【Socket】中的Socket,StreamSocket, RawSocket,DatagramSocket...  </span><br><span class="line">                  【Reactor】中的ParallelSocketAcceptor，ParallelSocketReactor，SocketAcceptor，SocketConnector，SocketNotification，SocketNotifier，SocketReactor</span><br><span class="line">                  【TCPServer】中的TCPServer，TCPServerConnection，TCPServerConnectionFactory，TCPServerDispatcher，TCPServerParams</span><br><span class="line">当然这只是其中的很小一部分。</span><br><span class="line">无状态，sendBytes()，recvBytes()都是不确定的</span><br><span class="line">首先sendBytes()有事件就发送，很简单没问题。</span><br><span class="line">那recvBytes()呢？如何一直接收数据？</span><br><span class="line"> </span><br><span class="line">这又回到更原始的问题，网络模型 select,poll，epoll，是什么，用什么实现的。</span><br><span class="line">我们知道，select,poll都是先把fd加入set中， 然后对set中所有fd进行轮训，确认是否可以read，write,或者exception.</span><br><span class="line">首先系统函数select中只是对set中所有的fd进行轮训一次。</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">那么select(),poll(),只是查询一次， 如果下次又来了数据怎么办？</span><br><span class="line">=&gt;只能用while()不管去轮训状态了，</span><br><span class="line">所以不断接收数据的模型是这样的</span><br><span class="line"></span><br><span class="line">windows select参考</span><br><span class="line">https://msdn.microsoft.com/en-us/library/system.net.sockets.socket.select(v=vs.110).aspx</span><br><span class="line">https://msdn.microsoft.com/en-us/library/windows/desktop/ms740141(v=vs.85).aspx</span><br><span class="line">unix-like 参考</span><br><span class="line">http://www.tenouk.com/Module41.html</span><br></pre></td></tr></table></figure><h2 id="使用poco库，实现tcp-client例子"><a class="header-anchor" href="#使用poco库，实现tcp-client例子">※</a>使用poco库，实现tcp client例子<sup class="footnote-ref"><a href="#fn7" id="fnref7">[7]</a></sup></h2><h3 id="base-socket-connector-h文件，可以不用改动"><a class="header-anchor" href="#base-socket-connector-h文件，可以不用改动">※</a>base_socket_connector.h文件，可以不用改动</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _BASE_SOCKET_CONNECTOR_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _BASE_SOCKET_CONNECTOR_H_</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Net/Net.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Net/SocketNotification.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Net/SocketAddress.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Net/StreamSocket.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Observer.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*CliSendCbFunc)</span><span class="params">(<span class="type">void</span> *send_args, <span class="type">unsigned</span> <span class="type">char</span> *send_data, <span class="type">int</span> max_send_len, <span class="type">int</span> &amp;send_len)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*CliRecvCbFunc)</span><span class="params">(<span class="type">void</span> *recv_args, <span class="type">unsigned</span> <span class="type">char</span> *recv_data, <span class="type">int</span> &amp;recv_len)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">TcpClientCallbackData</span></span><br><span class="line">&#123;</span><br><span class="line">    CliSendCbFunc send_loaddata; <span class="comment">// 装载待发送数据，send_data是要发送的数据，send_len是要发送的长度</span></span><br><span class="line">    CliRecvCbFunc recv_callback; <span class="comment">// 收到数据后的回调函数，recv_data是接收到的数据，recv_len是接收的数据长度</span></span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> *send_buf; <span class="comment">// 使用者提供的发送数据缓存空间，调用send_loaddata函数后，先将待发送数据拷贝到这里</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> *recv_buf; <span class="comment">// 使用者提供的接收数据缓存空间，当系统有可接收数据时，先接收到这里，再调用recv_callback，传递给使用者</span></span><br><span class="line">    <span class="type">int</span> send_len;            <span class="comment">// 实际发送数据的长度</span></span><br><span class="line">    <span class="type">int</span> max_send_len;        <span class="comment">// send_buf的最大长度</span></span><br><span class="line">    <span class="type">int</span> max_recv_len;        <span class="comment">// recv_buf的最大长度</span></span><br><span class="line"></span><br><span class="line">    <span class="type">void</span> *send_args; <span class="comment">// 存放使用者自己的私有数据</span></span><br><span class="line">    <span class="type">void</span> *recv_args; <span class="comment">// 存放使用者自己的私有数据</span></span><br><span class="line">&#125; TcpClientCallbackData;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">TcpClientHandle</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaseSocketConnector</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">BaseSocketConnector</span><span class="params">(Poco::Net::SocketAddress &amp;address)</span> : socket_reactor_(<span class="number">0</span>)</span></span><br><span class="line"><span class="function">    &#123;</span></span><br><span class="line">        stream_socket_.<span class="built_in">connectNB</span>(address);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">BaseSocketConnector</span>(Poco::Net::SocketAddress &amp;address,</span><br><span class="line">                        Poco::Net::SocketReactor &amp;reactor,</span><br><span class="line">                        TcpClientCallbackData &amp;tcp_client_callback) : <span class="built_in">socket_reactor_</span>(<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        stream_socket_.<span class="built_in">connectNB</span>(address);</span><br><span class="line">        <span class="built_in">RegisterConnector</span>(reactor);</span><br><span class="line"></span><br><span class="line">        tcp_client_callback_ = tcp_client_callback;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">BaseSocketConnector</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">UnregisterConnector</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">catch</span> (...)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">poco_unexpected</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">RegisterConnector</span><span class="params">(Poco::Net::SocketReactor &amp;reactor)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        socket_reactor_ = &amp;reactor;</span><br><span class="line">        socket_reactor_-&gt;<span class="built_in">addEventHandler</span>(stream_socket_, Poco::<span class="built_in">Observer</span>&lt;BaseSocketConnector, Poco::Net::ReadableNotification&gt;(*<span class="keyword">this</span>, &amp;BaseSocketConnector::OnReadable));</span><br><span class="line">        socket_reactor_-&gt;<span class="built_in">addEventHandler</span>(stream_socket_, Poco::<span class="built_in">Observer</span>&lt;BaseSocketConnector, Poco::Net::WritableNotification&gt;(*<span class="keyword">this</span>, &amp;BaseSocketConnector::OnWritable));</span><br><span class="line">        socket_reactor_-&gt;<span class="built_in">addEventHandler</span>(stream_socket_, Poco::<span class="built_in">Observer</span>&lt;BaseSocketConnector, Poco::Net::TimeoutNotification&gt;(*<span class="keyword">this</span>, &amp;BaseSocketConnector::OnTimeout));</span><br><span class="line">        socket_reactor_-&gt;<span class="built_in">addEventHandler</span>(stream_socket_, Poco::<span class="built_in">Observer</span>&lt;BaseSocketConnector, Poco::Net::ErrorNotification&gt;(*<span class="keyword">this</span>, &amp;BaseSocketConnector::OnError));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">UnregisterConnector</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (socket_reactor_)</span><br><span class="line">        &#123;</span><br><span class="line">            socket_reactor_-&gt;<span class="built_in">removeEventHandler</span>(stream_socket_, Poco::<span class="built_in">Observer</span>&lt;BaseSocketConnector, Poco::Net::ReadableNotification&gt;(*<span class="keyword">this</span>, &amp;BaseSocketConnector::OnReadable));</span><br><span class="line">            socket_reactor_-&gt;<span class="built_in">removeEventHandler</span>(stream_socket_, Poco::<span class="built_in">Observer</span>&lt;BaseSocketConnector, Poco::Net::WritableNotification&gt;(*<span class="keyword">this</span>, &amp;BaseSocketConnector::OnWritable));</span><br><span class="line">            socket_reactor_-&gt;<span class="built_in">removeEventHandler</span>(stream_socket_, Poco::<span class="built_in">Observer</span>&lt;BaseSocketConnector, Poco::Net::TimeoutNotification&gt;(*<span class="keyword">this</span>, &amp;BaseSocketConnector::OnTimeout));</span><br><span class="line">            socket_reactor_-&gt;<span class="built_in">removeEventHandler</span>(stream_socket_, Poco::<span class="built_in">Observer</span>&lt;BaseSocketConnector, Poco::Net::ErrorNotification&gt;(*<span class="keyword">this</span>, &amp;BaseSocketConnector::OnError));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">OnReadable</span><span class="params">(Poco::Net::ReadableNotification *readable_notification)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        readable_notification-&gt;<span class="built_in">release</span>();</span><br><span class="line">        <span class="type">int</span> err = stream_socket_.<span class="built_in">impl</span>()-&gt;<span class="built_in">socketError</span>();</span><br><span class="line">        <span class="keyword">if</span> (err)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">OnError</span>(err);</span><br><span class="line">            <span class="built_in">UnregisterConnector</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">OnConnect</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">OnWritable</span><span class="params">(Poco::Net::WritableNotification *writable_notification)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        writable_notification-&gt;<span class="built_in">release</span>();</span><br><span class="line">        <span class="built_in">OnConnect</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">OnConnect</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        stream_socket_.<span class="built_in">setBlocking</span>(<span class="literal">true</span>);</span><br><span class="line">        <span class="built_in">NewTcpClientHandle</span>();</span><br><span class="line">        <span class="built_in">UnregisterConnector</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">OnError</span><span class="params">(Poco::Net::ErrorNotification *error_notification)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        error_notification-&gt;<span class="built_in">release</span>();</span><br><span class="line">        <span class="built_in">OnError</span>(stream_socket_.<span class="built_in">impl</span>()-&gt;<span class="built_in">socketError</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">OnTimeout</span><span class="params">(Poco::Net::TimeoutNotification *timeout_notification)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        timeout_notification-&gt;<span class="built_in">release</span>();</span><br><span class="line">        <span class="built_in">OnError</span>(stream_socket_.<span class="built_in">impl</span>()-&gt;<span class="built_in">socketError</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">GetSendLen</span><span class="params">(<span class="type">int</span> &amp;send_len)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        send_len = tcp_client_callback_.send_len;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> TcpClientHandle *<span class="title">NewTcpClientHandle</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">TcpClientHandle</span>(stream_socket_, socket_reactor_, tcp_client_callback_);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">OnError</span><span class="params">(<span class="type">int</span> errorCode)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        socket_reactor_-&gt;<span class="built_in">stop</span>();</span><br><span class="line">        stream_socket_.<span class="built_in">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Poco::<span class="function">Net::SocketReactor *<span class="title">GetReactor</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> socket_reactor_;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Poco::<span class="function">Net::StreamSocket &amp;<span class="title">GetSocket</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stream_socket_;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">BaseSocketConnector</span>();</span><br><span class="line">    <span class="built_in">BaseSocketConnector</span>(<span class="type">const</span> BaseSocketConnector &amp;);</span><br><span class="line">    BaseSocketConnector &amp;<span class="keyword">operator</span>=(<span class="type">const</span> BaseSocketConnector &amp;);</span><br><span class="line"></span><br><span class="line">    Poco::Net::StreamSocket stream_socket_;</span><br><span class="line">    Poco::Net::SocketReactor *socket_reactor_;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    TcpClientCallbackData tcp_client_callback_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// _BASE_SOCKET_CONNECTOR_H_</span></span></span><br></pre></td></tr></table></figure><h3 id="base-tcp-client-h，根据应用，可以进行修改"><a class="header-anchor" href="#base-tcp-client-h，根据应用，可以进行修改">※</a>base_tcp_client.h，根据应用，可以进行修改</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _BASE_TCP_CLIENT_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _BASE_TCP_CLIENT_H_</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;base_socket_connector.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Net/Net.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Net/SocketNotification.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Net/SocketAddress.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Net/StreamSocket.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Observer.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaseTcpClient</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">BaseTcpClient</span>(Poco::Net::StreamSocket &amp;socket, </span><br><span class="line">                  Poco::Net::SocketReactor *reactor,</span><br><span class="line">                  TcpClientCallbackData &amp;tcp_client_callback) : <span class="built_in">socket_</span>(socket),</span><br><span class="line">                                                                <span class="built_in">reactor_</span>(reactor),</span><br><span class="line">                                                                <span class="built_in">on_readable_</span>(*<span class="keyword">this</span>, &amp;BaseTcpClient::OnReadable),</span><br><span class="line">                                                                <span class="built_in">on_writable_</span>(*<span class="keyword">this</span>, &amp;BaseTcpClient::OnWritable),</span><br><span class="line">                                                                <span class="built_in">on_timeout_</span>(*<span class="keyword">this</span>, &amp;BaseTcpClient::OnTimeout),</span><br><span class="line">                                                                <span class="built_in">timeout_</span>(<span class="literal">false</span>),</span><br><span class="line">                                                                <span class="built_in">close_on_timeout_</span>(<span class="literal">false</span>),</span><br><span class="line">                                                                <span class="built_in">tcp_client_callback_</span>(<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        tcp_client_callback_ = &amp;tcp_client_callback;</span><br><span class="line"></span><br><span class="line">        reactor_-&gt;<span class="built_in">addEventHandler</span>(socket_, on_readable_);</span><br><span class="line">        reactor_-&gt;<span class="built_in">addEventHandler</span>(socket_, on_writable_);</span><br><span class="line">        reactor_-&gt;<span class="built_in">addEventHandler</span>(socket_, on_timeout_);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">BaseTcpClient</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        reactor_-&gt;<span class="built_in">removeEventHandler</span>(socket_, Poco::<span class="built_in">Observer</span>&lt;BaseTcpClient, Poco::Net::ReadableNotification&gt;(*<span class="keyword">this</span>, &amp;BaseTcpClient::OnReadable));</span><br><span class="line">        reactor_-&gt;<span class="built_in">removeEventHandler</span>(socket_, Poco::<span class="built_in">Observer</span>&lt;BaseTcpClient, Poco::Net::WritableNotification&gt;(*<span class="keyword">this</span>, &amp;BaseTcpClient::OnWritable));</span><br><span class="line">        reactor_-&gt;<span class="built_in">removeEventHandler</span>(socket_, Poco::<span class="built_in">Observer</span>&lt;BaseTcpClient, Poco::Net::TimeoutNotification&gt;(*<span class="keyword">this</span>, &amp;BaseTcpClient::OnTimeout));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">OnReadable</span><span class="params">(Poco::Net::ReadableNotification *readable_notification)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> recv_len = <span class="number">0</span>;</span><br><span class="line">        readable_notification-&gt;<span class="built_in">release</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">NULL</span> == tcp_client_callback_)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        recv_len = socket_.<span class="built_in">receiveBytes</span>(tcp_client_callback_-&gt;recv_buf, tcp_client_callback_-&gt;max_recv_len);</span><br><span class="line">        <span class="keyword">if</span> (recv_len &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 使用者的回调函数，由使用者处理接收到的数据</span></span><br><span class="line">            tcp_client_callback_-&gt;<span class="built_in">recv_callback</span>(tcp_client_callback_-&gt;recv_args, tcp_client_callback_-&gt;recv_buf, recv_len);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;BaseTcpClient - Read Error.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">            reactor_-&gt;<span class="built_in">stop</span>();</span><br><span class="line">            socket_.<span class="built_in">close</span>();</span><br><span class="line">            <span class="keyword">delete</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">OnWritable</span><span class="params">(Poco::Net::WritableNotification *writable_notification)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        writable_notification-&gt;<span class="built_in">release</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">NULL</span> == tcp_client_callback_)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 回调获取使用者发送的数据</span></span><br><span class="line">        tcp_client_callback_-&gt;send_len = <span class="number">-1</span>;</span><br><span class="line">        tcp_client_callback_-&gt;<span class="built_in">send_loaddata</span>(tcp_client_callback_-&gt;send_args,</span><br><span class="line">                                            tcp_client_callback_-&gt;send_buf,</span><br><span class="line">                                            tcp_client_callback_-&gt;max_send_len,</span><br><span class="line">                                            tcp_client_callback_-&gt;send_len);</span><br><span class="line">        <span class="comment">// 待发送数据长度大于0</span></span><br><span class="line">        <span class="keyword">if</span> (tcp_client_callback_-&gt;send_len &gt;= <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 调用实际发送函数</span></span><br><span class="line">            tcp_client_callback_-&gt;send_len = socket_.<span class="built_in">sendBytes</span>(tcp_client_callback_-&gt;send_buf, tcp_client_callback_-&gt;send_len);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (tcp_client_callback_-&gt;send_len &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;BaseTcpClient - Wirte Error.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">OnTimeout</span><span class="params">(Poco::Net::TimeoutNotification *timeout_notification)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        timeout_notification-&gt;<span class="built_in">release</span>();</span><br><span class="line"></span><br><span class="line">        timeout_ = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (close_on_timeout_)</span><br><span class="line">        &#123;</span><br><span class="line">            reactor_-&gt;<span class="built_in">stop</span>();</span><br><span class="line">            socket_.<span class="built_in">close</span>();</span><br><span class="line">            <span class="keyword">delete</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    Poco::Net::StreamSocket socket_;</span><br><span class="line">    Poco::Net::SocketReactor *reactor_;</span><br><span class="line"></span><br><span class="line">    Poco::Observer&lt;BaseTcpClient, Poco::Net::ReadableNotification&gt; on_readable_;</span><br><span class="line">    Poco::Observer&lt;BaseTcpClient, Poco::Net::WritableNotification&gt; on_writable_;</span><br><span class="line">    Poco::Observer&lt;BaseTcpClient, Poco::Net::TimeoutNotification&gt; on_timeout_;</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> timeout_;</span><br><span class="line">    <span class="type">bool</span> close_on_timeout_;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    TcpClientCallbackData *tcp_client_callback_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// _BASE_TCP_CLIENT_H_</span></span></span><br></pre></td></tr></table></figure><h3 id="main-c："><a class="header-anchor" href="#main-c：">※</a>main.c：</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stddef.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;termios.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;uv.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Net/SocketReactor.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Net/SocketNotification.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Net/SocketAcceptor.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Net/ParallelSocketAcceptor.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Net/StreamSocket.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Net/ServerSocket.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Net/SocketAddress.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Observer.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Exception.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/LocalDateTime.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/DateTime.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/DateTimeFormat.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/DateTimeFormatter.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/DateTimeParser.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Mutex.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/Thread.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Poco/ThreadTarget.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;base_tcp_client.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Macro definition</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *****************************************************************************/</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CCT_CAMERA_SERVER_IP                        (<span class="string">&quot;127.0.0.1&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CCT_CAMERA_SERVER_PORT                      (8080)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Structure/Class definition</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_BUF_SIZE                2048</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_ONSEND_INTERVAL         10 <span class="comment">/// ms</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Data definition</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *****************************************************************************/</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="type">static</span> <span class="type">pthread_cond_t</span>   send_ready = PTHREAD_COND_INITIALIZER;</span><br><span class="line"><span class="type">static</span> <span class="type">pthread_mutex_t</span>  send_lock = PTHREAD_MUTEX_INITIALIZER;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">uint8_t</span>  user_send_buf[<span class="number">2048</span>];</span><br><span class="line"><span class="type">static</span> <span class="type">int</span>      user_send_len;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Function prototype</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *****************************************************************************/</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Function entity</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *****************************************************************************/</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PrintTimeStamp</span><span class="params">(<span class="type">char</span> *str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">struct</span>  <span class="title class_">timeval</span>     tv;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">gettimeofday</span>(&amp;tv, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Time Stamp - %s, %ld:%ld\n\r&quot;</span>, str, tv.tv_sec, tv.tv_usec);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">StartThread</span><span class="params">(<span class="type">void</span> *(*thread_entry)(<span class="type">void</span> *), <span class="type">void</span> *thread_para)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span>                 rtn;</span><br><span class="line">    <span class="type">pthread_attr_t</span>      thread_attr;</span><br><span class="line">    <span class="type">pthread_t</span>           thread_ID;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">pthread_attr_init</span>(&amp;thread_attr);</span><br><span class="line">    <span class="built_in">pthread_attr_setdetachstate</span>(&amp;thread_attr, PTHREAD_CREATE_DETACHED);</span><br><span class="line">    rtn = <span class="built_in">pthread_create</span>(&amp;thread_ID, &amp;thread_attr, thread_entry, thread_para);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> rtn;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UserSendFuncLoadData_</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">pthread_mutex_lock</span>(&amp;send_lock);</span><br><span class="line"></span><br><span class="line">    Poco::LocalDateTime now;</span><br><span class="line">    std::string time_str = Poco::DateTimeFormatter::format(now, Poco::DateTimeFormat::ISO8601_FRAC_FORMAT);</span><br><span class="line"></span><br><span class="line">    user_send_len = <span class="built_in">sprintf</span>((<span class="type">char</span> *)user_send_buf, <span class="string">&quot;Hello, %s&quot;</span>, time_str.<span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line">    user_send_buf[user_send_len] = <span class="number">0</span>;</span><br><span class="line">    user_send_len ++;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">pthread_cond_signal</span>(&amp;send_ready);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">pthread_mutex_unlock</span>(&amp;send_lock);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UserSendFuncLoadData</span><span class="params">(<span class="type">void</span> *send_args, <span class="type">unsigned</span> <span class="type">char</span> *send_data, <span class="type">int</span> max_send_len, <span class="type">int</span> &amp;send_len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">pthread_mutex_lock</span>(&amp;send_lock);</span><br><span class="line">    <span class="built_in">pthread_cond_wait</span>(&amp;send_ready, &amp;send_lock);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">strcpy</span>((<span class="type">char</span> *)send_data, (<span class="type">char</span> *)user_send_buf);</span><br><span class="line">    send_len = <span class="built_in">sprintf</span>((<span class="type">char</span> *)send_data, <span class="string">&quot;%s, %s\n\r&quot;</span>, (<span class="type">char</span> *)user_send_buf, (<span class="type">char</span> *)send_args);</span><br><span class="line">    send_data[send_len ++] = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//printf(&quot;%s - %s\n\r&quot;, __func__, send_data);</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">pthread_mutex_unlock</span>(&amp;send_lock);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UserRecvFuncCallback</span><span class="params">(<span class="type">void</span> *recv_args, <span class="type">unsigned</span> <span class="type">char</span> *recv_data, <span class="type">int</span> &amp;recv_len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    recv_data[recv_len] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;UserRecvFuncCallback - &quot;</span> &lt;&lt; recv_data &lt;&lt; <span class="string">&quot;\n\r&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> *<span class="title">SendDataThrd</span><span class="params">(<span class="type">void</span> *para)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">UserSendFuncLoadData_</span>();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">TcpClientTestThrd</span><span class="params">(<span class="type">char</span> *str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> recv_buf[MAX_BUF_SIZE];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> send_buf[MAX_BUF_SIZE];</span><br><span class="line"></span><br><span class="line">    TcpClientCallbackData tcp_client_callback_data;</span><br><span class="line"></span><br><span class="line">    tcp_client_callback_data.recv_args = <span class="literal">NULL</span>;</span><br><span class="line">    tcp_client_callback_data.send_args = (<span class="type">void</span> *)str;</span><br><span class="line"></span><br><span class="line">    tcp_client_callback_data.recv_callback = UserRecvFuncCallback;</span><br><span class="line">    tcp_client_callback_data.send_loaddata = UserSendFuncLoadData;</span><br><span class="line"></span><br><span class="line">    tcp_client_callback_data.send_buf = send_buf;</span><br><span class="line">    tcp_client_callback_data.recv_buf = recv_buf;</span><br><span class="line"></span><br><span class="line">    tcp_client_callback_data.max_recv_len = MAX_BUF_SIZE;</span><br><span class="line">    tcp_client_callback_data.max_send_len = MAX_BUF_SIZE;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> server_port = CCT_CAMERA_SERVER_PORT;</span><br><span class="line">    <span class="function">std::string <span class="title">server_ip</span><span class="params">(CCT_CAMERA_SERVER_IP)</span></span>;</span><br><span class="line">    Poco::<span class="function">Net::SocketAddress <span class="title">socket_addr</span><span class="params">(server_ip.c_str(), server_port)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">StartThread</span>(SendDataThrd, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        SocketReactor reactor;</span><br><span class="line">        <span class="function">BaseSocketConnector&lt;BaseTcpClient&gt; <span class="title">connector</span><span class="params">(socket_addr, reactor, tcp_client_callback_data)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//std::cout &lt;&lt; &quot;before run\n\r&quot;;</span></span><br><span class="line">        reactor.<span class="built_in">run</span>();</span><br><span class="line">        <span class="comment">//std::cout &lt;&lt; &quot;after run\n\r&quot;;</span></span><br><span class="line"></span><br><span class="line">        Poco::Thread::<span class="built_in">sleep</span>(MAX_ONSEND_INTERVAL);</span><br><span class="line">    &#125; <span class="keyword">while</span> (<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> ** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (argc &lt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s some_info\n\r&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">TcpClientTestThrd</span>(argv[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="makefile："><a class="header-anchor" href="#makefile：">※</a>makefile：</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> TOP_DIR = <span class="variable">$(PWD)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 包含参数配置文件</span></span><br><span class="line"><span class="comment">#include ./Makefile.param</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 目标文件名称、编译后文件位置</span></span><br><span class="line">PWD := <span class="variable">$(<span class="built_in">shell</span> pwd)</span></span><br><span class="line">INSTALLDIR = .</span><br><span class="line"></span><br><span class="line">TARGET = tcp_client_test</span><br><span class="line">DBGTARGET = <span class="variable">$(INSTALLDIR)</span>/<span class="variable">$(TARGET)</span>d</span><br><span class="line">RLSTARGET = <span class="variable">$(INSTALLDIR)</span>/<span class="variable">$(TARGET)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置编译器</span></span><br><span class="line">CC = <span class="variable">$(CROSS_COMPILE)</span>gcc</span><br><span class="line">CXX = <span class="variable">$(CROSS_COMPILE)</span>g++</span><br><span class="line">LD_CXX = <span class="variable">$(CROSS_COMPILE)</span>g++</span><br><span class="line">STRIP = <span class="variable">$(CROSS_COMPILE)</span>strip</span><br><span class="line">RM = rm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置依赖头文件、库文件路径</span></span><br><span class="line">INCPATH += -I. -I<span class="variable">$(REL_INC)</span> -I/usr/local/<span class="keyword">include</span> </span><br><span class="line">LIBPATH += -L. -L<span class="variable">$(REL_LIB)</span> -L/usr/local/lib </span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置编译参数</span></span><br><span class="line">FLAGS_C += <span class="variable">$(MACRO_DEFINE)</span> <span class="variable">$(INCPATH)</span> <span class="variable">$(CFLAGS)</span> -Wall </span><br><span class="line">FLAGS_CXX += <span class="variable">$(MACRO_DEFINE)</span> <span class="variable">$(INCPATH)</span> <span class="variable">$(CFLAGS)</span> -Wall </span><br><span class="line">LDFLAGS += <span class="variable">$(CFLAGS)</span> <span class="variable">$(LIBPATH)</span> <span class="variable">$(LIBS_CFLAGS)</span> -pie -fPIE </span><br><span class="line">LIBS += -lPocoFoundation -lPocoNet -lpthread -lm -lc -lgcc -lgcc_s -ldl </span><br><span class="line"></span><br><span class="line">DBG_FLAGS = -g -D__DEBUG</span><br><span class="line">RLS_FLAGS = -O2 -fno-strict-aliasing</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 源文件包含</span></span><br><span class="line">SRCS_C  = <span class="variable">$(<span class="built_in">wildcard</span> *.c)</span></span><br><span class="line">SRCS_CXX  = <span class="variable">$(<span class="built_in">wildcard</span> *.cpp)</span></span><br><span class="line">SRCS_H  = <span class="variable">$(<span class="built_in">wildcard</span> *.h*)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># obj文件包含</span></span><br><span class="line">OBJ_DBG_DIR = 0-obj/<span class="variable">$(CROSS_COMPILE)</span>dbg</span><br><span class="line">OBJ_RLS_DIR = 0-obj/<span class="variable">$(CROSS_COMPILE)</span>rls</span><br><span class="line"></span><br><span class="line">OBJS_C_DBG = <span class="variable">$(<span class="built_in">addprefix</span> <span class="variable">$(OBJ_DBG_DIR)</span>/,$(SRCS_C:%.c=%.o)</span>)</span><br><span class="line">OBJS_CXX_DBG = <span class="variable">$(<span class="built_in">addprefix</span> <span class="variable">$(OBJ_DBG_DIR)</span>/,$(SRCS_CXX:%.cpp=%.o)</span>)</span><br><span class="line">OBJS_C_RLS = <span class="variable">$(<span class="built_in">addprefix</span> <span class="variable">$(OBJ_RLS_DIR)</span>/,$(SRCS_C:%.c=%.o)</span>)</span><br><span class="line">OBJS_CXX_RLS = <span class="variable">$(<span class="built_in">addprefix</span> <span class="variable">$(OBJ_RLS_DIR)</span>/,$(SRCS_CXX:%.cpp=%.o)</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译动作</span></span><br><span class="line">COMPILE_C = <span class="variable">$(CC)</span> <span class="variable">$(FLAGS_C)</span> -c</span><br><span class="line">COMPILE_CXX = <span class="variable">$(CXX)</span> <span class="variable">$(FLAGS_CXX)</span> -c</span><br><span class="line">LINK_CXX = <span class="variable">$(LD_CXX)</span> <span class="variable">$(LDFLAGS)</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: clean debug release install</span></span><br><span class="line"></span><br><span class="line"><span class="section">all:	release</span></span><br><span class="line"></span><br><span class="line"><span class="section">install:</span></span><br><span class="line">	install -d <span class="variable">$(EXEC_DIR)</span></span><br><span class="line">	install <span class="variable">$(RLSTARGET)</span> <span class="variable">$(EXEC_DIR)</span></span><br><span class="line">	install -m 444 <span class="variable">$(TARGET)</span>.txt <span class="variable">$(EXEC_DIR)</span></span><br><span class="line"></span><br><span class="line"><span class="section">release: <span class="variable">$(RLSTARGET)</span></span></span><br><span class="line">	<span class="variable">$(STRIP)</span> <span class="variable">$(RLSTARGET)</span></span><br><span class="line"></span><br><span class="line"><span class="section">debug: <span class="variable">$(DBGTARGET)</span></span></span><br><span class="line">	@echo <span class="variable">$(TARGET)</span>_debug_done</span><br><span class="line"></span><br><span class="line"><span class="variable">$(RLSTARGET)</span>:	<span class="variable">$(OBJS_C_RLS)</span> <span class="variable">$(OBJS_CXX_RLS)</span></span><br><span class="line">	@mkdir -p <span class="variable">$(INSTALLDIR)</span></span><br><span class="line">	<span class="variable">$(LINK_CXX)</span> -o <span class="variable">$@</span> <span class="variable">$^</span> <span class="variable">$(LIBS)</span> </span><br><span class="line"></span><br><span class="line"><span class="variable">$(DBGTARGET)</span>:	<span class="variable">$(OBJS_C_DBG)</span> <span class="variable">$(OBJS_CXX_DBG)</span></span><br><span class="line">	@mkdir -p <span class="variable">$(INSTALLDIR)</span></span><br><span class="line">	<span class="variable">$(LINK_CXX)</span> -o <span class="variable">$@</span> <span class="variable">$^</span> <span class="variable">$(LIBS)</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$(OBJS_CXX_RLS)</span>:	<span class="variable">$(OBJ_RLS_DIR)</span>/%.o: %.cpp <span class="variable">$(SRCS_H)</span></span><br><span class="line">	@mkdir -p <span class="variable">$(OBJ_RLS_DIR)</span></span><br><span class="line">	<span class="variable">$(COMPILE_CXX)</span> <span class="variable">$(RLS_FLAGS)</span> -o <span class="variable">$@</span> <span class="variable">$&lt;</span></span><br><span class="line">	</span><br><span class="line"><span class="variable">$(OBJS_C_RLS)</span>:		<span class="variable">$(OBJ_RLS_DIR)</span>/%.o: %.c <span class="variable">$(SRCS_H)</span></span><br><span class="line">	@mkdir -p <span class="variable">$(OBJ_RLS_DIR)</span></span><br><span class="line">	<span class="variable">$(COMPILE_C)</span> <span class="variable">$(RLS_FLAGS)</span> -o <span class="variable">$@</span> <span class="variable">$&lt;</span>	</span><br><span class="line"></span><br><span class="line"><span class="variable">$(OBJS_CXX_DBG)</span>:	<span class="variable">$(OBJ_DBG_DIR)</span>/%.o: %.cpp <span class="variable">$(SRCS_H)</span></span><br><span class="line">	@mkdir -p <span class="variable">$(OBJ_DBG_DIR)</span></span><br><span class="line">	<span class="variable">$(COMPILE_CXX)</span> <span class="variable">$(DBG_FLAGS)</span> -o <span class="variable">$@</span> <span class="variable">$&lt;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(OBJS_C_DBG)</span>:		<span class="variable">$(OBJ_DBG_DIR)</span>/%.o: %.c <span class="variable">$(SRCS_H)</span></span><br><span class="line">	@mkdir -p <span class="variable">$(OBJ_DBG_DIR)</span></span><br><span class="line">	<span class="variable">$(COMPILE_C)</span> <span class="variable">$(DBG_FLAGS)</span> -o <span class="variable">$@</span> <span class="variable">$&lt;</span></span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	-<span class="variable">$(RM)</span> -rf  *~ *.d .dep 0-obj</span><br></pre></td></tr></table></figure><h2 id="【C-】郭老二博文之：C-目录"><a class="header-anchor" href="#【C-】郭老二博文之：C-目录">※</a>【C++】郭老二博文之：C++目录<sup class="footnote-ref"><a href="#fn8" id="fnref8">[8]</a></sup></h2><ul><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/u010168781/article/details/78122953">【C++】POCO学习总结（一）：下载与编译</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/u010168781/article/details/78123152">【C++】POCO学习总结（二）：配置选择</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/u010168781/article/details/78123377">【C++】POCO学习总结（三）：交叉编译</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/u010168781/article/details/78123568">【C++】POCO学习总结（四）： 在window下使用MSYS、MinGW编译POCO</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/u010168781/article/details/134541854">【C++】POCO学习总结（五）：功能介绍</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/u010168781/article/details/134654363">【C++】POCO学习总结（六）：线程、线程池、同步</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/u010168781/article/details/134698540">【C++】POCO学习总结（七）：进程、管道、进程间同步、共享内存</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/u010168781/article/details/134700006">【C++】POCO学习总结（八）：通知Notifications和事件Events</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/u010168781/article/details/134766792">【C++】POCO学习总结（九）：网络</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/u010168781/article/details/134817890">【C++】POCO学习总结（十）：Poco::Util::Application（应用程序框架）</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/u010168781/article/details/134935891">【C++】POCO学习总结（十一）：文件系统（路径、文件属性、目录浏览、临时文件等）</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/u010168781/article/details/134936940">【C++】POCO学习总结（十二）：流（文本编解码、数据压缩、文件读写流等）</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/u010168781/article/details/134958957">【C++】POCO学习总结（十三）：类型和字节序、错误处理和调试、获取系统信息</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/u010168781/article/details/134982359">【C++】POCO学习总结（十四）：引用计数、共享指针、缓冲区管理</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/u010168781/article/details/134983856">【C++】POCO学习总结（十五）：字符串操作</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/u010168781/article/details/135004539">【C++】POCO学习总结（十六）：随机数、密码、时间戳、日期和时间（格式化与解析）、时区、本地时间</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/u010168781/article/details/135025308">【C++】POCO学习总结（十七）：日志系统（级别、通道、格式化、记录流）</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/u010168781/article/details/135050826">【C++】POCO学习总结（十八）：XML</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/u010168781/article/details/135072388">【C++】POCO学习总结（十九）：哈希、URL、UUID、配置文件、日志配置、动态库加载</a></li></ul><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/poechant/article/details/7485760">https://blog.csdn.net/poechant/article/details/7485760</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/flyfish1986/article/details/130985212">https://blog.csdn.net/flyfish1986/article/details/130985212</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p></li><li id="fn3" class="footnote-item"><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/poechant/article/details/7485760">https://blog.csdn.net/poechant/article/details/7485760</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p></li><li id="fn4" class="footnote-item"><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://leiyiming.com/2017/09/23/reactor/">https://leiyiming.com/2017/09/23/reactor/</a> <a href="#fnref4" class="footnote-backref">↩︎</a></p></li><li id="fn5" class="footnote-item"><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/qq_40344790/article/details/129745804">https://blog.csdn.net/qq_40344790/article/details/129745804</a> <a href="#fnref5" class="footnote-backref">↩︎</a></p></li><li id="fn6" class="footnote-item"><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.cnblogs.com/scotth/p/6181583.html">https://www.cnblogs.com/scotth/p/6181583.html</a> <a href="#fnref6" class="footnote-backref">↩︎</a></p></li><li id="fn7" class="footnote-item"><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/wuu19/article/details/102976698">https://blog.csdn.net/wuu19/article/details/102976698</a> <a href="#fnref7" class="footnote-backref">↩︎</a></p></li><li id="fn8" class="footnote-item"><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/u010168781/article/details/134562223">https://blog.csdn.net/u010168781/article/details/134562223</a> <a href="#fnref8" class="footnote-backref">↩︎</a></p></li></ol></section></section><section class="References"><span id="References">References</span> <span id="References-content"></span></section><section class="post-footer"><hr id="footerline"><br><section class="author">*Corresponding Author: Yao Qing-sheng &lt;Email: <a href="mailto:350788415@qq.com" rel="external nofollow noreferrer" title="350788415@qq.com">350788415@qq.com</a>&gt; BY-NC-SA .</section><br><ol id="list"><li>Yao Qing-sheng&period;Poco库学习&period;FUTURE & CIVILIZATION&period;Natural/Social Philosophy & Infomation Sciences&comma;20240522&period;https://yaoqs.github.io/20240522/poco-ku-xue-xi/</li><li>版权声明：本文为「LordYao」的原创文章，遵循 CC 4.0 BY-NC-SA 版权协议，转载请附上原文出处链接及本声明。<br>原文链接： https://yaoqs.github.io/20240522/poco-ku-xue-xi/</li></ol></section><script>jQuery(document).on("copy",function(e){var t=window.getSelection(),n=t.toString().replace(/\n/g,"<br>"),o="<br>---------------------<br>著作权归作者所有。<br>商业转载请联系作者获得授权，非商业转载请注明出处。<br><br>作者："+document.getElementById("author").innerText+"<br>复制时间: "+Date.now()+"<br>原文链接："+document.location.href+"<br>© 版权声明：本文为「"+document.getElementById("author").innerText+"」的原创文章，遵循 CC 4.0 BY-NC-SA 版权协议，转载请附上原文出处链接及本声明。",r=$("<div>",{id:"temp",html:n+o,style:{position:"absolute",left:"-99999px"}});$("body").append(r),t.selectAllChildren(r[0]),window.setTimeout(function(){r.remove()},0)})</script></section><div style="font-size:12px;BORDER-BOTTOM:#bbb 1px solid;BORDER-LEFT:#bbb 1px solid;BACKGROUND:#f6f6f6;MIN-HEIGHT:120px;BORDER-TOP:#bbb 1px solid;BORDER-RIGHT:#bbb 1px solid;MARGIN-TOP:30px;MARGIN-BOTTOM:10px"><div style="MARGIN-TOP:10px;FLOAT:left;MARGIN-LEFT:10px;MARGIN-RIGHT:10px"><img alt="author:Yao Qing-sheng" src="/images/avatar_sx_lite.png" width="100" height="100"></div><div style="LINE-HEIGHT:200%;MARGIN:10px;COLOR:#000">Author: <a href="https://yaoqs.github.io/">Yao Qing-sheng</a> &nbsp;&nbsp;&nbsp;&nbsp; Blog: <a href="https://yaoqs.github.io/">https://yaoqs.github.io/</a>&nbsp;&nbsp;&nbsp;&nbsp; Email: <a href="mailto:350788415@qq.com" rel="external nofollow noopener noreferrer" target="_blank">350788415@qq.com</a><br>Address:Department of Natural/Social Philosophy & Infomation Sciences, CHINA<br><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/yaoqs#biography">Biography...</a></div></div><style>.article-licensing{position:relative;z-index:0;box-shadow:none;background:#f5f5f5;border-radius:4px;overflow:hidden}.article-licensing p{margin-top:0;margin-bottom:0;font-size:.8em}.article-licensing:after{position:absolute;z-index:-1;right:50px;top:30.9px;content:'\f25e';font-size:200px;font-family:'Font Awesome 5 Brands';opacity:.1}.article-licensing .level-left{flex-wrap:wrap;max-width:100%}.article-licensing .licensing-title{line-height:1.2em;margin-left:10px}.article-licensing .licensing-meta{margin-left:10px}.article-licensing .licensing-meta .icon{vertical-align:bottom}.article-licensing .licensing-meta a{color:inherit}.level{align-items:center;justify-content:space-between}.level code{border-radius:4px}.level img{display:inline-block;vertical-align:top}.level.is-mobile{display:flex}.level.is-mobile .level-left,.level.is-mobile .level-right{display:flex}.level.is-mobile .level-left+.level-right{margin-top:0}.level.is-mobile .level-item:not(:last-child){margin-bottom:0;margin-right:.75rem}.level.is-mobile .level-item:not(.is-narrow){flex-grow:1}@media screen and (min-width:769px),print{.level{display:flex}.level>.level-item:not(.is-narrow){flex-grow:1}}.level-item{align-items:center;display:flex;flex-basis:auto;flex-grow:0;flex-shrink:0;justify-content:center}.level-item .subtitle,.level-item .title{margin-bottom:0}@media screen and (max-width:768px){.level-item:not(:last-child){margin-bottom:.75rem}}.level-left,.level-right{flex-basis:auto;flex-grow:0;flex-shrink:0}.level-left .level-item.is-flexible,.level-right .level-item.is-flexible{flex-grow:1}@media screen and (min-width:769px),print{.level-left .level-item:not(:last-child),.level-right .level-item:not(:last-child){margin-right:.75rem}}.level-left{align-items:center;justify-content:flex-start}@media screen and (max-width:768px){.level-left+.level-right{margin-top:1.5rem}}@media screen and (min-width:769px),print{.level-left{display:flex}}.level-right{align-items:center;justify-content:flex-end}@media screen and (min-width:769px),print{.level-right{display:flex}}</style><div class="article-licensing box"><div class="licensing-title"><a href="https://yaoqs.github.io/20240522/poco-ku-xue-xi/">Poco库学习</a></div><div class="licensing-title"><p><a href="https://yaoqs.github.io/20240522/poco-ku-xue-xi/">https://yaoqs.github.io/20240522/poco-ku-xue-xi/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><p>Author</p><p>Yao Qing-sheng</p></div></div><div class="level-item is-narrow"><div><p>Posted on</p><p>2024-05-22</p></div></div><div class="level-item is-narrow"><div><p>Updated on</p><p>2025-01-14</p></div></div><div class="level-item is-narrow"><div><p>Licensed under</p><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a> <a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a> <a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div><div class="licensing-title"><p>转载或引用本文时请遵守许可协议，注明出处、不得用于商业用途！</p></div></div><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js" integrity="sha256-fGPu+icKh985TLPhO2v68U7i0CW0dE4kiR06RN4O6jo=" crossorigin="anonymous"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css" integrity="sha256-0EDwznjUTDEicOuZhOL03fpflUqzhkByvhwol8YGkp4=" crossorigin="anonymous"><div class="social-share share-component"></div><style>.card{background-color:#fff;box-shadow:0 4px 10px rgba(0,0,0,.05),0 0 1px rgba(0,0,0,.1);color:#4a4a4a;max-width:100%;position:relative;transition:opacity .3s ease-out,transform .3s ease-out;opacity:1;transform-origin:center top 0}.card-header{background-color:transparent;align-items:stretch;box-shadow:0 .125em .25em rgba(10,10,10,.1);display:flex}.card-header-title{align-items:center;color:#363636;display:flex;flex-grow:1;font-weight:700;padding:.75rem 1rem}.card-header-title.is-centered{justify-content:center}.card-header-icon{align-items:center;cursor:pointer;display:flex;justify-content:center;padding:.75rem 1rem}.card-image{display:block;position:relative}.card-content{background-color:transparent;padding:1.5em;font-size:1.2em}.buttons.is-centered{justify-content:center;display:flex;font-size:.8em}.card-footer{background-color:transparent;border-top:1px solid #ededed;align-items:stretch;display:flex}.card-footer-item{align-items:center;display:flex;flex-basis:0;flex-grow:1;flex-shrink:0;justify-content:center;padding:.75rem}.card-footer-item:not(:last-child){border-right:1px solid #ededed}.card .media:not(:last-child){margin-bottom:.75rem}.donate{position:relative;padding:10px 10px 10px 10px;margin-left:1em;border-radius:.5em}.donate .qrcode{display:none;position:absolute;z-index:99;bottom:2.5em;line-height:0;overflow:hidden;box-shadow:0 4px 10px rgba(0,0,0,.05),0 0 1px rgba(0,0,0,.1);border-radius:4px}.donate .qrcode img{max-width:280px}.donate:hover .qrcode{display:block}.donate:first-child:not(:last-child) .qrcode{left:-.75rem}.donate:last-child:not(:first-child) .qrcode{right:-.75rem}.donate[data-type=alipay]{color:#fff;background-color:#00a0e8;border-color:transparent}.donate[data-type=alipay]:active{background-color:#008ecf}.donate[data-type=alipay]:hover{background-color:#0097db}.donate[data-type=alipay]:focus:not(:active){box-shadow:0 0 0 .125em rgba(0,160,232,.25)}.donate[data-type=buymeacoffee]{color:rgba(0,0,0,.7);background-color:#fd0;border-color:transparent}.donate[data-type=buymeacoffee]:active{background-color:#e6c700}.donate[data-type=buymeacoffee]:hover{background-color:#f2d200}.donate[data-type=buymeacoffee]:focus:not(:active){box-shadow:0 0 0 .125em rgba(255,221,0,.25)}.donate[data-type=paypal]{color:rgba(0,0,0,.7);background-color:#feb700;border-color:transparent}.donate[data-type=paypal]:active{background-color:#e5a500}.donate[data-type=paypal]:hover{background-color:#f1ae00}.donate[data-type=paypal]:focus:not(:active){box-shadow:0 0 0 .125em rgba(254,183,0,.25)}.donate[data-type=patreon]{color:#fff;background-color:#ff424d;border-color:transparent}.donate[data-type=patreon]:active{background-color:#ff2835}.donate[data-type=patreon]:hover{background-color:#ff3541}.donate[data-type=patreon]:focus:not(:active){box-shadow:0 0 0 .125em rgba(255,66,77,.25)}.donate[data-type=wechat]{color:#fff;background-color:#1aad19;border-color:transparent}.donate[data-type=wechat]:active{background-color:#179716}.donate[data-type=wechat]:hover{background-color:#18a217}.donate[data-type=wechat]:focus:not(:active){box-shadow:0 0 0 .125em rgba(26,173,25,.25)}.donate[data-type="GitHub Sponsor"]{color:#fff;background-color:#000;border-color:transparent}.donate[data-type="GitHub Sponsor"]:active{background-color:#000}.donate[data-type="GitHub Sponsor"]:hover{background-color:#000}.donate[data-type="GitHub Sponsor"]:focus:not(:active){box-shadow:0 0 0 .125em rgba(0,160,232,.25)}</style><div class="card"><div class="card-content"><p>Like this article? Support the author with</p><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i> </span><span>Alipay</span> <span class="qrcode"><img width="200px" src="/images/支付宝收款码.jpg" alt="Alipay"> </span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i> </span><span>Wechat</span> <span class="qrcode"><img src="/images/微信收款码.png" alt="Wechat"> </span></a><a class="button donate" data-type="paypal"><span class="icon is-small"><i class="fab fa-paypal"></i> </span><span>PayPal</span> <span class="qrcode"><img src="/images/paypal.png" alt="PayPal"> </span></a><a class="button donate" data-type="GitHub Sponsor" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/sponsors/yaoqs"><span class="icon is-small"><i class="fab fa-GitHub"></i> </span><span>GitHub Sponsor</span> </a><a class="button donate" data-type="buymeacoffee" target="_blank" rel="noopener external nofollow noreferrer" href="https://buymeacoffee.com/yaoqs"><span class="icon is-small"><i class="fab fa-buymeacoffee"></i> </span><span>Buy Me a Coffee</span></a></div></div></div></article><div id="qrcode"></div><script>$("#qrcode").qrcode({width:173,height:173,text:"https://yaoqs.github.io/20240522/poco-ku-xue-xi/"})</script><div class="pagination"><a class="newer-posts" href="/20240530/wireguard-xue-xi/">← WireGuard学习 </a><a class="older-posts" href="/20240513/zhong-hua-ren-min-gong-he-guo-guo-min-jing-ji-he-she-hui-fa-zhan-di-shi-si-ge-wu-nian-gui-hua-he-2035-nian-yuan-jing-mu-biao-gang-yao/">中华人民共和国国民经济和社会发展第十四个五年规划和2035年远景目标纲要 →</a><br></div><a id="toTop" href="#top" title="回顶部">Top</a></main></div></div><script src="https://cdn.jsdelivr.net/gh/yaoqs/donate-plugin/zanzhu_yaoqs.min.js"></script><script>$(function(){new Rewardtip({tiptext:"谢谢支持/Thanks...",tipimg:{img:"/images/ali.gif",width:"50px",height:"50px"},more:"/Donate",tipshow:"<img src='/images/ali.gif'/>",list:[{name:"微信收款码",qrimg:"/images/微信收款码.png"},{name:"微信打赏码",qrimg:"/images/微信打赏码.png"},{name:"支付宝收款码",qrimg:"/images/支付宝收款码.jpg"},{name:"支付宝红包码",qrimg:"/images/支付宝红包码.jpg"}],link:[{name:"paypal",desc:"paypal.me/LordYao",link:"https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=243292490@qq.com&amp;currency_code=USD&amp;amount=1&amp;return=http://yaoqs.github.com/about&amp;item_name=LordYao%27s%20Blog&amp;undefined_quantity=1"}]})})</script><script src="https://cdn.jsdelivr.net/npm/materialize-css@1.0.0/dist/js/materialize.min.js" integrity="sha256-U/cHDMTIHCeMcvehBv1xQ052bPSbJtbuiw4QA9cTKz0=" crossorigin="anonymous"></script><style>#searchIcon{font-size:1.2rem}#searchModal{min-height:500px;width:80%}#searchModal .search-header .title{font-size:1.6rem;color:#333}#searchResult{margin:-15px 0 10px 10px}#searchResult .search-result-list{margin-left:-8px;padding-left:0;color:#666}.search-result-list .search-result-title{font-size:1.4rem;color:#42b983}.search-result-list li{border-bottom:1px solid #e5e5e5;padding:15px 0 5px 0}.search-result-list .search-keyword{margin:0 2px;padding:1px 5px 1px 4px;border-radius:2px;background-color:#f2f2f2;color:#e96900;font-style:normal;white-space:pre-wrap}.modal{display:none;position:fixed;left:0;right:0;background-color:#fafafa;padding:0;max-height:70%;width:55%;margin:auto;overflow-y:auto;border-radius:2px;will-change:top,opacity}.modal:focus{outline:0}@media only screen and (max-width:992px){.modal{width:80%}}.modal h1,.modal h2,.modal h3,.modal h4{margin-top:0}.modal .modal-content{padding:24px}.modal .modal-close{cursor:pointer}.modal .modal-footer{border-radius:0 0 2px 2px;background-color:#fafafa;padding:4px 6px;height:56px;width:100%;text-align:right}.modal .modal-footer .btn,.modal .modal-footer .btn-flat,.modal .modal-footer .btn-large,.modal .modal-footer .btn-small{margin:6px 0}.modal-overlay{position:fixed;z-index:999;top:-25%;left:0;bottom:0;right:0;height:125%;width:100%;background:#000;display:none;will-change:opacity}.modal.modal-fixed-footer{padding:0;height:70%}.modal.modal-fixed-footer .modal-content{position:absolute;height:calc(100% - 56px);max-height:100%;width:100%;overflow-y:auto}.modal.modal-fixed-footer .modal-footer{border-top:1px solid rgba(0,0,0,.1);position:absolute;bottom:0}.modal.bottom-sheet{top:auto;bottom:-100%;margin:0;width:100%;max-height:45%;border-radius:0;will-change:bottom,opacity}</style><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;search</span> <input type="search" id="searchInput" name="s" placeholder="searchTip" class="search-input"></div><div id="searchResult"></div></div></div><script>$(function(){var e,r,a;e="/search.xml",r="searchInput",a="searchResult",$.ajax({url:e,dataType:"xml",success:function(e){var t=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),e=document.getElementById(r),n=document.getElementById(a);e.addEventListener("input",function(){var o='<ul class="search-result-list">',h=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length<=0||(t.forEach(function(e){var n,t,r,a=!0,l=e.title.trim().toLowerCase(),s=e.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),i=0===(i=e.url).indexOf("/")?e.url:"/"+i,c=-1,u=-1;""!==l&&""!==s&&h.forEach(function(e,t){n=l.indexOf(e),c=s.indexOf(e),n<0&&c<0?a=!1:(c<0&&(c=0),0===t&&(u=c))}),a&&(o+="<li><a href='"+i+"' class='search-result-title'>"+l+"</a>",i=e.content.trim().replace(/<[^>]+>/g,""),0<=u&&(e=u+80,(e=0===(t=(t=u-20)<0?0:t)?100:e)>i.length&&(e=i.length),r=i.substr(t,e),h.forEach(function(e){var t=new RegExp(e,"gi");r=r.replace(t,'<em class="search-keyword">'+e+"</em>")}),o+='<p class="search-result">'+r+"...</p>"),o+="</li>")}),o+="</ul>",n.innerHTML=o)})}})}),$(".modal").modal()</script><script src="https://fastly.jsdelivr.net/npm/hexo-tag-common@0.2.0/js/index.js"></script><script src="/js/hexo-widget-tree.js"></script><div id="widget-tree"><ul><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/github-page/">github page </a><span class="tree-list-count">14</span><ul class="tree-list-children"><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/github-page/Termux/">Termux </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20220101/termux-config/" title="Termux-config"><i class="post-icon gg-file-document"></i>Termux-config</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/github-page/keys/">keys </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20220101/keys/" title="keys"><i class="post-icon gg-file-document"></i>keys</a></li></ul></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫 </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20220609/50-chong-zui-bang-de-kai-yuan-pa-chong-kuang-jia-xiang-mu/" title="50种最棒的开源爬虫框架/项目"><i class="post-icon gg-file-document"></i>50种最棒的开源爬虫框架/项目</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/Cesium/">Cesium </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20240808/cesium-sheng-cheng-terrain-di-xing-shu-ju-ctb-fang-shi-ji-bu-zou/" title="Cesium 生成terrain地形数据----CTB方式及步骤"><i class="post-icon gg-file-document"></i>Cesium 生成terrain地形数据----CTB方式及步骤</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/%E7%A7%91%E7%A0%94%E5%AD%A6%E6%9C%AF/">科研学术 </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20220424/ei-qi-kan-cha-xun/" title="EI期刊查询"><i class="post-icon gg-file-document"></i>EI期刊查询</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/html/">html </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20191121/html5-xuan-ku-dong-hua-ji-yuan-ma-demo-yan-shi/" title="HTML5炫酷动画及源码DEMO演示"><i class="post-icon gg-file-document"></i>HTML5炫酷动画及源码DEMO演示</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/">技术笔记 </a><span class="tree-list-count">15</span><ul class="tree-list-children"><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/opencv/">opencv </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20220628/opencv-zai-csharp-zhong-ying-yong-opencvsharp/" title="OpenCV在Csharp中应用OpenCVSharp"><i class="post-icon gg-file-document"></i>OpenCV在Csharp中应用OpenCVSharp</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/OpenGL/">OpenGL </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20220628/opengl-chao-ji-bao-dian-xue-xi-bi-ji-cao-zuo-xiang-su/" title="OpenGL超级宝典学习笔记操作像素"><i class="post-icon gg-file-document"></i>OpenGL超级宝典学习笔记操作像素</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/js/">js </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20220615/js-han-shu-zhong-ru-he-shi-yong-ke-xuan-can-shu-bao-gua-ke-xuan-hui-diao-han-shu/" title="js函数中如何使用可选参数（包括可选回调函数）"><i class="post-icon gg-file-document"></i>js函数中如何使用可选参数（包括可选回调函数）</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/%E6%A0%91%E8%8E%93%E6%B4%BE/">树莓派 </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20220613/chu-chang-zhi-zuo-shu-mei-pai-zui-jian-dan-de-rootfs/" title="初尝制作树莓派最简单的rootfs"><i class="post-icon gg-file-document"></i>初尝制作树莓派最简单的rootfs</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/">游戏开发 </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20220705/you-xi-kai-fa-zi-yuan-gamedevresource/" title="游戏开发资源GameDevResource"><i class="post-icon gg-file-document"></i>游戏开发资源GameDevResource</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/%E4%B8%93%E9%A2%98/">专题 </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20210430/win10-bitlocker-zhuan-ti/" title="win10-BitLocker专题"><i class="post-icon gg-file-document"></i>win10-BitLocker专题</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/%E7%9B%AE%E6%A0%87%E8%B7%9F%E8%B8%AA/">目标跟踪 </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20220425/mu-biao-gen-zong-suan-fa/" title="目标跟踪算法"><i class="post-icon gg-file-document"></i>目标跟踪算法</a></li></ul></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/%E4%B8%93%E9%A2%98/">专题 </a><span class="tree-list-count">12</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20220424/javascript-zhuan-ti/" title="JavaScript专题"><i class="post-icon gg-file-document"></i>JavaScript专题</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/20210411/docker-zhuan-ti/" title="Docker专题"><i class="post-icon gg-file-document"></i>Docker专题</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/20210401/windowsterminal-zhuan-ti/" title="Windows Terminal专题"><i class="post-icon gg-file-document"></i>Windows Terminal专题</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/20210401/wsl2-zhuan-ti/" title="WSL2专题"><i class="post-icon gg-file-document"></i>WSL2专题</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/20220424/xamarin-zhuan-ti/" title="Xamarin专题"><i class="post-icon gg-file-document"></i>Xamarin专题</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/20220426/csharp-zhuan-ti/" title="csharp专题"><i class="post-icon gg-file-document"></i>csharp专题</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/20210220/c-zhuan-ti/" title="c++专题"><i class="post-icon gg-file-document"></i>c++专题</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/20210411/hexo-zhuan-ti/" title="hexo专题"><i class="post-icon gg-file-document"></i>hexo专题</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/20220424/html-zhuan-ti/" title="html专题"><i class="post-icon gg-file-document"></i>html专题</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/20210327/jquery-zhuan-ti/" title="jQuery专题"><i class="post-icon gg-file-document"></i>jQuery专题</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/20210411/ssh-zhuan-ti/" title="ssh专题"><i class="post-icon gg-file-document"></i>ssh专题</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/20250114/cookie-zhuan-ti/" title="cookie专题"><i class="post-icon gg-file-document"></i>cookie专题</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/javascript/">javascript </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20220315/javascript-yu-yan-jing-sui-yu-bian-cheng-shi-jian/" title="JavaScript语言精髓与编程实践"><i class="post-icon gg-file-document"></i>JavaScript语言精髓与编程实践</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/iocp/">iocp </a><span class="tree-list-count">2</span><ul class="tree-list-children"><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/iocp/c/">c++ </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20240808/cai-yong-wan-cheng-duan-kou-iocp-shi-xian-gao-xing-neng-wang-luo-fu-wu-qi-windows-c-ban/" title="采用完成端口（IOCP）实现高性能网络服务器（Windows c++版）"><i class="post-icon gg-file-document"></i>采用完成端口（IOCP）实现高性能网络服务器（Windows c++版）</a></li></ul></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/python/">python </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20240322/python-wang-ye-pa-chong-wen-ben-chu-li-ke-xue-ji-suan-ji-qi-xue-xi-shu-ju-wa-jue-bing-qi-pu/" title="Python 网页爬虫 & 文本处理 & 科学计算 & 机器学习 & 数据挖掘兵器谱"><i class="post-icon gg-file-document"></i>Python 网页爬虫 & 文本处理 & 科学计算 & 机器学习 & 数据挖掘兵器谱</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/MFC/">MFC </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/MFC/cef/">cef </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20240808/mfc-ji-cheng-cef3-chuang-kou/" title="MFC集成CEF3窗口"><i class="post-icon gg-file-document"></i>MFC集成CEF3窗口</a></li></ul></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/threejs/">threejs </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/threejs/Cesium/">Cesium </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20240808/threejs-ji-cheng-di-tu-wa-pian/" title="ThreeJS集成地图瓦片"><i class="post-icon gg-file-document"></i>ThreeJS集成地图瓦片</a></li></ul></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/visual-studio/">visual studio </a><span class="tree-list-count">3</span><ul class="tree-list-children"><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/visual-studio/%E4%B8%93%E9%A2%98/">专题 </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20220401/visual-studio-code-zhuan-ti/" title="Visual Studio Code 专题"><i class="post-icon gg-file-document"></i>Visual Studio Code 专题</a></li></ul></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/%E5%AE%89%E5%85%A8%E5%B7%A5%E5%85%B7/">安全工具 </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20220628/windows-an-quan-gong-ju-jin-ji/" title="Windows安全工具锦集"><i class="post-icon gg-file-document"></i>Windows安全工具锦集</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/%E6%B8%97%E9%80%8F/">渗透 </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/%E6%B8%97%E9%80%8F/%E4%B8%93%E9%A2%98/">专题 </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20220628/kali-zhuan-ti/" title="kali专题"><i class="post-icon gg-file-document"></i>kali专题</a></li></ul></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/%E6%95%B0%E5%AD%97%E4%BF%A1%E5%8F%B7%E5%A4%84%E7%90%86/">数字信号处理 </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20220330/shu-zi-xin-hao-chu-li-matlab-zuo-fft-shi-dian-shu-n-zen-me-xuan-qu/" title="【数字信号处理】Matlab做fft时点数N怎么选取"><i class="post-icon gg-file-document"></i>【数字信号处理】Matlab做fft时点数N怎么选取</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/%E4%BA%8C%E7%BB%B4%E7%A0%81/">二维码 </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20240806/er-wei-ma-de-sheng-cheng-xi-jie-he-yuan-li/" title="二维码的生成细节和原理"><i class="post-icon gg-file-document"></i>二维码的生成细节和原理</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/nextjs/">nextjs </a><span class="tree-list-count">3</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20240711/shi-yong-next-js-hexo-chong-gou-wo-de-bo-ke/" title="使用 Next.js + Hexo 重构我的博客"><i class="post-icon gg-file-document"></i>使用 Next.js + Hexo 重构我的博客</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/20240711/shi-yong-nextjs-he-tailwindcss-chong-gou-wo-de-bo-ke/" title="使用 NextJS 和 TailwindCSS 重构我的博客"><i class="post-icon gg-file-document"></i>使用 NextJS 和 TailwindCSS 重构我的博客</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/20240711/shi-yong-next-js-da-jian-ge-ren-bo-ke/" title="使用 Next.js 搭建个人博客"><i class="post-icon gg-file-document"></i>使用 Next.js 搭建个人博客</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/git/">git </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/git/%E4%B8%93%E9%A2%98/">专题 </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20220609/git-zhuan-ti/" title="git专题"><i class="post-icon gg-file-document"></i>git专题</a></li></ul></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/pdf/">pdf </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/pdf/wpf/">wpf </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20240808/shi-yong-c-kai-fa-pdf-yue-du-qi-chu-tan-ji-yu-wpf-mei-you-shi-yong-kai-yuan-ku/" title="使用C#开发pdf阅读器初探（基于WPF，没有使用开源库）"><i class="post-icon gg-file-document"></i>使用C#开发pdf阅读器初探（基于WPF，没有使用开源库）</a></li></ul></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记 </a><span class="tree-list-count">4</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20220613/gong-chan-dang-xuan-yan/" title="共产党宣言"><i class="post-icon gg-file-document"></i>共产党宣言</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/20220613/quan-xue-xun-zi/" title="劝学-荀子"><i class="post-icon gg-file-document"></i>劝学-荀子</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/20191203/lun-liu-jia-yao-zhi/" title="论六家要指"><i class="post-icon gg-file-document"></i>论六家要指</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/20220613/huang-di-yin-fu-jing/" title="黄帝阴符经"><i class="post-icon gg-file-document"></i>黄帝阴符经</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/opencv/">opencv </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/opencv/qrcode/">qrcode </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/opencv/qrcode/c/">c++ </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20240808/ji-yu-opencv-shi-bie-ding-wei-er-wei-ma-c-ban/" title="基于opencv 识别、定位二维码 （c++版）"><i class="post-icon gg-file-document"></i>基于opencv 识别、定位二维码 （c++版）</a></li></ul></li></ul></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/acm/">acm </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20240808/you-xi-she-ji-zhi-zuo-shi-shi-fou-hui-yong-dao-lei-si-acm-zhong-de-suan-fa-she-ji/" title="游戏设计制作时是否会用到类似 ACM 中的算法设计？"><i class="post-icon gg-file-document"></i>游戏设计制作时是否会用到类似 ACM 中的算法设计？</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6/">数字签名证书 </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6/Let%E2%80%99s-Encrypt%E8%AF%81%E4%B9%A6/">Let’s Encrypt证书 </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6/Let%E2%80%99s-Encrypt%E8%AF%81%E4%B9%A6/SSL%E8%AF%81%E4%B9%A6/">SSL证书 </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20240808/zi-jian-shu-zi-qian-ming-zheng-shu/" title="自建数字签名证书"><i class="post-icon gg-file-document"></i>自建数字签名证书</a></li></ul></li></ul></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/c/">c++ </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20240807/bjarne-stroustrup-s-faq-zhong-wen-ban/" title="Bjarne Stroustrup's FAQ（中文版）"><i class="post-icon gg-file-document"></i>Bjarne Stroustrup's FAQ（中文版）</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/follow/">follow </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i> <a class="tree-list-link" href="/categories/follow/rsshub/">rsshub </a><span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/20241213/follow-zhuan-ti/" title="Follow专题"><i class="post-icon gg-file-document"></i>Follow专题</a></li></ul></li></ul></li></ul><div id="widget-tree-button"><i class="gg-chevron-right"></i></div></div></body></html>